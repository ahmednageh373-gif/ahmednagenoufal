var N=(n,b,a)=>new Promise((y,i)=>{var p=r=>{try{d(a.next(r))}catch(c){i(c)}},o=r=>{try{d(a.throw(r))}catch(c){i(c)}},d=r=>r.done?y(r.value):Promise.resolve(r.value).then(p,o);d((a=a.apply(n,b)).next())});import{r as x,j as e,e as _}from"./react-vendor-D4cZjflF.js";import{W as E,bj as w,E as f,aH as g,aP as k,aB as h,Z as v,a2 as j,aC as u}from"./icons-lib-DeXvYHHd.js";import"./vendor-DhnXlGBj.js";const B=()=>{const[n,b]=x.useState("1"),[a,y]=x.useState(null),[i,p]=x.useState([]),[o,d]=x.useState(!1),r=()=>N(null,null,function*(){d(!0);try{const s=window.location.origin.replace("3000","5000"),l=yield fetch(`${s}/api/integration/status/${n}`);if(l.ok){const t=yield l.json();t.success&&(y(t.status),p(t.events||[]))}}catch(s){console.error("Error loading integration status:",s)}finally{d(!1)}});x.useEffect(()=>{r();const s=setInterval(r,3e4);return()=>clearInterval(s)},[n]);const c=[{id:"boq",name:"المقايسات",icon:f,color:"bg-blue-500"},{id:"schedule",name:"الجدول الزمني",icon:g,color:"bg-green-500"},{id:"procurement",name:"المشتريات",icon:k,color:"bg-purple-500"},{id:"financials",name:"المالية",icon:h,color:"bg-orange-500"},{id:"resources",name:"الموارد",icon:v,color:"bg-yellow-500"}],S=[{type:"boq_updated",label:"تحديث المقايسات",icon:f,color:"text-blue-600"},{type:"schedule_updated",label:"تحديث الجدول",icon:g,color:"text-green-600"},{type:"procurement_updated",label:"تحديث المشتريات",icon:k,color:"text-purple-600"},{type:"sync_completed",label:"اكتمال المزامنة",icon:j,color:"text-green-600"},{type:"sync_failed",label:"فشل المزامنة",icon:u,color:"text-red-600"}],I=s=>S.find(t=>t.type===s)||{icon:h,color:"text-gray-600",label:s};return e.jsxs("div",{className:"p-6 bg-gray-50 dark:bg-gray-900 min-h-screen",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-2 flex items-center gap-3",children:[e.jsx(E,{className:"w-8 h-8"}),"مراقبة التكامل بين الوحدات"]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"مراقبة حالة التكامل والمزامنة بين جميع أنظمة المشروع"})]}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-4 mb-8",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"المشروع"}),e.jsx("input",{type:"text",value:n,onChange:s=>b(s.target.value),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white",placeholder:"معرف المشروع"})]}),e.jsxs("button",{onClick:r,disabled:o,className:"mt-6 flex items-center gap-2 px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-400",children:[e.jsx(w,{className:`w-5 h-5 ${o?"animate-spin":""}`}),"تحديث"]})]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-6 mb-8",children:c.map(s=>{var m;const l=s.icon,t=((m=a==null?void 0:a.modules)==null?void 0:m[s.id])||"unknown";return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:`${s.color} rounded-full p-3`,children:e.jsx(l,{className:"w-6 h-6 text-white"})}),t==="active"?e.jsx(j,{className:"w-6 h-6 text-green-600"}):t==="syncing"?e.jsx(w,{className:"w-6 h-6 text-blue-600 animate-spin"}):t==="error"?e.jsx(u,{className:"w-6 h-6 text-red-600"}):e.jsx(g,{className:"w-6 h-6 text-gray-400"})]}),e.jsx("h3",{className:"text-lg font-bold text-gray-900 dark:text-white mb-1",children:s.name}),e.jsx("p",{className:`text-sm ${t==="active"?"text-green-600":t==="syncing"?"text-blue-600":t==="error"?"text-red-600":"text-gray-600 dark:text-gray-400"}`,children:t==="active"?"نشط":t==="syncing"?"جاري المزامنة":t==="error"?"خطأ":"غير معروف"})]},s.id)})}),a&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(h,{className:"w-6 h-6 text-blue-600"}),e.jsx("h3",{className:"text-sm text-gray-600 dark:text-gray-400",children:"إجمالي الأحداث"})]}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:a.total_events||0})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(j,{className:"w-6 h-6 text-green-600"}),e.jsx("h3",{className:"text-sm text-gray-600 dark:text-gray-400",children:"مزامنات ناجحة"})]}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:a.successful_syncs||0})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(u,{className:"w-6 h-6 text-red-600"}),e.jsx("h3",{className:"text-sm text-gray-600 dark:text-gray-400",children:"أخطاء"})]}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:a.failed_syncs||0})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(g,{className:"w-6 h-6 text-blue-600"}),e.jsx("h3",{className:"text-sm text-gray-600 dark:text-gray-400",children:"آخر تحديث"})]}),e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:a.last_sync?new Date(a.last_sync).toLocaleString("ar-SA"):"لا يوجد"})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 mb-8",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white mb-6",children:"مخطط التدفق"}),e.jsx("div",{className:"flex items-center justify-center gap-4 flex-wrap",children:c.map((s,l)=>{const t=s.icon;return e.jsxs(_.Fragment,{children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:`${s.color} rounded-lg p-4 mb-2`,children:e.jsx(t,{className:"w-8 h-8 text-white"})}),e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:s.name})]}),l<c.length-1&&e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-8 h-0.5 bg-gray-300 dark:bg-gray-600"}),e.jsx(v,{className:"w-5 h-5 text-blue-600 mx-2"}),e.jsx("div",{className:"w-8 h-0.5 bg-gray-300 dark:bg-gray-600"})]})]},s.id)})})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white mb-6",children:"سجل الأحداث"}),i.length>0?e.jsx("div",{className:"space-y-3",children:i.slice(0,20).map((s,l)=>{const t=I(s.event_type),m=t.icon;return e.jsxs("div",{className:"flex items-start gap-4 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsx("div",{className:`p-2 rounded-full bg-white dark:bg-gray-800 ${t.color}`,children:e.jsx(m,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:t.label}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:s.timestamp?new Date(s.timestamp).toLocaleString("ar-SA"):""})]}),s.data&&e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[JSON.stringify(s.data).substring(0,100),"..."]}),s.status&&e.jsx("span",{className:`inline-block mt-2 px-2 py-1 text-xs font-semibold rounded-full ${s.status==="completed"?"bg-green-100 text-green-800":s.status==="failed"?"bg-red-100 text-red-800":"bg-blue-100 text-blue-800"}`,children:s.status==="completed"?"مكتمل":s.status==="failed"?"فشل":"جاري المعالجة"})]})]},l)})}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(h,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"لا توجد أحداث للعرض"})]})]})]})};export{B as IntegrationMonitor,B as default};
