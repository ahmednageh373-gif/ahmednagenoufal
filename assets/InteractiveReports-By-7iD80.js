var j=(b,h,n)=>new Promise((y,d)=>{var u=t=>{try{c(n.next(t))}catch(l){d(l)}},p=t=>{try{c(n.throw(t))}catch(l){d(l)}},c=t=>t.done?y(t.value):Promise.resolve(t.value).then(u,p);c((n=n.apply(b,h)).next())});import{r as i,j as e}from"./react-vendor-D4cZjflF.js";import{F as m,aB as f,h as F,aC as k,b as O,af as T,aa as L,a2 as A,a9 as D,ae as P}from"./icons-lib-DeXvYHHd.js";import"./vendor-DhnXlGBj.js";const $=()=>{const[b,h]=i.useState("executive_summary"),[n,y]=i.useState("1"),[d,u]=i.useState("json"),[p,c]=i.useState(!1),[t,l]=i.useState(null),[x,w]=i.useState(null),[v,N]=i.useState(!1),S=[{id:"executive_summary",name:"التقرير التنفيذي",icon:m},{id:"progress_report",name:"تقرير التقدم",icon:f},{id:"financial_report",name:"التقرير المالي",icon:F},{id:"variance_report",name:"تقرير الانحرافات",icon:k},{id:"resource_report",name:"تقرير الموارد",icon:f}],_=[{id:"json",name:"JSON",icon:O},{id:"pdf",name:"PDF",icon:m},{id:"excel",name:"Excel",icon:T},{id:"html",name:"HTML",icon:m}],C=()=>j(null,null,function*(){c(!0),l(null),N(!1),w(null);try{const r=window.location.origin.replace("3000","5000"),a=yield fetch(`${r}/api/reports/generate`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({report_type:b,project_id:parseInt(n),format:d,include_charts:!0,date_range:{start_date:"2024-01-01",end_date:"2024-12-31"}})});if(!a.ok)throw new Error("فشل إنشاء التقرير");const o=yield a.json();if(o.success)w(o.report),N(!0);else throw new Error(o.error||"خطأ في إنشاء التقرير")}catch(r){l(r.message)}finally{c(!1)}}),R=()=>j(null,null,function*(){if(x)try{const r=window.location.origin.replace("3000","5000"),a=yield fetch(`${r}/api/reports/export`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({report_id:x.report_id,format:d})});if(!a.ok)throw new Error("فشل تصدير التقرير");const o=yield a.blob(),g=window.URL.createObjectURL(o),s=document.createElement("a");s.href=g,s.download=`report_${x.report_id}.${d}`,document.body.appendChild(s),s.click(),document.body.removeChild(s),window.URL.revokeObjectURL(g)}catch(r){l(r.message)}}),E=r=>e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[e.jsxs("div",{className:"mb-6 pb-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:r.title}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(D,{className:"w-4 h-4"}),new Date(r.generated_at).toLocaleDateString("ar-SA")]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(m,{className:"w-4 h-4"}),r.report_type]})]})]}),r.summary&&e.jsxs("div",{className:"mb-6 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[e.jsx("h3",{className:"font-bold text-gray-900 dark:text-white mb-2",children:"ملخص تنفيذي"}),e.jsx("p",{className:"text-gray-700 dark:text-gray-300",children:r.summary})]}),r.sections&&r.sections.length>0&&e.jsx("div",{className:"space-y-6",children:r.sections.map((a,o)=>e.jsxs("div",{className:"border-b border-gray-200 dark:border-gray-700 pb-6 last:border-0",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-3",children:a.title}),a.content&&e.jsx("div",{className:"text-gray-700 dark:text-gray-300 mb-3",children:typeof a.content=="string"?e.jsx("p",{children:a.content}):e.jsx("pre",{className:"text-xs overflow-auto bg-gray-100 dark:bg-gray-700 p-4 rounded",children:JSON.stringify(a.content,null,2)})}),a.data&&e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:Object.entries(a.data).map(([g,s])=>e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 p-3 rounded-lg",children:[e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mb-1",children:g}),e.jsx("p",{className:"text-lg font-bold text-gray-900 dark:text-white",children:typeof s=="number"?s.toFixed(2):s})]},g))})]},o))}),e.jsx("div",{className:"mt-6 pt-4 border-t border-gray-200 dark:border-gray-700",children:e.jsxs("button",{onClick:R,className:"flex items-center gap-2 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(P,{className:"w-5 h-5"}),"تصدير التقرير (",d.toUpperCase(),")"]})})]});return e.jsxs("div",{className:"p-6 bg-gray-50 dark:bg-gray-900 min-h-screen",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-2",children:"التقارير التفاعلية"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"إنشاء وتصدير تقارير احترافية بصيغ متعددة"})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 mb-8",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"نوع التقرير"}),e.jsx("select",{value:b,onChange:r=>h(r.target.value),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:S.map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"صيغة التصدير"}),e.jsx("select",{value:d,onChange:r=>u(r.target.value),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:_.map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"المشروع"}),e.jsx("input",{type:"text",value:n,onChange:r=>y(r.target.value),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white",placeholder:"معرف المشروع"})]})]}),e.jsx("button",{onClick:C,disabled:p,className:"w-full md:w-auto flex items-center justify-center gap-2 px-8 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed",children:p?e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"w-5 h-5 animate-spin"}),"جاري الإنشاء..."]}):e.jsxs(e.Fragment,{children:[e.jsx(m,{className:"w-5 h-5"}),"إنشاء التقرير"]})})]}),t&&e.jsxs("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-8 flex items-center gap-2",children:[e.jsx(k,{className:"w-5 h-5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold",children:"خطأ"}),e.jsx("p",{children:t})]})]}),v&&!t&&e.jsxs("div",{className:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-8 flex items-center gap-2",children:[e.jsx(A,{className:"w-5 h-5"}),e.jsx("p",{className:"font-bold",children:"تم إنشاء التقرير بنجاح!"})]}),x&&E(x)]})};export{$ as InteractiveReports,$ as default};
