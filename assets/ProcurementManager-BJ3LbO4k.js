var C=Object.defineProperty,I=Object.defineProperties;var T=Object.getOwnPropertyDescriptors;var y=Object.getOwnPropertySymbols;var X=Object.prototype.hasOwnProperty,E=Object.prototype.propertyIsEnumerable;var O=(s,t,a)=>t in s?C(s,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[t]=a,k=(s,t)=>{for(var a in t||(t={}))X.call(t,a)&&O(s,a,t[a]);if(y)for(var a of y(t))E.call(t,a)&&O(s,a,t[a]);return s},w=(s,t)=>I(s,T(t));import{r as x,j as e}from"./react-vendor-D4cZjflF.js";import{O as M}from"./OrderModal-moLOB6PA.js";import{b as _,_ as P,P as $,$ as z,aq as A,n as F,ag as q,ah as K}from"./icons-lib-DeXvYHHd.js";import{v as R}from"./utils-lib-CuOuuFHP.js";import"./vendor-DhnXlGBj.js";const p={"Pending Approval":{title:"قيد الموافقة",color:"bg-amber-500"},Approved:{title:"معتمد",color:"bg-sky-500"},Ordered:{title:"تم الطلب",color:"bg-indigo-500"},Delivered:{title:"تم التسليم",color:"bg-green-500"},Cancelled:{title:"ملغي",color:"bg-slate-500"}},G=({order:s})=>e.jsxs("div",{className:"bg-white dark:bg-slate-800 p-3 rounded-lg border border-slate-200 dark:border-slate-700 shadow-sm",children:[e.jsx("p",{className:"font-semibold text-sm mb-1",children:s.itemName}),e.jsx("p",{className:"text-xs text-slate-500 mb-2",children:s.supplier}),e.jsxs("div",{className:"flex justify-between items-center text-xs",children:[e.jsxs("span",{className:"font-bold text-sky-600 dark:text-sky-400",children:[s.total.toLocaleString("ar-SA")," SAR"]}),e.jsx("span",{className:"text-slate-400",children:s.expectedDelivery})]})]}),J=({orders:s,onEdit:t,onDelete:a})=>e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-right responsive-table",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-slate-200 dark:border-slate-700 text-sm text-slate-500",children:[e.jsx("th",{className:"p-3",children:"البند"}),e.jsx("th",{className:"p-3",children:"المورد"}),e.jsx("th",{className:"p-3",children:"الحالة"}),e.jsx("th",{className:"p-3",children:"الكمية"}),e.jsx("th",{className:"p-3",children:"الإجمالي"}),e.jsx("th",{className:"p-3",children:"تاريخ الطلب"}),e.jsx("th",{className:"p-3"})]})}),e.jsx("tbody",{children:s.map(r=>e.jsxs("tr",{className:"border-b border-slate-200 dark:border-slate-700 last:border-b-0 hover:bg-slate-50 dark:hover:bg-slate-900/50",children:[e.jsx("td",{className:"p-3 font-medium","data-label":"البند",children:r.itemName}),e.jsx("td",{className:"p-3","data-label":"المورد",children:r.supplier}),e.jsx("td",{className:"p-3","data-label":"الحالة",children:e.jsx("span",{className:`px-2 py-1 text-xs font-semibold rounded-full text-white ${p[r.status].color}`,children:p[r.status].title})}),e.jsx("td",{className:"p-3","data-label":"الكمية",children:r.quantity}),e.jsx("td",{className:"p-3 font-mono","data-label":"الإجمالي",children:r.total.toLocaleString("ar-SA")}),e.jsx("td",{className:"p-3 font-mono","data-label":"تاريخ الطلب",children:r.orderDate}),e.jsx("td",{className:"p-3","data-label":"إجراءات",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>t(r),className:"text-slate-500 hover:text-sky-500 p-1",children:e.jsx(q,{size:16})}),e.jsx("button",{onClick:()=>a(r.id),className:"text-slate-500 hover:text-red-500 p-1",children:e.jsx(K,{size:16})})]})})]},r.id))})]})}),V=({orders:s,onUpdateOrders:t})=>{const[a,r]=x.useState(null),[j,N]=x.useState(null),h=n=>{n.preventDefault(),n.currentTarget.classList.add("kanban-column-drag-over")},v=n=>{n.currentTarget.classList.remove("kanban-column-drag-over")},f=(n,c)=>{var m;n.preventDefault(),n.currentTarget.classList.remove("kanban-column-drag-over");const l=n.dataTransfer.getData("text/plain");if(l&&((m=s.find(u=>u.id===l))==null?void 0:m.status)!==c){const u=s.map(b=>b.id===l?w(k({},b),{status:c}):b);t(u),N(l),setTimeout(()=>N(null),1e3)}r(null)};return e.jsx("div",{className:"w-full overflow-x-auto p-2",children:e.jsx("div",{className:"flex gap-6 min-w-max",children:Object.keys(p).map(n=>{const c=s.filter(l=>l.status===n);return e.jsxs("div",{onDragOver:h,onDragLeave:v,onDrop:l=>f(l,n),className:"w-72 bg-slate-50 dark:bg-slate-900/50 rounded-xl p-3 shrink-0 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${p[n].color}`}),e.jsx("h4",{className:"font-semibold text-sm text-slate-800 dark:text-slate-200",children:p[n].title}),e.jsx("span",{className:"text-sm font-semibold text-slate-500 mr-auto",children:c.length})]}),e.jsx("div",{className:"space-y-3",children:c.map(l=>e.jsx("div",{draggable:!0,onDragStart:m=>{m.dataTransfer.setData("text/plain",l.id),r(l.id)},onDragEnd:()=>r(null),className:`cursor-move ${a===l.id?"opacity-50":""} ${j===l.id?"card-drop-success":""}`,children:e.jsx(G,{order:l})},l.id))})]},n)})})})},Z=({project:s,onUpdatePurchaseOrders:t})=>{const a=s.data.purchaseOrders||[],[r,j]=x.useState("list"),[N,h]=x.useState(!1),[v,f]=x.useState(null),[n,c]=x.useState(""),l=x.useMemo(()=>a.filter(d=>d.itemName.toLowerCase().includes(n.toLowerCase())||d.supplier.toLowerCase().includes(n.toLowerCase())),[a,n]),m=d=>{let o;"id"in d&&d.id?o=a.map(g=>g.id===d.id?d:g):o=[...a,w(k({},d),{id:R()})],t(s.id,o)},u=d=>{window.confirm("هل أنت متأكد من حذف أمر الشراء هذا؟")&&t(s.id,a.filter(o=>o.id!==d))},b=d=>{t(s.id,d)},D=d=>{f(d),h(!0)},S=()=>{const d=l.map(i=>({ID:i.id,البند:i.itemName,المورد:i.supplier,الكمية:i.quantity,"سعر الوحدة":i.unitPrice,الإجمالي:i.total,"تاريخ الطلب":i.orderDate,"التسليم المتوقع":i.expectedDelivery,الحالة:p[i.status].title})),o=XLSX.utils.json_to_sheet(d),g=XLSX.utils.book_new();XLSX.utils.book_append_sheet(g,o,"Purchase Orders"),XLSX.writeFile(g,`purchase_orders_${s.name.replace(/\s/g,"_")}.xlsx`)},L=()=>{window.print()};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6 flex-wrap gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold text-slate-900 dark:text-white",children:"إدارة المشتريات"}),e.jsxs("p",{className:"mt-1 text-slate-500 dark:text-slate-400",children:["تتبع أوامر الشراء لمشروع: ",s.name]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:S,className:"flex items-center gap-2 bg-green-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-green-700",children:[e.jsx(_,{size:18}),e.jsx("span",{children:"تصدير Excel"})]}),e.jsxs("button",{onClick:L,className:"flex items-center gap-2 bg-gray-500 text-white font-semibold py-2 px-4 rounded-lg hover:bg-gray-600",children:[e.jsx(P,{size:18}),e.jsx("span",{children:"طباعة / PDF"})]}),e.jsxs("button",{onClick:()=>{f(null),h(!0)},className:"flex items-center gap-2 bg-sky-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-sky-700",children:[e.jsx($,{size:18}),e.jsx("span",{children:"أمر شراء جديد"})]})]})]}),e.jsxs("div",{className:"mb-4 flex items-center justify-between p-2 flex-wrap gap-2 bg-slate-100 dark:bg-slate-800 rounded-xl",children:[e.jsxs("div",{className:"relative",children:[e.jsx(z,{className:"absolute right-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"}),e.jsx("input",{type:"text",placeholder:"بحث في الطلبات...",value:n,onChange:d=>c(d.target.value),className:"w-64 bg-white dark:bg-slate-700 rounded-lg py-2 pr-10 pl-4 focus:outline-none focus:ring-2 focus:ring-sky-500 text-sm"})]}),e.jsxs("div",{className:"flex items-center gap-1 bg-white dark:bg-slate-700 p-1 rounded-lg",children:[e.jsx("button",{onClick:()=>j("list"),className:`p-2 rounded-md ${r==="list"?"bg-slate-100 dark:bg-slate-800 shadow-sm text-sky-600":"text-slate-500"}`,children:e.jsx(A,{size:18})}),e.jsx("button",{onClick:()=>j("board"),className:`p-2 rounded-md ${r==="board"?"bg-slate-100 dark:bg-slate-800 shadow-sm text-sky-600":"text-slate-500"}`,children:e.jsx(F,{size:18})})]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 p-4 rounded-xl shadow-md",children:[r==="list"?e.jsx(J,{orders:l,onEdit:D,onDelete:u}):e.jsx(V,{orders:l,onUpdateOrders:b}),l.length===0&&e.jsx("p",{className:"text-center p-8 text-slate-500",children:"لا توجد أوامر شراء مطابقة."})]}),e.jsx(M,{isOpen:N,onClose:()=>h(!1),onSave:m,order:v})]})};export{Z as ProcurementManager};
