var X=Object.defineProperty,J=Object.defineProperties;var Q=Object.getOwnPropertyDescriptors;var P=Object.getOwnPropertySymbols;var U=Object.prototype.hasOwnProperty,V=Object.prototype.propertyIsEnumerable;var T=(s,r,t)=>r in s?X(s,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[r]=t,u=(s,r)=>{for(var t in r||(r={}))U.call(r,t)&&T(s,t,r[t]);if(P)for(var t of P(r))V.call(r,t)&&T(s,t,r[t]);return s},p=(s,r)=>J(s,Q(r));var y=(s,r,t)=>new Promise((c,i)=>{var g=l=>{try{h(t.next(l))}catch(b){i(b)}},o=l=>{try{h(t.throw(l))}catch(b){i(b)}},h=l=>l.done?c(l.value):Promise.resolve(l.value).then(g,o);h((t=t.apply(s,r)).next())});import{r as d,j as e}from"./react-vendor-D4cZjflF.js";import{q as Y,r as Z,g as ee}from"./index-Cogjp2r_.js";import{k as ae}from"./utils-lib-CuOuuFHP.js";import{p as se,_ as te,aA as re,C as ne,X as le,R as j}from"./icons-lib-DeXvYHHd.js";import"./vendor-DhnXlGBj.js";import"./vendor-large-CMFjXBcn.js";import"./genai-lib-BGDjQqRJ.js";const ie=({isOpen:s,onClose:r,onSubmit:t,isLoading:c})=>{const[i,g]=d.useState({requirements:"High-quality finishes, completion within 12 months, budget adherence.",feasibility:"Feasibility study completed and approved. Land is secured.",stakeholders:"Owner, Main Contractor, Sub-contractors, Consultants, Local Authorities.",risks:"Potential material delivery delays, unexpected site conditions."});if(!s)return null;const o=l=>{g(p(u({},i),{[l.target.name]:l.target.value}))},h=l=>{l.preventDefault(),t(i)};return e.jsx("div",{className:"modal",style:{display:"block"},onClick:r,children:e.jsxs("div",{className:"modal-content p-8 max-w-2xl dark:bg-gray-800",onClick:l=>l.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"توليد ميثاق المشروع (AI)"}),e.jsx("button",{onClick:r,children:e.jsx(le,{size:24})})]}),e.jsx("p",{className:"mb-4 text-slate-500",children:"أدخل المعلومات الأساسية التالية لمساعدة الذكاء الاصطناعي على إنشاء ميثاق مشروع احترافي."}),e.jsxs("form",{onSubmit:h,className:"space-y-4",children:[e.jsx("textarea",{name:"requirements",value:i.requirements,onChange:o,placeholder:"المتطلبات عالية المستوى",rows:3,className:"w-full bg-gray-100 dark:bg-gray-700 p-2 rounded-lg"}),e.jsx("textarea",{name:"feasibility",value:i.feasibility,onChange:o,placeholder:"دراسة الجدوى",rows:3,className:"w-full bg-gray-100 dark:bg-gray-700 p-2 rounded-lg"}),e.jsx("textarea",{name:"stakeholders",value:i.stakeholders,onChange:o,placeholder:"أصحاب المصلحة الرئيسيون",rows:3,className:"w-full bg-gray-100 dark:bg-gray-700 p-2 rounded-lg"}),e.jsx("textarea",{name:"risks",value:i.risks,onChange:o,placeholder:"المخاطر الأولية",rows:3,className:"w-full bg-gray-100 dark:bg-gray-700 p-2 rounded-lg"}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx("button",{type:"button",onClick:r,className:"py-2 px-4 rounded-lg bg-gray-200 dark:bg-gray-600",children:"إلغاء"}),e.jsxs("button",{type:"submit",disabled:c,className:"py-2 px-4 rounded-lg bg-indigo-600 text-white flex items-center gap-2",children:[c?e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}):e.jsx(j,{size:18}),e.jsx("span",{children:c?"...جاري الإنشاء":"إنشاء الميثاق"})]})]})]})]})})},F={phases:[{title:"الإعداد والهيكلة",steps:["1. Introduction","2. WBS","3. WBS in P6"]},{title:"تخطيط الأنشطة",steps:["4. Adding Activities","5. Copy Activities","6. Coding and assign","7. Adding and assign Calendar"]},{title:"تقدير الموارد",steps:["8. Assign cost resource","9. Adding Manpower","10. Key dates WBS-Dur and Activity types","11. Engineering -Total Float","12. Work package -Estimate Durtaion","13. Finishings&MEPactivities + sequence"]},{title:"الإنهاء والتقارير",steps:["14. Summary of preparing baseline program","15. Crucial points and remarks","16. Create Cash flow and manpower Curves","17. Narrative report"]}]},ue=({project:s,onUpdateWorkflow:r})=>{var B,A;const[t,c]=d.useState(((B=s.data.workflow)==null?void 0:B.projectCharter)||""),[i,g]=d.useState(((A=s.data.workflow)==null?void 0:A.wbs)||""),[o,h]=d.useState("charter"),[l,b]=d.useState("lifecycle"),[L,G]=d.useState({}),[v,I]=d.useState({[F.phases[0].title]:!0}),[k,N]=d.useState(!1),[C,S]=d.useState(!1),[f,W]=d.useState(!1),[M,w]=d.useState(!1);d.useEffect(()=>{var a,n;c(((a=s.data.workflow)==null?void 0:a.projectCharter)||""),g(((n=s.data.workflow)==null?void 0:n.wbs)||"")},[s]);const $=()=>{var n,m;t!==(((n=s.data.workflow)==null?void 0:n.projectCharter)||"")||i!==(((m=s.data.workflow)==null?void 0:m.wbs)||"")?(r(s.id,{projectCharter:t,wbs:i}),alert("تم حفظ هيكل العمل!")):alert("لا توجد تغييرات لحفظها.")},q=a=>y(null,null,function*(){N(!0);try{const n=yield Y(s,a);c(n),w(!1)}catch(n){alert(`Failed to generate charter: ${n.message}`)}finally{N(!1)}}),z=()=>y(null,null,function*(){if(!(i&&!window.confirm("This will overwrite the current WBS. Are you sure?"))){S(!0);try{const a=yield ee(s);g(a)}catch(a){alert(`Failed to generate WBS: ${a.message}`)}finally{S(!1)}}}),E=()=>y(null,null,function*(){if(!(i&&!window.confirm("This will overwrite the current WBS. Are you sure?"))){if(s.data.schedule.length===0){alert("لا يمكن إنشاء هيكل WBS من الجدول الزمني لأن الجدول فارغ.");return}W(!0);try{const a=yield Z(s.data.schedule);g(a)}catch(a){alert(`فشل إنشاء هيكل WBS من الجدول الزمني: ${a.message}`)}finally{W(!1)}}}),D=()=>{window.print()},O=()=>e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700 mb-6 no-print",children:e.jsxs("nav",{className:"-mb-px flex space-x-4 rtl:space-x-reverse","aria-label":"Tabs",children:[e.jsx("button",{onClick:()=>h("charter"),className:`whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm ${o==="charter"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:border-gray-300"}`,children:"ميثاق المشروع"}),e.jsx("button",{onClick:()=>h("wbs"),className:`whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm ${o==="wbs"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:border-gray-300"}`,children:"هيكل تجزئة العمل (WBS)"})]})}),H()]}),_=()=>e.jsx("div",{className:"space-y-4",children:F.phases.map(a=>e.jsxs("div",{className:"bg-white dark:bg-gray-900/50 border border-gray-200 dark:border-gray-800 rounded-xl shadow-sm",children:[e.jsxs("button",{onClick:()=>I(n=>p(u({},n),{[a.title]:!n[a.title]})),className:"w-full flex justify-between items-center p-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:a.title}),e.jsx(ne,{className:`transition-transform ${v[a.title]?"rotate-180":""}`})]}),v[a.title]&&e.jsx("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700",children:a.steps.map(n=>e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"font-medium text-gray-800 dark:text-gray-200",children:n}),e.jsx("textarea",{value:L[n]||"",onChange:m=>G(x=>p(u({},x),{[n]:m.target.value})),placeholder:"...أضف ملاحظاتك هنا",rows:2,className:"w-full mt-1 bg-gray-50 dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded-lg p-2 text-sm focus:outline-none focus:ring-1 focus:ring-indigo-500"})]},n))})]},a.title))}),H=()=>{const a=o==="charter",n=a?t:i,m=a?c:g,x=a?k:C,R=a?()=>w(!0):z;return e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"no-print",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-xl font-semibold",children:a?"محتوى ميثاق المشروع":"محتوى هيكل تجزئة العمل"}),e.jsxs("div",{className:"flex gap-2",children:[o==="wbs"&&e.jsxs("button",{onClick:E,disabled:C||f||s.data.schedule.length===0,className:"flex items-center gap-2 bg-sky-600 text-white font-semibold py-2 px-3 rounded-lg hover:bg-sky-700 disabled:bg-slate-400 text-sm",children:[f?e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}):e.jsx(j,{size:16}),e.jsx("span",{children:"إنشاء من الجدول الزمني"})]}),e.jsxs("button",{onClick:R,disabled:x||o==="wbs"&&f,className:"flex items-center gap-2 bg-teal-600 text-white font-semibold py-2 px-3 rounded-lg hover:bg-teal-700 disabled:bg-slate-400 text-sm",children:[x?e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}):e.jsx(j,{size:16}),e.jsx("span",{children:a?"إنشاء بالذكاء الاصطناعي":"إنشاء من الوصف"})]})]})]}),e.jsx("textarea",{value:n,onChange:K=>m(K.target.value),className:"w-full h-[60vh] bg-gray-50 dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded-lg p-4 font-mono text-sm",placeholder:`أدخل ${a?"ميثاق المشروع":"هيكل تجزئة العمل"} هنا...`})]}),e.jsxs("div",{className:"printable-area",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"معاينة"}),e.jsx("div",{className:"prose prose-sm dark:prose-invert max-w-none h-[60vh] overflow-y-auto bg-white dark:bg-gray-900/50 border border-gray-200 dark:border-gray-800 rounded-lg p-4",dangerouslySetInnerHTML:{__html:ae.parse(n||"لا يوجد محتوى للعرض.")}})]})]})};return e.jsxs("div",{children:[e.jsxs("header",{className:"flex justify-between items-center mb-8 flex-wrap gap-4 no-print",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white flex items-center gap-3",children:[e.jsx(se,{}),"مهندس سير العمل"]}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-1",children:"إعداد وإنشاء وثائق ومنهجيات إدارة المشروع الأساسية."})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("select",{value:l,onChange:a=>b(a.target.value),className:"bg-gray-100 dark:bg-gray-800 border-gray-200 dark:border-gray-700 border rounded-lg p-2.5 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"lifecycle",children:"دورة حياة إدارة المشروع"}),e.jsx("option",{value:"baseline",children:"إعداد البرنامج الأساسي"})]}),e.jsxs("button",{onClick:D,className:"flex items-center gap-2 bg-gray-500 text-white font-semibold py-2 px-4 rounded-lg hover:bg-gray-600",children:[e.jsx(te,{size:18}),e.jsx("span",{children:"طباعة / PDF"})]}),l==="lifecycle"&&e.jsxs("button",{onClick:$,className:"flex items-center gap-2 bg-indigo-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-indigo-700 transition-colors",children:[e.jsx(re,{size:18}),e.jsx("span",{children:"حفظ التغييرات"})]})]})]}),l==="lifecycle"?O():e.jsx("div",{className:"printable-area",children:_()}),e.jsx(ie,{isOpen:M,onClose:()=>w(!1),onSubmit:q,isLoading:k})]})};export{ue as WorkflowArchitect};
