var w=(n,b,r)=>new Promise((u,i)=>{var y=t=>{try{x(r.next(t))}catch(g){i(g)}},j=t=>{try{x(r.throw(t))}catch(g){i(g)}},x=t=>t.done?u(t.value):Promise.resolve(t.value).then(y,j);x((r=r.apply(n,b)).next())});import{r as m,j as e}from"./react-vendor-D4cZjflF.js";import{o as _,h as f,a9 as p,a as C,u as N,aB as E,aW as F}from"./icons-lib-DeXvYHHd.js";import"./vendor-DhnXlGBj.js";const I=()=>{const[n,b]=m.useState("evm"),[r,u]=m.useState("1"),[i,y]=m.useState(null),[j,x]=m.useState(!1),[t,g]=m.useState(null),k=[{id:"evm",name:"تحليل القيمة المكتسبة (EVM)",icon:_},{id:"financial",name:"التحليل المالي",icon:f},{id:"schedule",name:"تحليل الجدول الزمني",icon:p},{id:"kpis",name:"مؤشرات الأداء الرئيسية",icon:C}],v=()=>w(null,null,function*(){x(!0),g(null);try{const a=window.location.origin.replace("3000","5000");let s="";switch(n){case"evm":s="/api/analytics/evm";break;case"financial":s="/api/analytics/financial";break;case"schedule":s="/api/analytics/schedule";break;case"kpis":s="/api/analytics/kpis";break}const l=yield fetch(`${a}${s}?project_id=${r}`,{method:"GET"});if(!l.ok)throw new Error("فشل تحميل البيانات");const o=yield l.json();if(o.success)y(o);else throw new Error(o.error||"خطأ في تحميل البيانات")}catch(a){g(a.message)}finally{x(!1)}});m.useEffect(()=>{v()},[n,r]);const c=({title:a,value:s,subtitle:l,icon:o,trend:d,status:h})=>e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"bg-blue-100 dark:bg-blue-900 rounded-full p-3",children:e.jsx(o,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"})}),h&&e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-semibold ${h==="good"?"bg-green-100 text-green-800":h==="warning"?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:h==="good"?"جيد":h==="warning"?"تحذير":"خطر"})]}),e.jsx("h3",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:a}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-1",children:s}),l&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:l}),d!==void 0&&e.jsxs("div",{className:`flex items-center gap-1 mt-2 text-sm ${d>0?"text-green-600":d<0?"text-red-600":"text-gray-600"}`,children:[d>0?e.jsx(N,{className:"w-4 h-4"}):d<0?e.jsx(F,{className:"w-4 h-4"}):null,e.jsxs("span",{children:[Math.abs(d).toFixed(1),"%"]})]})]}),A=a=>{const s=(l,o,d)=>l>=o?"good":l>=d?"warning":"danger";return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8",children:[e.jsx(c,{title:"القيمة المخططة (PV)",value:`${(a.planned_value/1e6).toFixed(2)}M SAR`,icon:p,status:"good"}),e.jsx(c,{title:"القيمة المكتسبة (EV)",value:`${(a.earned_value/1e6).toFixed(2)}M SAR`,icon:N,status:s(a.schedule_performance_index,1,.9)}),e.jsx(c,{title:"التكلفة الفعلية (AC)",value:`${(a.actual_cost/1e6).toFixed(2)}M SAR`,icon:f,status:s(a.cost_performance_index,1,.9)})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsx(c,{title:"مؤشر أداء التكلفة (CPI)",value:a.cost_performance_index.toFixed(2),subtitle:a.cost_performance_index>=1?"ضمن الميزانية":"تجاوز الميزانية",icon:f,status:s(a.cost_performance_index,1,.9)}),e.jsx(c,{title:"مؤشر أداء الجدول (SPI)",value:a.schedule_performance_index.toFixed(2),subtitle:a.schedule_performance_index>=1?"على المسار":"متأخر",icon:p,status:s(a.schedule_performance_index,1,.9)}),e.jsx(c,{title:"انحراف التكلفة (CV)",value:`${(a.cost_variance/1e6).toFixed(2)}M SAR`,subtitle:a.cost_variance>=0?"توفير":"تجاوز",icon:N,status:a.cost_variance>=0?"good":"danger"}),e.jsx(c,{title:"انحراف الجدول (SV)",value:`${(a.schedule_variance/1e6).toFixed(2)}M SAR`,subtitle:a.schedule_variance>=0?"متقدم":"متأخر",icon:p,status:a.schedule_variance>=0?"good":"danger"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4 text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(_,{className:"w-5 h-5"}),"التقديرات المستقبلية"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"التكلفة المتوقعة (EAC)"}),e.jsxs("span",{className:"text-lg font-bold text-gray-900 dark:text-white",children:[(a.estimate_at_completion/1e6).toFixed(2),"M SAR"]})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"التكلفة المتبقية (ETC)"}),e.jsxs("span",{className:"text-lg font-bold text-gray-900 dark:text-white",children:[(a.estimate_to_complete/1e6).toFixed(2),"M SAR"]})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"الانحراف عند الإنجاز (VAC)"}),e.jsxs("span",{className:`text-lg font-bold ${a.variance_at_completion>=0?"text-green-600":"text-red-600"}`,children:[(a.variance_at_completion/1e6).toFixed(2),"M SAR"]})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4 text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(E,{className:"w-5 h-5"}),"مؤشر الأداء المطلوب"]}),e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"inline-block bg-gradient-to-br from-blue-500 to-purple-600 rounded-full p-8 mb-4",children:e.jsx("span",{className:"text-5xl font-bold text-white",children:a.to_complete_performance_index.toFixed(2)})}),e.jsx("p",{className:"text-lg text-gray-600 dark:text-gray-400 mb-2",children:"مؤشر الأداء المطلوب للإنجاز (TCPI)"}),e.jsx("p",{className:`text-sm font-semibold ${a.to_complete_performance_index<=1?"text-green-600":a.to_complete_performance_index<=1.1?"text-yellow-600":"text-red-600"}`,children:a.to_complete_performance_index<=1?"قابل للتحقيق":a.to_complete_performance_index<=1.1?"يتطلب جهد إضافي":"صعب التحقيق"})]})]})]})]})},S=a=>e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"بيانات التحليل متاحة"}),e.jsx("pre",{className:"text-xs overflow-auto bg-gray-100 dark:bg-gray-700 p-4 rounded",children:JSON.stringify(a,null,2)})]});return e.jsxs("div",{className:"p-6 bg-gray-50 dark:bg-gray-900 min-h-screen",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-2",children:"التحليلات المتقدمة"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"تحليل شامل لأداء المشروع والتوقعات المستقبلية"})]}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-4 mb-8",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"نوع التحليل"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:k.map(a=>{const s=a.icon;return e.jsxs("button",{onClick:()=>b(a.id),className:`flex items-center gap-2 px-4 py-2 rounded-lg transition-colors ${n===a.id?"bg-blue-600 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"}`,children:[e.jsx(s,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:a.name})]},a.id)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"المشروع"}),e.jsx("input",{type:"text",value:r,onChange:a=>u(a.target.value),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white",placeholder:"معرف المشروع"})]})]})}),j?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):t?e.jsxs("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded",children:[e.jsx("p",{className:"font-bold",children:"خطأ"}),e.jsx("p",{children:t})]}):i?e.jsxs("div",{children:[n==="evm"&&i.evm&&A(i.evm),n!=="evm"&&S(i)]}):null]})};export{I as AdvancedAnalytics,I as default};
