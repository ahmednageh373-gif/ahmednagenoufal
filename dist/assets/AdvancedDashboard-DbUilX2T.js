var _=(a,j,d)=>new Promise((y,g)=>{var h=i=>{try{n(d.next(i))}catch(c){g(c)}},m=i=>{try{n(d.throw(i))}catch(c){g(c)}},n=i=>i.done?y(i.value):Promise.resolve(i.value).then(h,m);n((d=d.apply(a,j)).next())});import{r as o,j as e}from"./react-vendor-D4cZjflF.js";import{o as p,l as u,aB as x,a as S,a9 as C,h as v,u as E,aH as N,b7 as F}from"./icons-lib-DeXvYHHd.js";import"./vendor-DhnXlGBj.js";const B=()=>{const[a,j]=o.useState("company_owner"),[d,y]=o.useState(null),[g,h]=o.useState(!0),[m,n]=o.useState(null),i=[{id:"company_owner",name:"صاحب الشركة",icon:p},{id:"project_manager",name:"مدير المشروع",icon:u},{id:"site_engineer",name:"مهندس الموقع",icon:x},{id:"execution_engineer",name:"مهندس التنفيذ",icon:S},{id:"supervisor",name:"مشرف",icon:u},{id:"planning_engineer",name:"مهندس التخطيط",icon:C},{id:"cost_control",name:"كنترول كوست",icon:v},{id:"technical_office",name:"المكتب الفني",icon:x},{id:"accounts_finance",name:"الحسابات والمالية",icon:v}];o.useEffect(()=>{c()},[a]);const c=()=>_(null,null,function*(){h(!0),n(null);try{const r=window.location.origin.replace("3000","5000"),s=yield fetch(`${r}/api/dashboards/${a}?user_id=1&project_id=1`);if(!s.ok)throw new Error("فشل تحميل البيانات");const t=yield s.json();if(t.success)y(t.dashboard);else throw new Error(t.error||"خطأ في تحميل البيانات")}catch(r){n(r.message)}finally{h(!1)}}),l=({title:r,value:s,icon:t,color:D,trend:b})=>e.jsx("div",{className:`bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 border-t-4 ${D}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:r}),e.jsx("h3",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:s}),b&&e.jsxs("p",{className:`text-sm mt-2 ${b>0?"text-green-600":"text-red-600"}`,children:[b>0?"↑":"↓"," ",Math.abs(b),"%"]})]}),e.jsx("div",{className:"bg-blue-100 dark:bg-blue-900 rounded-full p-3",children:e.jsx(t,{className:"w-8 h-8 text-blue-600 dark:text-blue-400"})})]})}),w=r=>{const s=r.summary||{};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsx(l,{title:"إجمالي المشاريع",value:s.total_projects||0,icon:p,color:"border-blue-500"}),e.jsx(l,{title:"المشاريع النشطة",value:s.active_projects||0,icon:x,color:"border-green-500"}),e.jsx(l,{title:"صافي الربح",value:`${((s.net_profit||0)/1e6).toFixed(1)}M SAR`,icon:v,color:"border-purple-500"}),e.jsx(l,{title:"هامش الربح",value:`${(s.profit_margin||0).toFixed(1)}%`,icon:E,color:"border-orange-500"})]}),r.project_health&&r.project_health.length>0&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[e.jsx("h3",{className:"text-xl font-bold mb-4 text-gray-900 dark:text-white",children:"صحة المشاريع"}),e.jsx("div",{className:"space-y-4",children:r.project_health.map(t=>e.jsxs("div",{className:"border-b border-gray-200 dark:border-gray-700 pb-4 last:border-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white",children:t.project_name}),e.jsxs("span",{className:`px-3 py-1 rounded-full text-sm font-semibold ${t.health_score>=80?"bg-green-100 text-green-800":t.health_score>=60?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:[t.health_score,"/100"]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"الجدول"}),e.jsxs("p",{className:t.schedule_variance<0?"text-green-600":"text-red-600",children:[t.schedule_variance," يوم"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"التكلفة"}),e.jsxs("p",{className:t.cost_variance<0?"text-green-600":"text-red-600",children:[t.cost_variance.toFixed(1),"%"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"الجودة"}),e.jsxs("p",{className:"text-gray-900 dark:text-white",children:[t.quality_score,"/100"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"السلامة"}),e.jsxs("p",{className:"text-gray-900 dark:text-white",children:[t.safety_score,"/100"]})]})]})]},t.project_id))})]})]})},f=r=>{const s=r.overview||{};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsx(l,{title:"التقدم",value:`${(s.current_progress||0).toFixed(1)}%`,icon:x,color:"border-blue-500"}),e.jsx(l,{title:"فريق العمل",value:s.team_size||0,icon:u,color:"border-green-500"}),e.jsx(l,{title:"الأيام المتبقية",value:s.days_remaining||0,icon:N,color:"border-orange-500"}),e.jsx(l,{title:"المقاولون",value:s.active_subcontractors||0,icon:p,color:"border-purple-500"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[e.jsx("h3",{className:"text-xl font-bold mb-4 text-gray-900 dark:text-white",children:"حالة الجدول"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"حالة الجدول"}),e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-semibold ${s.schedule_status==="on_track"?"bg-green-100 text-green-800":s.schedule_status==="at_risk"?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:s.schedule_status==="on_track"?"على المسار":s.schedule_status==="at_risk"?"في خطر":"متأخر"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"حالة الميزانية"}),e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-semibold ${s.budget_status==="within_budget"?"bg-green-100 text-green-800":s.budget_status==="slight_overrun"?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:s.budget_status==="within_budget"?"ضمن الميزانية":s.budget_status==="slight_overrun"?"تجاوز طفيف":"تجاوز كبير"})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[e.jsx("h3",{className:"text-xl font-bold mb-4 text-gray-900 dark:text-white",children:"الإنجازات"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"المعالم المكتملة"}),e.jsx("span",{className:"text-xl font-bold text-gray-900 dark:text-white",children:s.milestones_completed||0})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"المعالم المتبقية"}),e.jsx("span",{className:"text-xl font-bold text-gray-900 dark:text-white",children:s.milestones_remaining||0})]})]})]})]})]})},k=r=>{const s=r.daily_activities||{};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsx(l,{title:"العمال اليوم",value:s.total_workers||0,icon:u,color:"border-blue-500"}),e.jsx(l,{title:"الأنشطة الجارية",value:s.activities_today||0,icon:x,color:"border-green-500"}),e.jsx(l,{title:"التقارير الميدانية",value:s.daily_reports_count||0,icon:F,color:"border-orange-500"}),e.jsx(l,{title:"نسبة الحضور",value:`${((s.attendance_rate||0)*100).toFixed(0)}%`,icon:N,color:"border-purple-500"})]})})},$=r=>e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"لوحة التحكم لهذا الدور قيد التطوير"}),e.jsx("pre",{className:"mt-4 text-xs overflow-auto",children:JSON.stringify(r,null,2)})]});return e.jsxs("div",{className:"p-6 bg-gray-50 dark:bg-gray-900 min-h-screen",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-2",children:"لوحة التحكم المتقدمة"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"اختر الدور لعرض لوحة التحكم المخصصة"})]}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-4 mb-8",children:e.jsx("div",{className:"flex flex-wrap gap-3",children:i.map(r=>{const s=r.icon;return e.jsxs("button",{onClick:()=>j(r.id),className:`flex items-center gap-2 px-4 py-2 rounded-lg transition-colors ${a===r.id?"bg-blue-600 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"}`,children:[e.jsx(s,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:r.name})]},r.id)})})}),g?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):m?e.jsxs("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded",children:[e.jsx("p",{className:"font-bold",children:"خطأ"}),e.jsx("p",{children:m})]}):d?e.jsxs("div",{children:[e.jsx("div",{className:"mb-6",children:e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:d.title})}),a==="company_owner"&&w(d),a==="project_manager"&&f(d),a==="site_engineer"&&k(d),(a==="execution_engineer"||a==="supervisor"||a==="planning_engineer"||a==="cost_control"||a==="technical_office"||a==="accounts_finance")&&$(d)]}):null]})};export{B as AdvancedDashboard,B as default};
