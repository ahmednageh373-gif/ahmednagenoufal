var j=Object.defineProperty;var S=Object.getOwnPropertySymbols;var A=Object.prototype.hasOwnProperty,R=Object.prototype.propertyIsEnumerable;var D=(m,t,e)=>t in m?j(m,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):m[t]=e,y=(m,t)=>{for(var e in t||(t={}))A.call(t,e)&&D(m,e,t[e]);if(S)for(var e of S(t))R.call(t,e)&&D(m,e,t[e]);return m};var x=(m,t,e)=>new Promise((s,o)=>{var a=r=>{try{c(e.next(r))}catch(n){o(n)}},i=r=>{try{c(e.throw(r))}catch(n){o(n)}},c=r=>r.done?s(r.value):Promise.resolve(r.value).then(a,i);c((e=e.apply(m,t)).next())});import{r as w,j as l}from"./react-vendor-ITqvX6Xp.js";import{t as v,s as T,d as b,a as F,b as N}from"./tf-lib-rRcOV4v_.js";import"./vendor-8CkhJSGZ.js";import{M as k}from"./index-ClqhgGpL.js";import{_ as P,K as C}from"./icons-lib-Dd_BpYQ6.js";import"./vendor-large-gsDFeA65.js";import"./genai-lib-pAIF5Ws4.js";import"./utils-lib-C_gzCXPI.js";class I{constructor(){this.model=null,this.scaler=null}trainModel(t){return x(this,null,function*(){console.log("ğŸ¤– Ø¨Ø¯Ø¡ ØªØ¯Ø±ÙŠØ¨ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ...");const e=t.map(r=>this.extractFeatures(r)),s=t.map(r=>r.actualCost),{normalizedFeatures:o,scaler:a}=this.normalizeData(e);this.scaler=a;const i=v(o),c=v(s.map(r=>[r]));this.model=T({layers:[b({inputShape:[e[0].length],units:64,activation:"relu",kernelInitializer:"heNormal"}),F({rate:.2}),b({units:32,activation:"relu"}),F({rate:.2}),b({units:16,activation:"relu"}),b({units:1,activation:"linear"})]}),this.model.compile({optimizer:N.adam(.001),loss:"meanSquaredError",metrics:["mae"]}),yield this.model.fit(i,c,{epochs:100,batchSize:32,validationSplit:.2,callbacks:{onEpochEnd:(r,n)=>{r%10===0&&console.log(`ğŸ“Š Epoch ${r}: Loss = ${n==null?void 0:n.loss.toFixed(4)}`)}}}),console.log("âœ… Ø§ÙƒØªÙ…Ù„ ØªØ¯Ø±ÙŠØ¨ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø¨Ù†Ø¬Ø§Ø­!"),i.dispose(),c.dispose()})}extractFeatures(t){return[this.encodeProjectType(t.type),t.totalArea,t.complexity,this.encodeLocation(t.location),this.getSeasonality(new Date),this.getMaterialPriceIndex(),this.getLaborAvailability(t.location),t.duration,t.budget/t.totalArea]}encodeProjectType(t){return{Residential:1,Commercial:2,Industrial:3,Infrastructure:4}[t]||0}encodeLocation(t){return{Ø§Ù„Ø±ÙŠØ§Ø¶:1,Ø¬Ø¯Ø©:1.1,Ø§Ù„Ø¯Ù…Ø§Ù…:1.05,Ù…ÙƒØ©:1.15,Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©:1.12}[t.city]||1}getSeasonality(t){const e=t.getMonth();return e>=5&&e<=7?.85:e>=11||e<=1?1.1:1}getMaterialPriceIndex(){return 1.08}getLaborAvailability(t){return .95}normalizeData(t){const e=t[0].length,s=[],o=[];for(let i=0;i<e;i++){const c=t.map(n=>n[i]);s[i]=c.reduce((n,d)=>n+d,0)/c.length;const r=c.reduce((n,d)=>n+Math.pow(d-s[i],2),0)/c.length;o[i]=Math.sqrt(r)}return{normalizedFeatures:t.map(i=>i.map((c,r)=>(c-s[r])/(o[r]||1))),scaler:{mean:s,std:o}}}predict(t){return x(this,null,function*(){if(!this.model||!this.scaler)throw new Error("Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ ØºÙŠØ± Ù…Ø¯Ø±Ø¨! ÙŠØ±Ø¬Ù‰ ØªØ¯Ø±ÙŠØ¨ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø£ÙˆÙ„Ø§Ù‹.");const s=this.extractFeatures(t).map((u,h)=>(u-this.scaler.mean[h])/(this.scaler.std[h]||1)),o=v([s]),a=this.model.predict(o),i=(yield a.data())[0],c=[];for(let u=0;u<100;u++){const h=this.model.predict(o,{training:!0});c.push((yield h.data())[0]),h.dispose()}const r=c.sort((u,h)=>u-h),n=r[Math.floor(c.length*.05)],d=r[Math.floor(c.length*.95)],p=1-(d-n)/i;o.dispose(),a.dispose();const g=this.analyzeInfluenceFactors(t,i);return{predictedCost:i,confidence:Math.max(0,Math.min(1,p)),lowerBound:n,upperBound:d,factors:g}})}analyzeInfluenceFactors(t,e){const s=[],o=this.encodeLocation(t.location);o>1.05&&s.push({name:"Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ",impact:(o-1)*100,description:`Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ ÙÙŠ ${t.location.city} ÙŠØ²ÙŠØ¯ Ø§Ù„ØªÙƒÙ„ÙØ© Ø¨Ù†Ø³Ø¨Ø© ${((o-1)*100).toFixed(1)}%`}),t.complexity>7&&s.push({name:"ØªØ¹Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹",impact:(t.complexity-5)*5,description:`Ø§Ù„ØªØ¹Ù‚ÙŠØ¯ Ø§Ù„Ø¹Ø§Ù„ÙŠ Ù„Ù„Ù…Ø´Ø±ÙˆØ¹ ÙŠØ²ÙŠØ¯ Ø§Ù„ØªÙƒÙ„ÙØ© Ø¨Ù†Ø³Ø¨Ø© ${((t.complexity-5)*5).toFixed(1)}%`});const a=this.getSeasonality(new Date);a<1&&s.push({name:"Ø§Ù„Ù…ÙˆØ³Ù…",impact:(a-1)*100,description:"Ø§Ù„ØªÙ†ÙÙŠØ° ÙÙŠ ÙØµÙ„ Ø§Ù„ØµÙŠÙ ÙŠÙ‚Ù„Ù„ Ø§Ù„Ø¥Ù†ØªØ§Ø¬ÙŠØ© Ø¨Ù†Ø³Ø¨Ø© 15%"});const i=this.getMaterialPriceIndex();return i>1.05&&s.push({name:"Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ù…ÙˆØ§Ø¯",impact:(i-1)*100,description:`Ø§Ø±ØªÙØ§Ø¹ Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ù…ÙˆØ§Ø¯ Ø¨Ù†Ø³Ø¨Ø© ${((i-1)*100).toFixed(1)}%`}),s}}class L{predictDuration(t,e){return x(this,null,function*(){const s=e.filter(h=>h.type===t.type&&Math.abs(h.totalArea-t.totalArea)/t.totalArea<.3),o=s.length>0?s.reduce((h,f)=>h+f.totalArea/f.actualDuration,0)/s.length:100,a=t.totalArea/o;let i=1+(t.complexity-5)*.05,c=this.getWeatherImpactFactor(t.location),r=this.getSeasonality(new Date);const n=a*.8,d=a*i*c*r,p=a*1.5*i,g=(n+4*d+p)/6,u=this.identifyDurationRisks(t,e);return{estimatedDuration:Math.round(g),optimistic:Math.round(n),mostLikely:Math.round(d),pessimistic:Math.round(p),risks:u}})}getWeatherImpactFactor(t){return["Ø¬Ø¯Ø©","Ø§Ù„Ø¯Ù…Ø§Ù…","Ø§Ù„Ø®Ø¨Ø±"].includes(t.city)?1.08:1}getSeasonality(t){const e=t.getMonth();return e>=5&&e<=7?1.15:e>=11||e<=1?.95:1}identifyDurationRisks(t,e){const s=[],o=this.assessWeatherRisk(t.location);return o.probability>.3&&s.push(o),t.complexity>7&&s.push({type:"Technical",description:"ØªØ¹Ù‚ÙŠØ¯ ÙÙ†ÙŠ Ø¹Ø§Ù„ÙŠ Ù‚Ø¯ ÙŠØ³Ø¨Ø¨ ØªØ£Ø®ÙŠØ±Ø§Øª",probability:.4,impact:15,mitigation:"ØªØ¹ÙŠÙŠÙ† Ù…Ù‡Ù†Ø¯Ø³ÙŠÙ† Ø°ÙˆÙŠ Ø®Ø¨Ø±Ø© Ø¹Ø§Ù„ÙŠØ©"}),s.push({type:"Supply",description:"Ø§Ø­ØªÙ…Ø§Ù„ ØªØ£Ø®ÙŠØ± ØªÙˆØ±ÙŠØ¯ Ø§Ù„Ù…ÙˆØ§Ø¯",probability:.25,impact:10,mitigation:"Ø§Ù„ØªØ¹Ø§Ù‚Ø¯ Ù…Ø¹ Ù…ÙˆØ±Ø¯ÙŠÙ† Ø§Ø­ØªÙŠØ§Ø·ÙŠÙŠÙ†"}),s}assessWeatherRisk(t){const e=new Date().getMonth();return e>=5&&e<=7?{type:"Weather",description:"Ø¯Ø±Ø¬Ø§Øª Ø­Ø±Ø§Ø±Ø© Ø¹Ø§Ù„ÙŠØ© ØªÙ‚Ù„Ù„ Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„",probability:.7,impact:20,mitigation:"Ø§Ù„Ø¹Ù…Ù„ ÙÙŠ ÙØªØ±Ø§Øª Ø§Ù„ØµØ¨Ø§Ø­ Ø§Ù„Ø¨Ø§ÙƒØ± ÙˆØ§Ù„Ù…Ø³Ø§Ø¡"}:{type:"Weather",description:"Ø·Ù‚Ø³ Ù…Ù†Ø§Ø³Ø¨ Ù„Ù„Ø¹Ù…Ù„",probability:.1,impact:2,mitigation:"Ù„Ø§ ÙŠÙˆØ¬Ø¯"}}}class E{optimizeSchedule(t,e){console.log("ğŸ§¬ Ø¨Ø¯Ø¡ ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø²Ù…Ù†ÙŠ...");const s=50,o=100,a=.1;let i=this.initializePopulation(t,s);for(let u=0;u<o;u++){const h=i.map(M=>this.calculateFitness(M,e)),f=this.selection(i,h),z=this.crossover(f);if(i=this.mutation(z,a),u%20===0){const M=Math.max(...h);console.log(`ğŸ”„ Ø§Ù„Ø¬ÙŠÙ„ ${u}: Ø£ÙØ¶Ù„ Ù„ÙŠØ§Ù‚Ø© = ${M.toFixed(2)}`)}}const c=i.map(u=>this.calculateFitness(u,e)),r=c.indexOf(Math.max(...c)),n=i[r],d=this.calculateTotalDuration(t),p=this.calculateTotalDuration(n),g=(d-p)/d*100;return console.log(`âœ… Ø§ÙƒØªÙ…Ù„ Ø§Ù„ØªØ­Ø³ÙŠÙ†! ØªØ­Ø³ÙŠÙ† Ø¨Ù†Ø³Ø¨Ø© ${g.toFixed(1)}%`),{activities:n,totalDuration:p,improvement:g,resourceUtilization:this.calculateResourceUtilization(n),criticalPath:this.findCriticalPath(n)}}initializePopulation(t,e){const s=[];for(let o=0;o<e;o++){const a=[...t];for(let i=0;i<a.length;i++)if(Math.random()<.3){const c=Math.floor(Math.random()*a.length);[a[i],a[c]]=[a[c],a[i]]}s.push(a)}return s}calculateFitness(t,e){let s=1e3;const o=this.calculateTotalDuration(t);s-=o*.5;for(const i of e)this.checkConstraint(t,i)||(s-=100);const a=this.calculateResourceUtilization(t);return s+=a*50,Math.max(0,s)}selection(t,e){const s=[];for(let a=0;a<t.length;a++){const i=[];for(let r=0;r<3;r++)i.push(Math.floor(Math.random()*t.length));const c=i.reduce((r,n)=>e[n]>e[r]?n:r);s.push([...t[c]])}return s}crossover(t){const e=[];for(let s=0;s<t.length;s+=2)if(s+1<t.length){const o=t[s],a=t[s+1],i=Math.floor(Math.random()*o.length),c=[...o.slice(0,i),...a.slice(i)],r=[...a.slice(0,i),...o.slice(i)];e.push(c,r)}else e.push([...t[s]]);return e}mutation(t,e){return t.map(s=>{if(Math.random()<e){const o=[...s],a=Math.floor(Math.random()*o.length),i=Math.floor(Math.random()*o.length);return[o[a],o[i]]=[o[i],o[a]],o}return s})}calculateTotalDuration(t){let e=0;const s=new Map;for(const o of t){let a=0;o.predecessors&&o.predecessors.length>0&&(a=Math.max(...o.predecessors.map(c=>s.get(c)||0)));const i=a+o.duration;s.set(o.id,i),e=Math.max(e,i)}return e}calculateResourceUtilization(t){const e=new Map;for(const a of t)if(a.resources)for(const i of a.resources)e.has(i)||e.set(i,[]),e.get(i).push(a.duration);let s=0,o=0;for(const[a,i]of e){const c=i.reduce((r,n)=>r+n,0)/i.length;s+=Math.min(1,c/8),o++}return o>0?s/o:0}findCriticalPath(t){const e=[],s=new Map;for(const a of t){let i=0;a.predecessors&&a.predecessors.length>0&&(i=Math.max(...a.predecessors.map(c=>s.get(c)||0))),s.set(a.id,i+a.duration)}const o=Math.max(...Array.from(s.values()));for(const[a,i]of s)Math.abs(i-o)<.1&&e.push(a);return e}checkConstraint(t,e){switch(e.type){case"MaxDuration":return this.calculateTotalDuration(t)<=e.value;case"ResourceLimit":return this.calculateResourceUtilization(t)<=e.value;default:return!0}}}const H=({project:m})=>{const[t,e]=w.useState("cost"),[s,o]=w.useState(!1),[a,i]=w.useState(null),c=k.map((n,d)=>({id:n.id,name:n.name,type:"Residential",location:{city:"Ø§Ù„Ø±ÙŠØ§Ø¶",region:"Central",latitude:24.7,longitude:46.6},totalArea:400+d*100,budget:15e5+d*1e5,duration:365,complexity:6,actualCost:165e4+d*12e4,actualDuration:400+d*10,delayReasons:[],costOverrunReasons:[],weatherImpact:.8,qualityScore:4,safetyScore:4})),r=()=>x(null,null,function*(){o(!0),i(null);try{if(t==="cost"){const n=new I;yield n.trainModel(c);const d={id:"new-proj",name:"Ù…Ø´Ø±ÙˆØ¹ Ø¬Ø¯ÙŠØ¯ Ù…Ù‚ØªØ±Ø­",type:"Residential",location:{city:"Ø§Ù„Ø±ÙŠØ§Ø¶",region:"Central",latitude:24.7,longitude:46.6},totalArea:500,budget:2e6,duration:365,complexity:7},p=yield n.predict(d);i(y({type:"cost"},p))}else if(t==="duration"){const n=new L,d={id:"new-proj",name:"Ù…Ø´Ø±ÙˆØ¹ Ø¬Ø¯ÙŠØ¯ Ù…Ù‚ØªØ±Ø­",type:"Residential",location:{city:"Ø§Ù„Ø±ÙŠØ§Ø¶",region:"Central",latitude:24.7,longitude:46.6},totalArea:500,budget:2e6,duration:365,complexity:7},p=yield n.predictDuration(d,c);i(y({type:"duration"},p))}else if(t==="schedule"){const n=new E,d=m.data.schedule.map(g=>({id:String(g.id),name:g.name,duration:Math.ceil((new Date(g.end).getTime()-new Date(g.start).getTime())/(1e3*60*60*24))+1,predecessors:g.dependencies.map(String)})),p=n.optimizeSchedule(d,[]);i(y({type:"schedule"},p))}}catch(n){console.error("Analysis failed:",n),i({error:n.message})}finally{o(!1)}});return l.jsxs("div",{className:"space-y-6",children:[l.jsx("h1",{className:"text-3xl font-bold",children:"Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø© ÙˆØ§Ù„ØªØ­Ø³ÙŠÙ†"}),l.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700",children:l.jsxs("nav",{className:"-mb-px flex space-x-4","aria-label":"Tabs",children:[l.jsx("button",{onClick:()=>e("cost"),className:`whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm ${t==="cost"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:border-gray-300"}`,children:"Ø§Ù„ØªÙ†Ø¨Ø¤ Ø¨Ø§Ù„ØªÙƒØ§Ù„ÙŠÙ"}),l.jsx("button",{onClick:()=>e("duration"),className:`whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm ${t==="duration"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:border-gray-300"}`,children:"Ø§Ù„ØªÙ†Ø¨Ø¤ Ø¨Ø§Ù„Ù…Ø¯Ø©"}),l.jsx("button",{onClick:()=>e("schedule"),className:`whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm ${t==="schedule"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:border-gray-300"}`,children:"ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø²Ù…Ù†ÙŠ"})]})}),l.jsxs("div",{className:"bg-white dark:bg-gray-900/50 p-6 rounded-xl shadow-sm text-center",children:[l.jsxs("button",{onClick:r,disabled:s,className:"flex items-center justify-center gap-2 bg-indigo-600 text-white font-semibold py-3 px-6 rounded-lg hover:bg-indigo-700 disabled:bg-slate-400 mx-auto",children:[s?l.jsx(P,{className:"animate-spin"}):l.jsx(C,{}),l.jsx("span",{children:s?"Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¹Ù…ÙŠÙ‚...":"ØªØ´ØºÙŠÙ„ Ø§Ù„ØªØ­Ù„ÙŠÙ„"})]}),l.jsx("p",{className:"text-xs text-slate-500 mt-2",children:"Ù…Ù„Ø§Ø­Ø¸Ø©: Ù‡Ø°Ø§ Ø§Ù„ØªØ­Ù„ÙŠÙ„ ÙŠØ³ØªØ®Ø¯Ù… Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø§Ù„Ø­Ø§Ù„ÙŠØ© ÙˆØ§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„Ø£Ø®Ø±Ù‰ ÙƒØ¨ÙŠØ§Ù†Ø§Øª ØªØ§Ø±ÙŠØ®ÙŠØ© Ù„ØªØ¯Ø±ÙŠØ¨ Ø§Ù„Ù†Ù…Ø§Ø°Ø¬."})]}),a&&l.jsxs("div",{className:"bg-white dark:bg-gray-900/50 p-6 rounded-xl shadow-sm",children:[a.error&&l.jsx("p",{className:"text-red-500",children:a.error}),a.type==="cost"&&l.jsxs(l.Fragment,{children:[l.jsx("h3",{className:"text-xl font-bold mb-4",children:"Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªÙ†Ø¨Ø¤ Ø¨Ø§Ù„ØªÙƒØ§Ù„ÙŠÙ"}),l.jsxs("p",{children:["Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©: ",l.jsxs("span",{className:"font-bold text-lg text-indigo-500",children:[a.predictedCost.toLocaleString("ar-SA")," SAR"]})]}),l.jsxs("p",{children:["Ù†Ø·Ø§Ù‚ Ø§Ù„Ø«Ù‚Ø© (90%): ",a.lowerBound.toLocaleString("ar-SA")," - ",a.upperBound.toLocaleString("ar-SA")," SAR"]})]}),a.type==="duration"&&l.jsxs(l.Fragment,{children:[l.jsx("h3",{className:"text-xl font-bold mb-4",children:"Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªÙ†Ø¨Ø¤ Ø¨Ø§Ù„Ù…Ø¯Ø©"}),l.jsxs("p",{children:["Ø§Ù„Ù…Ø¯Ø© Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø© (PERT): ",l.jsxs("span",{className:"font-bold text-lg text-indigo-500",children:[a.estimatedDuration," ÙŠÙˆÙ…"]})]}),l.jsxs("p",{children:["Ù…ØªÙØ§Ø¦Ù„: ",a.optimistic," ÙŠÙˆÙ…, Ø§Ù„Ø£ÙƒØ«Ø± Ø§Ø­ØªÙ…Ø§Ù„Ø§Ù‹: ",a.mostLikely," ÙŠÙˆÙ…, Ù…ØªØ´Ø§Ø¦Ù…: ",a.pessimistic," ÙŠÙˆÙ…"]})]}),a.type==="schedule"&&l.jsxs(l.Fragment,{children:[l.jsx("h3",{className:"text-xl font-bold mb-4",children:"Ù†ØªØ§Ø¦Ø¬ ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø²Ù…Ù†ÙŠ"}),l.jsxs("p",{children:["Ø§Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„Ù…Ø­Ù‚Ù‚: ",l.jsxs("span",{className:"font-bold text-lg text-green-500",children:[a.improvement.toFixed(1),"%"]})]}),l.jsxs("p",{children:["Ø§Ù„Ù…Ø¯Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©: ",a.totalDuration," ÙŠÙˆÙ…"]}),l.jsxs("p",{children:["Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ø­Ø±Ø¬: ",a.criticalPath.join(" -> ")]})]})]})]})};export{H as default};
