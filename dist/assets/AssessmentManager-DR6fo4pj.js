var R=Object.defineProperty,$=Object.defineProperties;var B=Object.getOwnPropertyDescriptors;var S=Object.getOwnPropertySymbols;var G=Object.prototype.hasOwnProperty,H=Object.prototype.propertyIsEnumerable;var P=(t,r,a)=>r in t?R(t,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[r]=a,p=(t,r)=>{for(var a in r||(r={}))G.call(r,a)&&P(t,a,r[a]);if(S)for(var a of S(r))H.call(r,a)&&P(t,a,r[a]);return t},f=(t,r)=>$(t,B(r));var D=(t,r,a)=>new Promise((d,h)=>{var x=l=>{try{g(a.next(l))}catch(j){h(j)}},b=l=>{try{g(a.throw(l))}catch(j){h(j)}},g=l=>l.done?d(l.value):Promise.resolve(l.value).then(x,b);g((a=a.apply(t,r)).next())});import{r as o,j as e}from"./react-vendor-D4cZjflF.js";import{L as T}from"./index-wJKgzDKH.js";import{i as A,P as U,ar as V,a0 as F,a3 as W,R as J,h as K,aG as O,b3 as L,j as Q}from"./icons-lib-mPL1tuN6.js";import{v as X}from"./utils-lib-CuOuuFHP.js";import"./vendor-DhnXlGBj.js";import"./vendor-large-CMFjXBcn.js";import"./genai-lib-BGDjQqRJ.js";const Y=({plan:t})=>{var r;return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-gray-100 dark:bg-gray-800 p-4 rounded-lg flex items-center gap-3",children:[e.jsx(K,{className:"text-green-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"التكلفة الإجمالية"}),e.jsxs("p",{className:"font-bold text-lg",children:[(r=t.totalCost)==null?void 0:r.toLocaleString("ar-SA")," SAR"]})]})]}),e.jsxs("div",{className:"bg-gray-100 dark:bg-gray-800 p-4 rounded-lg flex items-center gap-3",children:[e.jsx(O,{className:"text-blue-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"المدة المقدرة"}),e.jsxs("p",{className:"font-bold text-lg",children:[t.estimatedDurationDays," أيام"]})]})]}),e.jsxs("div",{className:"bg-gray-100 dark:bg-gray-800 p-4 rounded-lg flex items-center gap-3",children:[e.jsx(L,{className:"text-yellow-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"ساعات العمل"}),e.jsxs("p",{className:"font-bold text-lg",children:[t.requiredLaborHours," ساعة"]})]})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold mb-2 flex items-center gap-2",children:[e.jsx(L,{})," إجراءات الإصلاح"]}),e.jsx("ol",{className:"list-decimal list-inside space-y-2 bg-gray-50 dark:bg-gray-800 p-4 rounded-md text-sm",children:t.procedure.map((a,d)=>e.jsx("li",{children:a},d))})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold mb-2 flex items-center gap-2",children:[e.jsx(Q,{})," المواد المطلوبة"]}),e.jsx("div",{className:"overflow-x-auto border rounded-lg",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-100 dark:bg-gray-800",children:e.jsxs("tr",{className:"text-right",children:[e.jsx("th",{className:"p-2",children:"المادة"}),e.jsx("th",{className:"p-2",children:"الكمية"}),e.jsx("th",{className:"p-2",children:"الوحدة"}),e.jsx("th",{className:"p-2",children:"تكلفة الوحدة (SAR)"})]})}),e.jsx("tbody",{children:t.requiredMaterials.map((a,d)=>e.jsxs("tr",{className:"border-t dark:border-gray-700",children:[e.jsx("td",{className:"p-2",children:a.name}),e.jsx("td",{className:"p-2",children:a.quantity}),e.jsx("td",{className:"p-2",children:a.unit}),e.jsx("td",{className:"p-2 font-mono",children:a.unitCost})]},d))})]})})]})]})},de=({project:t,onUpdateAssessments:r})=>{const a=t.data.structuralAssessments||[],[d,h]=o.useState(a.length>0?a[0].id:null),[x,b]=o.useState(null),[g,l]=o.useState(null),[j,y]=o.useState(!1),[v,k]=o.useState(""),c=o.useMemo(()=>a.find(s=>s.id===d),[a,d]),i=o.useMemo(()=>c==null?void 0:c.defects.find(s=>s.id===x),[c,x]);o.useEffect(()=>{b(null),l(null)},[d]),o.useEffect(()=>{l(null)},[x]);const q=()=>D(null,null,function*(){if(i){y(!0),k(""),l(null);try{const s=yield T(i),n=s.requiredMaterials.reduce((u,C)=>u+C.quantity*C.unitCost,0),N=s.requiredLaborHours*40,m=f(p({},s),{totalCost:parseFloat((n+N).toFixed(2))});l(m),w(i.id,{status:"Plan Generated"})}catch(s){k(s.message)}finally{y(!1)}}}),w=(s,n)=>{if(!d)return;const N=a.map(m=>m.id===d?f(p({},m),{defects:m.defects.map(u=>u.id===s?p(p({},u),n):u)}):m);r(t.id,N)},z=()=>{x&&(w(x,{status:"Fixed"}),l(null),b(null))},I=()=>{const s=prompt("أدخل اسم المبنى أو الوحدة الجديدة للتقييم:",`مبنى ${a.length+1}`);if(s){const n={id:X(),buildingName:s,assessmentType:"Visual",defects:[]};r(t.id,[...a,n]),h(n.id)}},M=s=>{const n={Low:"bg-green-100 text-green-800 dark:bg-green-900/50",Medium:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/50",High:"bg-orange-100 text-orange-800 dark:bg-orange-900/50",Critical:"bg-red-100 text-red-800 dark:bg-red-900/50"};return e.jsx("span",{className:`px-2 py-1 text-xs font-semibold rounded-full ${n[s]}`,children:s})},E=s=>{const n={New:"bg-blue-100 text-blue-800 dark:bg-blue-900/50","Plan Generated":"bg-indigo-100 text-indigo-800 dark:bg-indigo-900/50",Fixed:"bg-gray-200 text-gray-800 dark:bg-gray-700"};return e.jsx("span",{className:`px-2 py-1 text-xs font-semibold rounded-full ${n[s]}`,children:s})};return e.jsxs("div",{children:[e.jsx("header",{className:"flex justify-between items-center mb-8 flex-wrap gap-4",children:e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-3",children:[e.jsx(A,{}),"إدارة التقييم والترميم"]}),e.jsx("p",{className:"text-gray-500 mt-1",children:"سجل العيوب الإنشائية وقم بتوليد خطط إصلاح ذكية."})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-1 space-y-6",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-900/50 p-4 rounded-xl shadow-sm border dark:border-gray-800",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"font-bold",children:"قائمة التقييمات"}),e.jsx("button",{onClick:I,className:"p-2 text-indigo-600 hover:bg-indigo-100 dark:hover:bg-indigo-900/50 rounded-full",children:e.jsx(U,{size:18})})]}),e.jsx("div",{className:"space-y-2 max-h-[25vh] overflow-y-auto",children:a.map(s=>e.jsxs("button",{onClick:()=>h(s.id),className:`w-full text-right p-3 rounded-lg flex items-center gap-3 ${d===s.id?"bg-indigo-100 dark:bg-indigo-900":"hover:bg-gray-100 dark:hover:bg-gray-800"}`,children:[e.jsx("div",{className:"bg-indigo-200 dark:bg-indigo-800 p-2 rounded-full",children:e.jsx(V,{size:16})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-sm",children:s.buildingName}),e.jsx("p",{className:"text-xs text-gray-500",children:s.assessmentType})]})]},s.id))})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-900/50 p-4 rounded-xl shadow-sm border dark:border-gray-800",children:[e.jsx("h3",{className:"font-bold mb-4",children:"العيوب المسجلة"}),e.jsxs("div",{className:"space-y-2 max-h-[45vh] overflow-y-auto",children:[c==null?void 0:c.defects.map(s=>e.jsxs("button",{onClick:()=>b(s.id),className:`w-full text-right p-3 rounded-lg border-l-4 ${x===s.id?"bg-gray-100 dark:bg-gray-800 border-indigo-500":"border-transparent hover:bg-gray-50 dark:hover:bg-gray-800/50"}`,children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("p",{className:"font-semibold text-sm",children:s.location}),M(s.severity)]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:s.description}),e.jsx("div",{className:"mt-2",children:E(s.status)})]},s.id)),c&&c.defects.length===0&&e.jsx("p",{className:"text-center text-sm text-gray-500 py-4",children:"لا توجد عيوب مسجلة لهذا التقييم."})]})]})]}),e.jsx("div",{className:"lg:col-span-2 bg-white dark:bg-gray-900/50 p-6 rounded-xl shadow-sm border dark:border-gray-800",children:i?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:i.description}),e.jsxs("p",{className:"text-sm text-gray-500",children:[i.location," - ",i.type]})]}),i.photoUrl&&e.jsx("img",{src:i.photoUrl,alt:"Defect",className:"rounded-lg max-h-64 w-full object-cover"}),e.jsxs("div",{className:"border-t dark:border-gray-700 pt-4",children:[g?e.jsxs(e.Fragment,{children:[e.jsx(Y,{plan:g}),e.jsx("div",{className:"mt-6 flex justify-end",children:e.jsxs("button",{onClick:z,className:"flex items-center gap-2 bg-green-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-green-700",children:[e.jsx(F,{size:18}),e.jsx("span",{children:"تأكيد الإصلاح"})]})})]}):j?e.jsxs("div",{className:"text-center p-8",children:[e.jsx(W,{size:32,className:"animate-spin text-indigo-500 mx-auto"}),e.jsx("p",{className:"mt-2",children:"جاري إنشاء خطة الإصلاح..."})]}):i.status!=="Fixed"&&e.jsxs("button",{onClick:q,className:"flex items-center gap-2 bg-indigo-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-indigo-700",children:[e.jsx(J,{size:18}),e.jsx("span",{children:"إنشاء خطة تعديل (AI)"})]}),i.status==="Fixed"&&e.jsxs("p",{className:"font-semibold text-green-600 flex items-center gap-2",children:[e.jsx(F,{})," تم إصلاح هذا العيب."]}),v&&e.jsx("p",{className:"text-red-500 text-sm mt-2",children:v})]})]}):e.jsx("div",{className:"flex items-center justify-center h-full text-center text-gray-500",children:e.jsxs("div",{children:[e.jsx(A,{size:48,className:"mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold",children:"اختر عيبًا من القائمة"}),e.jsx("p",{children:"اختر عيبًا لعرض تفاصيله أو لتوليد خطة إصلاح."})]})})})]})]})};export{de as AssessmentManager};
