var be=Object.defineProperty,fe=Object.defineProperties;var me=Object.getOwnPropertyDescriptors;var U=Object.getOwnPropertySymbols;var pe=Object.prototype.hasOwnProperty,ye=Object.prototype.propertyIsEnumerable;var O=(r,a,l)=>a in r?be(r,a,{enumerable:!0,configurable:!0,writable:!0,value:l}):r[a]=l,_=(r,a)=>{for(var l in a||(a={}))pe.call(a,l)&&O(r,l,a[l]);if(U)for(var l of U(a))ye.call(a,l)&&O(r,l,a[l]);return r},X=(r,a)=>fe(r,me(a));import{e as Y,j as e,r as p}from"./react-vendor-D4cZjflF.js";import{ag as we,ah as ve,a$ as je,u as F,b0 as J,aV as K,ay as Ne,b1 as De,au as ke,b2 as $e,aG as Se,a2 as Ce}from"./icons-lib-mPL1tuN6.js";const Te=({position:r,onClose:a,onEdit:l,onDelete:g})=>{const c=Y.useRef(null);Y.useEffect(()=>{const v=C=>{c.current&&!c.current.contains(C.target)&&a()};return setTimeout(()=>document.addEventListener("mousedown",v),0),()=>{document.removeEventListener("mousedown",v)}},[a]);const D=v=>{v(),a()};return e.jsx("div",{ref:c,style:{top:r.top,right:r.right},className:"absolute z-20 w-36 bg-white dark:bg-gray-800 rounded-md shadow-lg border border-gray-200 dark:border-gray-700",children:e.jsxs("ul",{className:"p-1 text-sm text-gray-700 dark:text-gray-200",children:[e.jsx("li",{children:e.jsxs("button",{onClick:()=>D(l),className:"flex items-center gap-2 w-full text-right px-3 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",children:[e.jsx(we,{size:16}),e.jsx("span",{children:"تعديل"})]})}),e.jsx("li",{children:e.jsxs("button",{onClick:()=>D(g),className:"flex items-center gap-2 w-full text-right px-3 py-2 text-red-600 dark:text-red-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",children:[e.jsx(ve,{size:16}),e.jsx("span",{children:"حذف"})]})})]})})},Me=r=>{if(!r)return"??";const a=r.trim().split(/\s+/);return a.length===1?a[0].substring(0,2).toUpperCase():(a[0][0]+a[a.length-1][0]).toUpperCase()},Ie=r=>{if(!r)return"#6366f1";let a=0;for(let c=0;c<r.length;c++)a=r.charCodeAt(c)+((a<<5)-a);const l=["#ef4444","#f97316","#f59e0b","#eab308","#84cc16","#22c55e","#10b981","#14b8a6","#06b6d4","#0ea5e9","#3b82f6","#6366f1","#8b5cf6","#a855f7","#d946ef","#ec4899","#f43f5e"],g=Math.abs(a)%l.length;return l[g]},Ee=r=>{const a=r.replace("#",""),l=parseInt(a.substring(0,2),16),g=parseInt(a.substring(2,4),16),c=parseInt(a.substring(4,6),16);return(.299*l+.587*g+.114*c)/255>.5?"black":"white"},We=r=>{const a={Admin:"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300","Project Manager":"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-300",Engineer:"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300",Architect:"bg-indigo-100 text-indigo-800 dark:bg-indigo-900/30 dark:text-indigo-300",Contractor:"bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-300",Consultant:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300",Viewer:"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"};return a[r]||a.Viewer},u=35,q=({member:r,size:a=24})=>{const l=Me(r.name),g=r.avatarColor||Ie(r.name),c=Ee(g);return r.avatar?e.jsx("img",{src:r.avatar,alt:r.name,className:"rounded-full object-cover border-2 border-white dark:border-gray-800",style:{width:a,height:a},title:r.name}):e.jsx("div",{className:"rounded-full flex items-center justify-center font-bold border-2 border-white dark:border-gray-800",style:{width:a,height:a,backgroundColor:g,color:c,fontSize:`${a*.4}px`},title:r.name,children:l})},w=(r,a)=>{const l=new Date(r.getFullYear(),r.getMonth(),r.getDate()),g=new Date(a.getFullYear(),a.getMonth(),a.getDate()),c=l.getTime()-g.getTime();return Math.round(c/(1e3*60*60*24))},Le=r=>{switch(r){case"Done":return e.jsx(Ce,{size:16,className:"text-green-500"});case"In Progress":return e.jsx(Se,{size:16,className:"text-sky-500 animate-spin [animation-duration:3s]"});case"To Do":default:return e.jsx($e,{size:16,className:"text-slate-400"})}},ze=r=>{switch(r){case"High":return"border-red-500";case"Medium":return"border-yellow-500";case"Low":default:return"border-slate-300"}},Be=r=>{switch(r){case"Done":return{bg:"bg-green-100 dark:bg-green-500/10 group-hover:bg-green-200 dark:group-hover:bg-green-500/20",fill:"bg-green-500"};case"In Progress":return{bg:"bg-sky-100 dark:bg-sky-500/10 group-hover:bg-sky-200 dark:group-hover:bg-sky-500/20",fill:"bg-sky-500"};case"To Do":default:return{bg:"bg-slate-200 dark:bg-slate-700/30 group-hover:bg-slate-300 dark:group-hover:bg-slate-700/50",fill:"bg-slate-500 dark:bg-slate-400"}}},Re=r=>{switch(r){case"High":return"border-r-4 border-red-500";case"Medium":return"border-r-4 border-yellow-500";case"Low":default:return""}},Ae=(r,a)=>{if(!r||a===void 0)return null;switch(r){case"ahead":return e.jsxs("div",{className:"flex items-center gap-1 text-green-600",title:`متقدم ${Math.abs(a)} يوم`,children:[e.jsx(F,{size:14}),e.jsxs("span",{className:"text-xs font-medium",children:[Math.abs(a),"د"]})]});case"behind":return e.jsxs("div",{className:"flex items-center gap-1 text-red-600",title:`متأخر ${a} يوم`,children:[e.jsx(K,{size:14}),e.jsxs("span",{className:"text-xs font-medium",children:[a,"د"]})]});case"on-track":return e.jsx("div",{className:"flex items-center gap-1 text-blue-600",title:"في المسار الصحيح",children:e.jsx(J,{size:14})});default:return null}},Ye=Y.memo(({tasks:r,members:a,projectStartDate:l,onEditTask:g,onDeleteTask:c,cpmResult:D})=>{const[v,C]=p.useState(null),[Q,Z]=p.useState({top:0,right:0}),[j,G]=p.useState(null),[S,ee]=p.useState(!0),[k,te]=p.useState(!0),z=p.useRef(null),B=p.useRef(null),R=p.useRef(null),A=p.useRef(null),{processedTasks:b,projectDuration:P,startDate:re,months:ae,days:H}=p.useMemo(()=>{if(r.length===0)return{processedTasks:[],projectDuration:30,startDate:new Date(l),months:[],days:[]};const t=r.filter(s=>s.start&&s.end&&!isNaN(new Date(s.start).getTime())&&!isNaN(new Date(s.end).getTime())),n=t.flatMap(s=>{const m=[new Date(s.start).getTime(),new Date(s.end).getTime()];return s.originalStart&&m.push(new Date(s.originalStart).getTime()),s.originalEnd&&m.push(new Date(s.originalEnd).getTime()),s.baselineStart&&m.push(new Date(s.baselineStart).getTime()),s.baselineEnd&&m.push(new Date(s.baselineEnd).getTime()),m});n.length===0&&n.push(new Date(l).getTime());const i=new Date(Math.min(...n));i.setDate(i.getDate()-7);const h=new Date(Math.max(...n));h.setDate(h.getDate()+7);const d=w(h,i)+1,o=t.map(s=>{const m=new Date(s.start),W=new Date(s.end),le=w(m,i),oe=w(W,m)+1,de=s.originalStart?w(new Date(s.originalStart),i):void 0,ce=s.originalStart&&s.originalEnd?w(new Date(s.originalEnd),new Date(s.originalStart))+1:void 0,M=s.baselineStart||s.originalStart,I=s.baselineEnd||s.originalEnd,ge=M?w(new Date(M),i):void 0,he=M&&I?w(new Date(I),new Date(M))+1:void 0;let E,L;if(I){const xe=new Date(s.end),ue=new Date(I);L=w(xe,ue),Math.abs(L)<=2?E="on-track":L<0?E="ahead":E="behind"}return X(_({},s),{startDay:le,duration:oe,originalStartDay:de,originalDuration:ce,baselineStartDay:ge,baselineDuration:he,variance:E,varianceDays:L})}).sort((s,m)=>new Date(s.start).getTime()-new Date(m.start).getTime()),y=[],f=[];let x=new Date(i),N=-1;for(;x<=h;)x.getMonth()!==N&&(y.push({name:x.toLocaleString("ar-SA",{month:"long",year:"numeric"}),startDay:w(x,i)}),N=x.getMonth()),f.push({date:new Date(x),dayNumber:x.getDate()}),x.setDate(x.getDate()+1);return{processedTasks:o,projectDuration:d,startDate:i,months:y,days:f}},[r,l]),{highlightedTaskIds:T,dependencyLinks:se}=p.useMemo(()=>{if(!j)return{highlightedTaskIds:new Set,dependencyLinks:[]};const t=new Set([j]),n=[],i=b.find(o=>o.id===j);if(!i)return{highlightedTaskIds:T,dependencyLinks:[]};const d=b.findIndex(o=>o.id===j)*48+24;return i.dependencies.forEach(o=>{const y=b.find(f=>f.id===o);if(y){t.add(o);const x=b.findIndex(W=>W.id===o)*48+24,N=(y.startDay+y.duration)*u,s=i.startDay*u,m=`M ${N} ${x} C ${N+40} ${x}, ${s-40} ${d}, ${s} ${d}`;n.push({key:`${o}-${j}`,d:m})}}),b.forEach((o,y)=>{if(o.dependencies.includes(j)){t.add(o.id);const f=y*48+24,x=(i.startDay+i.duration)*u,N=o.startDay*u,s=`M ${x} ${d} C ${x+40} ${d}, ${N-40} ${f}, ${N} ${f}`;n.push({key:`${j}-${o.id}`,d:s})}}),{highlightedTaskIds:t,dependencyLinks:n}},[j,b]),ne=(t,n)=>{if(t.stopPropagation(),!g||!c)return;const h=t.currentTarget.getBoundingClientRect();if(z.current){const d=z.current.getBoundingClientRect();Z({top:h.bottom-d.top+8,right:d.right-h.right-144/2+h.width/2}),C(n===v?null:n)}},ie=t=>{const n=t.currentTarget;R.current&&A.current&&(R.current.scrollTop=n.scrollTop,A.current.scrollTop=n.scrollTop),B.current&&(B.current.scrollLeft=n.scrollLeft)};if(r.length===0)return e.jsx("div",{className:"text-center p-8 bg-white dark:bg-slate-800 rounded-lg",children:"لا توجد مهام لعرضها."});const V=w(new Date,re),$=p.useMemo(()=>{const t=b.filter(d=>d.baselineStartDay!==void 0),n=t.filter(d=>d.variance==="ahead").length,i=t.filter(d=>d.variance==="behind").length,h=t.filter(d=>d.variance==="on-track").length;return{total:t.length,ahead:n,behind:i,onTrack:h}},[b]);return e.jsxs("div",{ref:z,className:"gantt-container bg-white dark:bg-gray-900/50 rounded-xl shadow-sm border border-gray-200 dark:border-gray-800 w-full overflow-hidden relative",children:[$.total>0&&e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-800 bg-gradient-to-r from-indigo-50 to-purple-50 dark:from-indigo-900/20 dark:to-purple-900/20",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(je,{className:"w-5 h-5 text-indigo-600 dark:text-indigo-400"}),e.jsx("span",{className:"font-semibold text-gray-900 dark:text-gray-100",children:"مقارنة الأساس"})]}),e.jsxs("div",{className:"flex items-center gap-3 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-1 px-3 py-1 bg-green-100 dark:bg-green-900/30 rounded-full",children:[e.jsx(F,{className:"w-4 h-4 text-green-600"}),e.jsxs("span",{className:"font-medium text-green-700 dark:text-green-400",children:[$.ahead," متقدم"]})]}),e.jsxs("div",{className:"flex items-center gap-1 px-3 py-1 bg-blue-100 dark:bg-blue-900/30 rounded-full",children:[e.jsx(J,{className:"w-4 h-4 text-blue-600"}),e.jsxs("span",{className:"font-medium text-blue-700 dark:text-blue-400",children:[$.onTrack," في المسار"]})]}),e.jsxs("div",{className:"flex items-center gap-1 px-3 py-1 bg-red-100 dark:bg-red-900/30 rounded-full",children:[e.jsx(K,{className:"w-4 h-4 text-red-600"}),e.jsxs("span",{className:"font-medium text-red-700 dark:text-red-400",children:[$.behind," متأخر"]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>ee(!S),className:`flex items-center gap-2 px-4 py-2 rounded-lg transition-all ${S?"bg-indigo-600 text-white shadow-md":"bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-700"}`,children:[S?e.jsx(Ne,{className:"w-4 h-4"}):e.jsx(De,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:S?"إخفاء الأساس":"إظهار الأساس"})]}),e.jsxs("button",{onClick:()=>te(!k),className:`flex items-center gap-2 px-4 py-2 rounded-lg transition-all ${k?"bg-purple-600 text-white shadow-md":"bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-700"}`,children:[e.jsx(F,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:k?"إخفاء التباين":"إظهار التباين"})]})]})]}),e.jsxs("div",{className:"flex",children:[e.jsxs("div",{className:"w-[580px] border-l border-gray-200 dark:border-gray-800 flex flex-col shrink-0",children:[e.jsxs("div",{className:"h-20 flex items-center p-3 border-b border-gray-200 dark:border-gray-800 bg-gray-50 dark:bg-gray-900",children:[e.jsx("div",{className:"flex-grow font-semibold text-sm",children:"المهمة"}),e.jsx("div",{className:"w-20 font-semibold text-sm text-center",children:"المسؤول"}),e.jsx("div",{className:"w-16 font-semibold text-sm text-center",children:"الحالة"}),k&&$.total>0&&e.jsx("div",{className:"w-16 font-semibold text-sm text-center",children:"التباين"}),e.jsx("div",{className:"w-10"})]}),e.jsx("div",{ref:R,className:"overflow-y-hidden",style:{height:`${b.length*48}px`},children:b.map(t=>{const n=a.filter(i=>{var h;return(h=t.assignees)==null?void 0:h.includes(i.id)});return e.jsxs("div",{className:`flex items-center p-3 h-12 border-b border-gray-100 dark:border-gray-800 transition-colors ${T.has(t.id)?"bg-indigo-50 dark:bg-indigo-900/30":""}`,children:[e.jsxs("div",{className:`flex-grow truncate text-sm flex items-center gap-2 border-r-4 pr-2 ${ze(t.priority)}`,children:[e.jsx("span",{className:"font-mono text-xs text-slate-400",children:t.id}),e.jsx("span",{className:"truncate",children:t.name})]}),e.jsxs("div",{className:"w-20 flex justify-center items-center -space-x-2",children:[n.slice(0,3).map(i=>e.jsx(q,{member:i,size:24},i.id)),n.length>3&&e.jsxs("div",{className:"w-6 h-6 rounded-full bg-gray-600 dark:bg-gray-700 border-2 border-white dark:border-gray-900 flex items-center justify-center text-[10px] font-bold text-white",title:`+${n.length-3} أعضاء`,children:["+",n.length-3]})]}),e.jsx("div",{className:"w-16 flex justify-center",children:Le(t.status)}),k&&$.total>0&&e.jsx("div",{className:"w-16 flex justify-center",children:Ae(t.variance,t.varianceDays)}),e.jsx("div",{className:"w-10 flex justify-center",children:g&&c&&e.jsx("button",{onClick:i=>ne(i,t.id),className:"p-1 rounded-full hover:bg-slate-200 dark:hover:bg-slate-700",children:e.jsx(ke,{size:18})})})]},t.id)})})]}),e.jsxs("div",{className:"flex-grow overflow-x-auto",onScroll:ie,children:[e.jsxs("div",{ref:B,className:"h-20 border-b border-gray-200 dark:border-gray-800 sticky top-0 bg-gray-50 dark:bg-gray-900 z-10",style:{width:`${P*u}px`},children:[e.jsx("div",{className:"h-10 flex border-b border-gray-200 dark:border-gray-800",children:ae.map((t,n)=>e.jsx("div",{className:"flex items-center justify-center font-semibold text-sm border-l border-gray-200 dark:border-gray-800",style:{width:`${H.filter(i=>i.date.toLocaleString("ar-SA",{month:"long",year:"numeric"})===t.name).length*u}px`},children:t.name},n))}),e.jsx("div",{className:"h-10 flex",children:H.map((t,n)=>{const i=t.date.getDay()===4||t.date.getDay()===5;return e.jsx("div",{className:`w-[${u}px] h-full flex items-center justify-center text-xs border-l border-gray-200 dark:border-gray-800 ${i?"bg-gray-100 dark:bg-gray-800/50":""}`,children:t.dayNumber},n)})})]}),e.jsxs("div",{ref:A,className:"relative",style:{width:`${P*u}px`,height:`${b.length*48}px`},children:[H.map((t,n)=>e.jsx("div",{className:"absolute top-0 h-full border-l border-gray-100 dark:border-gray-800",style:{left:`${n*u}px`,width:`${u}px`}},n)),V>=0&&V<P&&e.jsx("div",{className:"absolute top-0 h-full w-0.5 bg-red-500 z-10",style:{left:`${V*u+u/2}px`},children:e.jsx("div",{className:"absolute -top-4 -translate-x-1/2 text-xs text-red-500 font-bold",children:"اليوم"})}),e.jsxs("svg",{width:"100%",height:"100%",className:"absolute top-0 left-0 pointer-events-none",children:[se.map(t=>e.jsx("path",{d:t.d,stroke:"#4f46e5",strokeWidth:"1.5",fill:"none",markerEnd:"url(#arrow)"},t.key)),e.jsx("defs",{children:e.jsx("marker",{id:"arrow",viewBox:"0 0 10 10",refX:"8",refY:"5",markerWidth:"6",markerHeight:"6",orient:"auto-start-reverse",children:e.jsx("path",{d:"M 0 0 L 10 5 L 0 10 z",fill:"#4f46e5"})})})]}),b.map((t,n)=>{const i=D==null?void 0:D.criticalActivityIds.includes(t.id),h=Be(t.status),d=S&&t.baselineStartDay!==void 0&&t.baselineDuration!==void 0;let o="";if(k&&t.variance)switch(t.variance){case"ahead":o="ring-2 ring-green-500 ring-offset-2 ring-offset-white dark:ring-offset-gray-900";break;case"behind":o="ring-2 ring-red-500 ring-offset-2 ring-offset-white dark:ring-offset-gray-900";break;case"on-track":o="ring-2 ring-blue-500 ring-offset-2 ring-offset-white dark:ring-offset-gray-900";break}return e.jsxs("div",{className:`absolute h-12 flex flex-col justify-center group cursor-pointer ${T.size>0&&!T.has(t.id)?"opacity-30":""}`,style:{top:`${n*48}px`},onMouseEnter:()=>G(t.id),onMouseLeave:()=>G(null),onClick:()=>g&&g(t),children:[d&&e.jsxs("div",{className:"absolute top-8 h-2 bg-gray-400 dark:bg-gray-500 rounded-sm opacity-60 group-hover:opacity-80 transition-opacity",style:{left:`${t.baselineStartDay*u}px`,width:`${t.baselineDuration*u}px`},title:`الأساس: ${t.baselineStart} - ${t.baselineEnd}`,children:[e.jsx("div",{className:"absolute -top-1 left-0 w-0.5 h-4 bg-gray-500"}),e.jsx("div",{className:"absolute -top-1 right-0 w-0.5 h-4 bg-gray-500"})]}),e.jsxs("div",{className:`relative h-8 rounded-md flex items-center justify-between px-2 text-xs font-medium text-white ${h.bg} ${Re(t.priority)} ${i?"ring-2 ring-red-500":o}`,style:{left:`${t.startDay*u}px`,width:`${t.duration*u}px`},children:[e.jsx("div",{className:`absolute top-0 left-0 h-full rounded-md ${h.fill}`,style:{width:`${t.progress}%`}}),e.jsx("span",{className:"relative truncate",children:t.name}),e.jsxs("div",{className:"relative flex items-center gap-1",children:[t.assignees&&t.assignees.length>0&&e.jsxs("div",{className:"flex items-center -space-x-2",children:[t.assignees.slice(0,3).map(y=>{const f=a.find(x=>x.id===y);return f?e.jsx(q,{member:f,size:20},f.id):null}),t.assignees.length>3&&e.jsxs("div",{className:"w-5 h-5 rounded-full bg-gray-600 dark:bg-gray-700 border-2 border-white dark:border-gray-800 flex items-center justify-center text-[10px] font-bold",title:`+${t.assignees.length-3} أعضاء`,children:["+",t.assignees.length-3]})]}),k&&t.variance&&t.varianceDays!==void 0&&e.jsx("span",{className:`px-1.5 py-0.5 rounded text-[10px] font-bold ${t.variance==="ahead"?"bg-green-500":t.variance==="behind"?"bg-red-500":"bg-blue-500"}`,children:t.variance==="ahead"?`+${Math.abs(t.varianceDays)}`:t.variance==="behind"?`-${t.varianceDays}`:"✓"})]})]})]},t.id)})]})]})]}),v&&g&&c&&e.jsx(Te,{position:Q,onClose:()=>C(null),onEdit:()=>g(r.find(t=>t.id===v)),onDelete:()=>c(v)})]})});export{Ye as G,Me as a,Ie as b,Ee as c,We as g};
