var h=(o,C,g)=>new Promise((j,u)=>{var b=n=>{try{d(g.next(n))}catch(l){u(l)}},i=n=>{try{d(g.throw(n))}catch(l){u(l)}},d=n=>n.done?j(n.value):Promise.resolve(n.value).then(b,i);d((g=g.apply(o,C)).next())});import{r,j as e}from"./react-vendor-D4cZjflF.js";import{F as w,U as O,b6 as R,a as D,bx as V,aB as re,X as v,$ as ne,a3 as P,ao as ie,a9 as ce,ay as oe,ae as I,ah as de,by as xe}from"./icons-lib-mPL1tuN6.js";import"./vendor-DhnXlGBj.js";const pe=()=>{const[o,C]=r.useState([]),[g,j]=r.useState(!1),[u,b]=r.useState(!1),[i,d]=r.useState(null),[n,l]=r.useState(null),[k,x]=r.useState(null),[y,Q]=r.useState(""),[F,J]=r.useState("all"),[m,K]=r.useState(null),[X,p]=r.useState(!1),[q,S]=r.useState(!1),[$,f]=r.useState(""),[_,T]=r.useState(!1),[z,H]=r.useState("date"),[E,L]=r.useState("General"),[A,U]=r.useState(""),c=window.location.origin.replace(/300[01]/,"5000");r.useEffect(()=>{N()},[]);const N=()=>h(null,null,function*(){try{j(!0);const a=yield(yield fetch(`${c}/api/pdf/list`)).json();a.success?C(a.pdfs):l(a.error)}catch(s){l("Failed to fetch PDFs"),console.error(s)}finally{j(!1)}}),W=s=>{var t;const a=(t=s.target.files)==null?void 0:t[0];if(a){if(a.type!=="application/pdf"){l("Please select a PDF file");return}if(a.size>50*1024*1024){l("File size must be less than 50MB");return}d(a),l(null)}},Y=()=>h(null,null,function*(){if(!i){l("Please select a file");return}try{b(!0),l(null);const s=new FormData;s.append("file",i),s.append("category",E),s.append("tags",A);const t=yield(yield fetch(`${c}/api/pdf/upload`,{method:"POST",body:s})).json();t.success?(x(`PDF uploaded successfully: ${i.name}`),d(null),p(!1),L("General"),U(""),N(),setTimeout(()=>x(null),3e3)):l(t.error)}catch(s){l("Failed to upload PDF"),console.error(s)}finally{b(!1)}}),Z=s=>h(null,null,function*(){if(window.confirm("Are you sure you want to delete this PDF?"))try{const t=yield(yield fetch(`${c}/api/pdf/${s}`,{method:"DELETE"})).json();t.success?(x("PDF deleted successfully"),N(),setTimeout(()=>x(null),3e3)):l(t.error)}catch(a){l("Failed to delete PDF"),console.error(a)}}),ee=s=>h(null,null,function*(){K(s),S(!0),f("")}),se=s=>h(null,null,function*(){try{f("Loading...");const t=yield(yield fetch(`${c}/api/pdf/${s}/extract-text`)).json();t.success?f(t.text):f(`Error: ${t.error}`)}catch(a){f("Failed to extract text"),console.error(a)}}),ae=s=>h(null,null,function*(){try{T(!0);const t=yield(yield fetch(`${c}/api/pdf/${s}/analyze`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({analysis_type:"general"})})).json();t.success?(x("Analysis completed successfully"),N(),setTimeout(()=>x(null),3e3)):l(t.error)}catch(a){l("Failed to analyze PDF"),console.error(a)}finally{T(!1)}}),B=o.filter(s=>{const a=s.original_filename.toLowerCase().includes(y.toLowerCase())||s.category.toLowerCase().includes(y.toLowerCase())||s.tags.some(le=>le.toLowerCase().includes(y.toLowerCase())),t=F==="all"||s.category===F;return a&&t}).sort((s,a)=>{switch(z){case"date":return new Date(a.upload_date).getTime()-new Date(s.upload_date).getTime();case"name":return s.original_filename.localeCompare(a.original_filename);case"size":return a.file_size-s.file_size;default:return 0}}),M=["all",...Array.from(new Set(o.map(s=>s.category)))],G=s=>s<1024?`${s} B`:s<1024*1024?`${(s/1024).toFixed(1)} KB`:`${(s/(1024*1024)).toFixed(1)} MB`,te=s=>new Date(s).toLocaleDateString("ar-SA",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-8 mb-6 border-r-4 border-blue-600",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-lg text-white",children:e.jsx(w,{className:"w-8 h-8"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"إدارة ملفات PDF"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"رفع وعرض وتحليل مستندات PDF"})]})]}),e.jsxs("button",{onClick:()=>p(!0),className:"flex items-center gap-2 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors shadow-md",children:[e.jsx(O,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:"رفع PDF"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mt-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg p-4 text-white",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(w,{className:"w-8 h-8 opacity-80"}),e.jsx("span",{className:"text-3xl font-bold",children:o.length})]}),e.jsx("p",{className:"text-blue-100 mt-2",children:"إجمالي الملفات"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-green-500 to-green-600 rounded-lg p-4 text-white",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(R,{className:"w-8 h-8 opacity-80"}),e.jsx("span",{className:"text-3xl font-bold",children:o.filter(s=>s.text_extracted).length})]}),e.jsx("p",{className:"text-green-100 mt-2",children:"تم استخراج النص"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-purple-500 to-purple-600 rounded-lg p-4 text-white",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(D,{className:"w-8 h-8 opacity-80"}),e.jsx("span",{className:"text-3xl font-bold",children:o.filter(s=>s.analysis).length})]}),e.jsx("p",{className:"text-purple-100 mt-2",children:"تم التحليل"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-orange-500 to-orange-600 rounded-lg p-4 text-white",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(V,{className:"w-8 h-8 opacity-80"}),e.jsx("span",{className:"text-3xl font-bold",children:M.length-1})]}),e.jsx("p",{className:"text-orange-100 mt-2",children:"التصنيفات"})]})]})]}),n&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6 flex items-center gap-3",children:[e.jsx(re,{className:"w-5 h-5 text-red-600 flex-shrink-0"}),e.jsx("p",{className:"text-red-800",children:n}),e.jsx("button",{onClick:()=>l(null),className:"mr-auto",children:e.jsx(v,{className:"w-5 h-5 text-red-600"})})]}),k&&e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 mb-6 flex items-center gap-3",children:[e.jsx(R,{className:"w-5 h-5 text-green-600 flex-shrink-0"}),e.jsx("p",{className:"text-green-800",children:k}),e.jsx("button",{onClick:()=>x(null),className:"mr-auto",children:e.jsx(v,{className:"w-5 h-5 text-green-600"})})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-md p-4 mb-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(ne,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",placeholder:"ابحث في الملفات...",value:y,onChange:s=>Q(s.target.value),className:"w-full pr-10 pl-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsx("select",{value:F,onChange:s=>J(s.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:M.map(s=>e.jsx("option",{value:s,children:s==="all"?"جميع التصنيفات":s},s))}),e.jsxs("select",{value:z,onChange:s=>H(s.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"date",children:"التاريخ"}),e.jsx("option",{value:"name",children:"الاسم"}),e.jsx("option",{value:"size",children:"الحجم"})]})]})}),g?e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx(P,{className:"w-12 h-12 animate-spin text-blue-600"})}):B.length===0?e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-12 text-center",children:[e.jsx(w,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"لا توجد ملفات PDF"}),e.jsx("p",{className:"text-gray-600",children:"ابدأ برفع ملف PDF الأول"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:B.map(s=>e.jsx("div",{className:"bg-white rounded-lg shadow-md hover:shadow-xl transition-all overflow-hidden group",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-4",children:[e.jsx("div",{className:"p-3 bg-red-100 rounded-lg",children:e.jsx(w,{className:"w-6 h-6 text-red-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-gray-900 truncate",title:s.original_filename,children:s.original_filename}),e.jsxs("p",{className:"text-sm text-gray-500",children:[s.num_pages," صفحة"]})]})]}),e.jsxs("div",{className:"space-y-2 mb-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(ie,{className:"w-4 h-4"}),e.jsx("span",{children:s.category})]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(ce,{className:"w-4 h-4"}),e.jsx("span",{children:te(s.upload_date)})]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(V,{className:"w-4 h-4"}),e.jsx("span",{children:G(s.file_size)})]})]}),s.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:s.tags.slice(0,3).map((a,t)=>e.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-700 rounded-full text-xs",children:a},t))}),s.analysis&&e.jsxs("div",{className:"mb-4 p-3 bg-green-50 border border-green-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(D,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{className:"text-sm font-medium text-green-900",children:s.analysis.document_type})]}),e.jsx("p",{className:"text-xs text-green-700 line-clamp-2",children:s.analysis.summary})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>ee(s),className:"flex-1 flex items-center justify-center gap-2 px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm",children:[e.jsx(oe,{className:"w-4 h-4"}),"عرض"]}),e.jsx("a",{href:`${c}/api/pdf/${s.id}/download`,download:!0,className:"flex items-center justify-center px-3 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors",children:e.jsx(I,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>Z(s.id),className:"flex items-center justify-center px-3 py-2 bg-red-100 text-red-600 rounded-lg hover:bg-red-200 transition-colors",children:e.jsx(de,{className:"w-4 h-4"})})]})]})},s.id))}),X&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center p-4",onClick:()=>p(!1),children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-2xl w-full p-8",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"رفع ملف PDF"}),e.jsx("button",{onClick:()=>p(!1),children:e.jsx(v,{className:"w-6 h-6 text-gray-500 hover:text-gray-700"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"اختر ملف PDF"}),e.jsx("input",{type:"file",accept:".pdf",onChange:W,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"}),i&&e.jsxs("p",{className:"mt-2 text-sm text-gray-600",children:[i.name," (",G(i.size),")"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"التصنيف"}),e.jsxs("select",{value:E,onChange:s=>L(s.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"General",children:"عام"}),e.jsx("option",{value:"Contract",children:"عقد"}),e.jsx("option",{value:"Invoice",children:"فاتورة"}),e.jsx("option",{value:"Report",children:"تقرير"}),e.jsx("option",{value:"Technical",children:"تقني"}),e.jsx("option",{value:"Drawing",children:"مخطط"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"الوسوم (مفصولة بفواصل)"}),e.jsx("input",{type:"text",value:A,onChange:s=>U(s.target.value),placeholder:"مثال: عقد, 2024, مشروع1",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx("button",{onClick:Y,disabled:!i||u,className:"flex-1 flex items-center justify-center gap-2 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors",children:u?e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"w-5 h-5 animate-spin"}),"جاري الرفع..."]}):e.jsxs(e.Fragment,{children:[e.jsx(O,{className:"w-5 h-5"}),"رفع"]})}),e.jsx("button",{onClick:()=>{p(!1),d(null)},className:"px-6 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors",children:"إلغاء"})]})]})]})}),q&&m&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center p-4",onClick:()=>S(!1),children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-6xl w-full max-h-[90vh] overflow-hidden flex flex-col",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:m.original_filename}),e.jsx("button",{onClick:()=>S(!1),children:e.jsx(v,{className:"w-6 h-6 text-gray-500 hover:text-gray-700"})})]}),e.jsxs("div",{className:"flex gap-2 p-4 border-b bg-gray-50",children:[e.jsxs("button",{onClick:()=>se(m.id),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(xe,{className:"w-4 h-4"}),"استخراج النص"]}),e.jsxs("button",{onClick:()=>ae(m.id),disabled:_,className:"flex items-center gap-2 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:bg-gray-400 transition-colors",children:[_?e.jsx(P,{className:"w-4 h-4 animate-spin"}):e.jsx(D,{className:"w-4 h-4"}),"تحليل بالذكاء الاصطناعي"]}),e.jsxs("a",{href:`${c}/api/pdf/${m.id}/download`,download:!0,className:"flex items-center gap-2 px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors",children:[e.jsx(I,{className:"w-4 h-4"}),"تحميل"]})]}),e.jsx("div",{className:"flex-1 overflow-auto p-6",children:$?e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"النص المستخرج:"}),e.jsx("pre",{className:"text-sm text-gray-700 whitespace-pre-wrap font-mono",children:$})]}):e.jsx("div",{className:"flex flex-col items-center justify-center h-full",children:e.jsx("iframe",{src:`${c}/api/pdf/${m.id}/view`,className:"w-full h-full min-h-[600px] border-0 rounded-lg",title:m.original_filename})})})]})})]})})};export{pe as default};
