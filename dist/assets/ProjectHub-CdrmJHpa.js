var $=Object.defineProperty,E=Object.defineProperties;var z=Object.getOwnPropertyDescriptors;var F=Object.getOwnPropertySymbols;var O=Object.prototype.hasOwnProperty,X=Object.prototype.propertyIsEnumerable;var M=(t,l,s)=>l in t?$(t,l,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[l]=s,C=(t,l)=>{for(var s in l||(l={}))O.call(l,s)&&M(t,s,l[s]);if(F)for(var s of F(l))X.call(l,s)&&M(t,s,l[s]);return t},T=(t,l)=>E(t,z(l));import{r as i,j as e}from"./react-vendor-D4cZjflF.js";import{au as _,a8 as A,X as B,b as H,_ as R,P as U,$ as V,n as q,aq as K,av as G,aw as J}from"./icons-lib-DeXvYHHd.js";import{v as Q}from"./utils-lib-CuOuuFHP.js";import"./vendor-DhnXlGBj.js";const P={"To Do":{title:"للقيام به",color:"bg-slate-500"},"In Progress":{title:"قيد التنفيذ",color:"bg-sky-500"},Review:{title:"للمراجعة",color:"bg-amber-500"},Done:{title:"تم",color:"bg-green-500"}},W={Low:"bg-slate-100 text-slate-700 dark:bg-slate-700 dark:text-slate-300",Medium:"bg-sky-100 text-sky-700 dark:bg-sky-900 dark:text-sky-300",High:"bg-amber-100 text-amber-700 dark:bg-amber-900 dark:text-amber-300",Urgent:"bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300"},Y={Low:"border-slate-400",Medium:"border-sky-500",High:"border-amber-500",Urgent:"border-red-500"},Z=({item:t,viewMode:l})=>l==="compact"?e.jsxs("div",{className:`bg-white dark:bg-slate-800 p-3 rounded-lg border border-slate-200 dark:border-slate-700 shadow-sm border-l-4 ${Y[t.priority]}`,children:[e.jsx("p",{className:"font-semibold text-slate-800 dark:text-slate-200 text-sm truncate",children:t.name}),e.jsxs("div",{className:"flex justify-between items-center mt-3",children:[e.jsx("div",{className:"flex items-center -space-x-2",children:t.assignees.slice(0,3).map(s=>e.jsx("img",{src:`https://i.pravatar.cc/24?u=${s}`,className:"w-6 h-6 rounded-full border-2 border-white dark:border-slate-800",alt:s,title:s},s))}),e.jsxs("span",{className:"text-xs font-mono text-slate-500",children:[t.progress,"%"]})]})]}):e.jsxs("div",{className:"bg-white dark:bg-slate-800 p-4 rounded-lg border border-slate-200 dark:border-slate-700 shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-semibold ${W[t.priority]}`,children:t.priority}),e.jsx("button",{className:"text-slate-400 hover:text-slate-600",children:e.jsx(_,{size:18})})]}),e.jsx("p",{className:"font-semibold text-slate-800 dark:text-slate-200 mb-4",children:t.name}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between items-center text-xs text-slate-500 mb-1",children:[e.jsx("span",{children:"التقدم"}),e.jsxs("span",{children:[t.progress,"%"]})]}),e.jsx("div",{className:"w-full bg-slate-200 dark:bg-slate-700 rounded-full h-1.5",children:e.jsx("div",{className:"bg-sky-500 h-1.5 rounded-full",style:{width:`${t.progress}%`}})})]}),e.jsxs("div",{className:"flex justify-between items-center border-t border-slate-200 dark:border-slate-700 pt-3",children:[e.jsx("div",{className:"flex items-center -space-x-2",children:t.assignees.map(s=>e.jsx("img",{src:`https://i.pravatar.cc/24?u=${s}`,className:"w-6 h-6 rounded-full border-2 border-white dark:border-slate-800",alt:s,title:s},s))}),e.jsx("div",{className:"flex items-center gap-3 text-slate-500 text-xs",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(A,{size:14}),e.jsx("span",{children:new Date(t.endDate).toLocaleDateString("ar-SA",{month:"short",day:"numeric"})})]})})]})]}),ee=({items:t,onUpdateItems:l,viewMode:s})=>{const[n,g]=i.useState(null),[h,f]=i.useState(null),N=(d,c)=>{g(c),d.dataTransfer.effectAllowed="move",d.dataTransfer.setData("text/plain",c)},v=d=>{d.preventDefault(),d.currentTarget.classList.add("kanban-column-drag-over")},w=d=>{d.currentTarget.classList.remove("kanban-column-drag-over")},y=(d,c)=>{var x;d.preventDefault(),d.currentTarget.classList.remove("kanban-column-drag-over");const o=d.dataTransfer.getData("text/plain");if(o&&((x=t.find(k=>k.id===o))==null?void 0:x.status)!==c){const k=t.map(m=>m.id===o?T(C({},m),{status:c}):m);l(k),f(o),setTimeout(()=>f(null),1e3)}g(null)},p=Object.keys(P);return e.jsx("div",{className:"w-full overflow-x-auto p-2",children:e.jsx("div",{className:"flex gap-6 min-w-max",children:p.map(d=>{const c=t.filter(o=>o.status===d);return e.jsxs("div",{className:"w-80 bg-slate-50 dark:bg-slate-900/50 rounded-xl p-3 flex-shrink-0 transition-colors",onDragOver:v,onDragLeave:w,onDrop:o=>y(o,d),children:[e.jsxs("div",{className:"flex justify-between items-center mb-4 px-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${P[d].color}`}),e.jsx("h3",{className:"font-semibold text-sm text-slate-800 dark:text-slate-200",children:P[d].title})]}),e.jsx("span",{className:"text-sm font-semibold text-slate-500",children:c.length})]}),e.jsx("div",{className:"space-y-3",children:c.map(o=>e.jsx("div",{draggable:!0,onDragStart:x=>N(x,o.id),className:`cursor-move ${n===o.id?"opacity-50":""} ${h===o.id?"card-drop-success":""}`,children:e.jsx(Z,{item:o,viewMode:s})},o.id))})]},d)})})})},se=({isOpen:t,onClose:l,onSave:s,item:n})=>{const[g,h]=i.useState(""),[f,N]=i.useState("To Do"),[v,w]=i.useState("Medium"),[y,p]=i.useState(""),[d,c]=i.useState(new Date().toISOString().split("T")[0]),[o,x]=i.useState(new Date().toISOString().split("T")[0]),[k,m]=i.useState(0),[D,S]=i.useState(0);i.useEffect(()=>{if(n)h(n.name),N(n.status),w(n.priority),p(n.assignees.join(", ")),c(n.startDate),x(n.endDate),m(n.budget),S(n.progress);else{h(""),N("To Do"),w("Medium"),p("");const r=new Date().toISOString().split("T")[0];c(r),x(r),m(0),S(0)}},[n,t]);const I=r=>{if(r.preventDefault(),!g.trim())return;const L=y.split(",").map(j=>j.trim()).filter(Boolean),a={name:g,status:f,priority:v,assignees:L,startDate:d,endDate:o,budget:k,progress:D};s(n?C(C({},n),a):a),l()};return t?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center",onClick:l,children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-xl p-8 w-full max-w-2xl mx-4 max-h-[90vh] flex flex-col",onClick:r=>r.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-6 shrink-0",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:n?"تعديل البند":"إضافة بند جديد"}),e.jsx("button",{onClick:l,className:"text-slate-500 hover:text-slate-800 dark:hover:text-slate-200",children:e.jsx(B,{size:24})})]}),e.jsxs("form",{onSubmit:I,className:"flex-grow overflow-y-auto pr-2",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"itemName",className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"اسم البند"}),e.jsx("input",{id:"itemName",type:"text",value:g,onChange:r=>h(r.target.value),required:!0,className:"w-full bg-slate-100 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-sky-500"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"itemStatus",className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"الحالة"}),e.jsxs("select",{id:"itemStatus",value:f,onChange:r=>N(r.target.value),className:"w-full bg-slate-100 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-sky-500",children:[e.jsx("option",{value:"To Do",children:"To Do"}),e.jsx("option",{value:"In Progress",children:"In Progress"}),e.jsx("option",{value:"Review",children:"Review"}),e.jsx("option",{value:"Done",children:"Done"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"itemPriority",className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"الأولوية"}),e.jsxs("select",{id:"itemPriority",value:v,onChange:r=>w(r.target.value),className:"w-full bg-slate-100 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-sky-500",children:[e.jsx("option",{value:"Low",children:"Low"}),e.jsx("option",{value:"Medium",children:"Medium"}),e.jsx("option",{value:"High",children:"High"}),e.jsx("option",{value:"Urgent",children:"Urgent"})]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"itemAssignees",className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"المسؤولون (افصل بينهم بفاصلة)"}),e.jsx("input",{id:"itemAssignees",type:"text",value:y,onChange:r=>p(r.target.value),className:"w-full bg-slate-100 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-sky-500"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"itemStartDate",className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"تاريخ البدء"}),e.jsx("input",{id:"itemStartDate",type:"date",value:d,onChange:r=>c(r.target.value),required:!0,className:"w-full bg-slate-100 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-sky-500"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"itemEndDate",className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"تاريخ الانتهاء"}),e.jsx("input",{id:"itemEndDate",type:"date",value:o,onChange:r=>x(r.target.value),required:!0,className:"w-full bg-slate-100 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-sky-500"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"itemBudget",className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"الميزانية (SAR)"}),e.jsx("input",{id:"itemBudget",type:"number",value:k,onChange:r=>m(parseFloat(r.target.value)||0),className:"w-full bg-slate-100 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-sky-500"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{htmlFor:"itemProgress",className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:["التقدم (",D,"%)"]}),e.jsx("input",{id:"itemProgress",type:"range",min:"0",max:"100",value:D,onChange:r=>S(parseInt(r.target.value,10)),className:"w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer dark:bg-slate-700"})]}),e.jsxs("div",{className:"flex justify-end gap-4 mt-6 shrink-0 border-t border-slate-200 dark:border-slate-700 pt-4",children:[e.jsx("button",{type:"button",onClick:l,className:"px-4 py-2 rounded-lg text-slate-700 dark:text-slate-200 bg-slate-200 dark:bg-slate-600 hover:bg-slate-300 dark:hover:bg-slate-500",children:"إلغاء"}),e.jsx("button",{type:"submit",className:"px-4 py-2 rounded-lg text-white bg-sky-600 hover:bg-sky-700",children:"حفظ"})]})]})]})}):null},te=({items:t,onEdit:l})=>e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-right responsive-table",children:[e.jsx("thead",{className:"border-b border-slate-200 dark:border-slate-700 text-sm text-slate-500",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3",children:"البند"}),e.jsx("th",{className:"p-3",children:"الحالة"}),e.jsx("th",{className:"p-3",children:"الأولوية"}),e.jsx("th",{className:"p-3",children:"المسؤولون"}),e.jsx("th",{className:"p-3",children:"تاريخ الانتهاء"}),e.jsx("th",{className:"p-3",children:"التقدم"})]})}),e.jsx("tbody",{children:t.map(s=>e.jsxs("tr",{className:"border-b border-slate-200 dark:border-slate-700 last:border-b-0 hover:bg-slate-50 dark:hover:bg-slate-900/50 cursor-pointer",onClick:()=>l(s),children:[e.jsx("td",{className:"p-3 font-medium","data-label":"البند",children:s.name}),e.jsx("td",{className:"p-3","data-label":"الحالة",children:s.status}),e.jsx("td",{className:"p-3","data-label":"الأولوية",children:s.priority}),e.jsx("td",{className:"p-3","data-label":"المسؤولون",children:s.assignees.join(", ")}),e.jsx("td",{className:"p-3","data-label":"تاريخ الانتهاء",children:s.endDate}),e.jsx("td",{className:"p-3","data-label":"التقدم",children:e.jsx("div",{className:"w-full bg-slate-200 dark:bg-slate-700 rounded-full h-2.5",children:e.jsx("div",{className:"bg-sky-500 h-2.5 rounded-full",style:{width:`${s.progress}%`}})})})]},s.id))})]})}),ae=["To Do","In Progress","Review","Done"],le=["Low","Medium","High","Urgent"],ce=({project:t,onUpdateItems:l})=>{const s=t.data.items||[],[n,g]=i.useState("board"),[h,f]=i.useState("detailed"),[N,v]=i.useState(!1),[w,y]=i.useState(null),[p,d]=i.useState(""),[c,o]=i.useState(""),[x,k]=i.useState(""),m=i.useMemo(()=>s.filter(a=>{const j=a.name.toLowerCase().includes(p.toLowerCase()),u=c?a.status===c:!0,b=x?a.priority===x:!0;return j&&u&&b}),[s,p,c,x]),D=a=>{let j;if("id"in a&&s.some(u=>u.id===a.id))j=s.map(u=>u.id===a.id?a:u);else{const u=T(C({},a),{id:`item-${Q()}`});j=[...s,u]}l(t.id,j)},S=a=>{l(t.id,a)},I=a=>{y(a),v(!0)},r=()=>{const a=m.map(b=>({ID:b.id,البند:b.name,الحالة:b.status,الأولوية:b.priority,المسؤولون:b.assignees.join(", "),"تاريخ البدء":b.startDate,"تاريخ الانتهاء":b.endDate,الميزانية:b.budget,التقدم:b.progress})),j=XLSX.utils.json_to_sheet(a),u=XLSX.utils.book_new();XLSX.utils.book_append_sheet(u,j,"Project Items"),XLSX.writeFile(u,`project_items_${t.name.replace(/\s/g,"_")}.xlsx`)},L=()=>{window.print()};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6 flex-wrap gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold text-slate-900 dark:text-white",children:"مركز المشروع"}),e.jsxs("p",{className:"mt-1 text-slate-500 dark:text-slate-400",children:["نظرة شاملة على مهام وبنود مشروع: ",t.name]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:r,className:"flex items-center gap-2 bg-green-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-green-700",children:[e.jsx(H,{size:18}),e.jsx("span",{children:"تصدير Excel"})]}),e.jsxs("button",{onClick:L,className:"flex items-center gap-2 bg-gray-500 text-white font-semibold py-2 px-4 rounded-lg hover:bg-gray-600",children:[e.jsx(R,{size:18}),e.jsx("span",{children:"طباعة / PDF"})]}),e.jsxs("button",{onClick:()=>{y(null),v(!0)},className:"flex items-center gap-2 bg-sky-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-sky-700",children:[e.jsx(U,{size:18}),e.jsx("span",{children:"إضافة بند جديد"})]})]})]}),e.jsxs("div",{className:"mb-4 flex items-center justify-between p-2 flex-wrap gap-2 bg-slate-100 dark:bg-slate-800 rounded-xl",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("div",{className:"relative",children:[e.jsx(V,{className:"absolute right-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"}),e.jsx("input",{type:"text",placeholder:"بحث في البنود...",value:p,onChange:a=>d(a.target.value),className:"w-52 bg-white dark:bg-slate-700 rounded-lg py-2 pr-10 pl-4 focus:outline-none focus:ring-2 focus:ring-sky-500 text-sm"})]}),e.jsxs("select",{value:c,onChange:a=>o(a.target.value),className:"bg-white dark:bg-slate-700 rounded-lg py-2 px-3 focus:outline-none focus:ring-2 focus:ring-sky-500 text-sm",children:[e.jsx("option",{value:"",children:"كل الحالات"}),ae.map(a=>e.jsx("option",{value:a,children:a},a))]}),e.jsxs("select",{value:x,onChange:a=>k(a.target.value),className:"bg-white dark:bg-slate-700 rounded-lg py-2 px-3 focus:outline-none focus:ring-2 focus:ring-sky-500 text-sm",children:[e.jsx("option",{value:"",children:"كل الأولويات"}),le.map(a=>e.jsx("option",{value:a,children:a},a))]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-1 bg-white dark:bg-slate-700 p-1 rounded-lg",children:[e.jsx("button",{onClick:()=>g("board"),className:`p-2 rounded-md ${n==="board"?"bg-slate-100 dark:bg-slate-800 shadow-sm text-sky-600":"text-slate-500"}`,"aria-label":"Kanban view",children:e.jsx(q,{size:18})}),e.jsx("button",{onClick:()=>g("list"),className:`p-2 rounded-md ${n==="list"?"bg-slate-100 dark:bg-slate-800 shadow-sm text-sky-600":"text-slate-500"}`,"aria-label":"List view",children:e.jsx(K,{size:18})})]}),n==="board"&&e.jsxs("div",{className:"flex items-center gap-1 bg-white dark:bg-slate-700 p-1 rounded-lg",children:[e.jsx("button",{onClick:()=>f("compact"),className:`p-2 rounded-md ${h==="compact"?"bg-slate-100 dark:bg-slate-800 shadow-sm text-sky-600":"text-slate-500"}`,"aria-label":"Compact card view",title:"Compact View",children:e.jsx(G,{size:18})}),e.jsx("button",{onClick:()=>f("detailed"),className:`p-2 rounded-md ${h==="detailed"?"bg-slate-100 dark:bg-slate-800 shadow-sm text-sky-600":"text-slate-500"}`,"aria-label":"Detailed card view",title:"Detailed View",children:e.jsx(J,{size:18})})]})]})]}),n==="board"?e.jsx(ee,{items:m,onUpdateItems:S,viewMode:h}):e.jsx("div",{className:"bg-white dark:bg-slate-800 p-4 rounded-xl shadow-md",children:e.jsx(te,{items:m,onEdit:I})}),e.jsx(se,{isOpen:N,onClose:()=>v(!1),onSave:D,item:w})]})};export{ce as ProjectHub};
