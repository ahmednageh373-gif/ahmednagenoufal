var F=Object.defineProperty,k=Object.defineProperties;var I=Object.getOwnPropertyDescriptors;var w=Object.getOwnPropertySymbols;var L=Object.prototype.hasOwnProperty,R=Object.prototype.propertyIsEnumerable;var D=(s,a,n)=>a in s?F(s,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[a]=n,f=(s,a)=>{for(var n in a||(a={}))L.call(a,n)&&D(s,n,a[n]);if(w)for(var n of w(a))R.call(a,n)&&D(s,n,a[n]);return s},y=(s,a)=>k(s,I(a));var j=(s,a,n)=>new Promise((c,u)=>{var x=d=>{try{i(n.next(d))}catch(t){u(t)}},m=d=>{try{i(n.throw(d))}catch(t){u(t)}},i=d=>d.done?c(d.value):Promise.resolve(d.value).then(x,m);i((n=n.apply(s,a)).next())});import{r as p,j as e}from"./react-vendor-ITqvX6Xp.js";import{aX as N,a4 as v,U as P,bc as E,Y as S,F as U,f as T,a9 as $,be as O}from"./icons-lib-Dd_BpYQ6.js";import"./vendor-8CkhJSGZ.js";function B({onUploadComplete:s,onError:a}){const[n,c]=p.useState(!1),[u,x]=p.useState(!1),[m,i]=p.useState(0),d=p.useCallback(r=>{r.preventDefault(),c(!1),t(r.dataTransfer.files[0])},[]),t=p.useCallback(r=>j(null,null,function*(){try{const o=["application/pdf","text/plain","image/jpeg","image/png"],g=r.name.toLowerCase().endsWith(".dxf");if(!o.includes(r.type)&&!g){a("نوع الملف غير مدعوم. الأنواع المدعومة: PDF, DXF, صور");return}if(r.size>50*1024*1024){a("حجم الملف كبير جداً. الحد الأقصى 50 MB");return}x(!0),i(0);const b=setInterval(()=>{i(C=>Math.min(C+10,90))},200),l=yield r.text(),h=`upload-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;clearInterval(b),i(100),setTimeout(()=>{x(!1),i(0),s(h,{filename:r.name,filesize:r.size,filetype:r.type||"text/plain",content:l})},500)}catch(o){x(!1),i(0),a(o instanceof Error?o.message:"خطأ غير معروف")}}),[s,a]);return e.jsx("div",{className:"w-full",children:e.jsx("div",{onDrop:d,onDragOver:r=>{r.preventDefault(),c(!0)},onDragLeave:()=>c(!1),className:`border-2 border-dashed rounded-lg p-12 text-center cursor-pointer transition ${n?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400"}`,children:u?e.jsxs("div",{className:"space-y-4",children:[e.jsx(v,{className:"w-12 h-12 animate-spin mx-auto text-blue-500"}),e.jsx("p",{className:"text-gray-600",children:"جاري رفع الملف..."}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-500 h-2 rounded-full transition-all",style:{width:`${m}%`}})}),e.jsxs("p",{className:"text-sm text-gray-500",children:[m,"%"]})]}):e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"w-12 h-12 mx-auto mb-4 text-gray-400"}),e.jsx("p",{className:"text-lg font-semibold text-gray-700 mb-2",children:"اسحب الملف هنا أو انقر للاختيار"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"الأنواع المدعومة: DXF, PDF, صور (JPEG, PNG)"}),e.jsx("p",{className:"text-xs text-gray-400",children:"الحد الأقصى: 50 MB"}),e.jsx("input",{type:"file",onChange:r=>r.target.files&&t(r.target.files[0]),className:"hidden",accept:".dxf,.pdf,.jpg,.jpeg,.png",id:"file-input"}),e.jsx("label",{htmlFor:"file-input",className:"mt-4 inline-block",children:e.jsx("button",{className:"px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition",onClick:r=>{var o;r.preventDefault(),(o=document.getElementById("file-input"))==null||o.click()},children:"اختر ملف"})})]})})})}function M({quantities:s,onEdit:a,isEditable:n=!1}){const[c,u]=p.useState(null),[x,m]=p.useState({}),i=t=>{u(t.id),m(t)},d=t=>{a&&a(x),u(null)};return e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-100 border-b-2 border-gray-300",children:[e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-gray-700",children:"الاسم"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-gray-700",children:"الكمية"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-gray-700",children:"الوحدة"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-gray-700",children:"المادة"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-gray-700",children:"درجة الثقة"}),n&&e.jsx("th",{className:"px-4 py-3 text-center text-sm font-semibold text-gray-700",children:"الإجراءات"})]})}),e.jsx("tbody",{children:s.map((t,r)=>e.jsxs("tr",{className:`border-b ${r%2===0?"bg-white":"bg-gray-50"} hover:bg-gray-100`,children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-800",children:c===t.id?e.jsx("input",{type:"text",value:x.name,onChange:o=>m(y(f({},x),{name:o.target.value})),className:"w-full px-2 py-1 border rounded"}):t.name}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-800",children:c===t.id?e.jsx("input",{type:"number",value:x.value,onChange:o=>m(y(f({},x),{value:parseFloat(o.target.value)})),className:"w-full px-2 py-1 border rounded"}):t.value.toLocaleString()}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-800",children:t.unit}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-800",children:t.material}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-24 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full transition-all ${t.confidence>=.8?"bg-green-500":t.confidence>=.6?"bg-yellow-500":"bg-red-500"}`,style:{width:`${t.confidence*100}%`}})}),e.jsxs("span",{className:"text-xs text-gray-600",children:[(t.confidence*100).toFixed(0),"%"]})]})}),n&&e.jsx("td",{className:"px-4 py-3 text-center",children:c===t.id?e.jsx("button",{onClick:()=>d(t.id),className:"px-3 py-1 bg-green-500 text-white rounded text-sm hover:bg-green-600",children:"حفظ"}):e.jsx("button",{onClick:()=>i(t),className:"px-3 py-1 bg-blue-500 text-white rounded text-sm hover:bg-blue-600",children:e.jsx(O,{className:"w-4 h-4 inline"})})})]},t.id))})]})})}function X({results:s,isLoading:a=!1,error:n=null}){var x,m,i,d,t,r,o,g,b;const[c,u]=p.useState("quantities");return a?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx(v,{className:"w-8 h-8 animate-spin text-blue-500"}),e.jsx("span",{className:"mr-3 text-gray-600",children:"جاري معالجة الملف..."})]}):n?e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 flex items-start gap-3",children:[e.jsx(N,{className:"w-5 h-5 text-red-500 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-red-800",children:"خطأ في المعالجة"}),e.jsx("p",{className:"text-sm text-red-700 mt-1",children:n})]})]}):s?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(E,{className:"w-5 h-5 text-blue-600"}),e.jsx("p",{className:"text-sm text-gray-600",children:"عدد العناصر"})]}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:((x=s.quantities)==null?void 0:x.length)||0})]}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(S,{className:"w-5 h-5 text-green-600"}),e.jsx("p",{className:"text-sm text-gray-600",children:"درجة الثقة"})]}),e.jsxs("p",{className:"text-2xl font-bold text-green-600",children:[((((m=s.summary)==null?void 0:m.overallConfidence)||0)*100).toFixed(0),"%"]})]}),e.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(U,{className:"w-5 h-5 text-purple-600"}),e.jsx("p",{className:"text-sm text-gray-600",children:"التكلفة المقدرة"})]}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:(((i=s.summary)==null?void 0:i.estimatedCost)||0).toLocaleString()})]}),e.jsxs("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(T,{className:"w-5 h-5 text-orange-600"}),e.jsx("p",{className:"text-sm text-gray-600",children:"العملة"})]}),e.jsx("p",{className:"text-2xl font-bold text-orange-600",children:((d=s.summary)==null?void 0:d.currency)||"SAR"})]})]}),e.jsx("div",{className:"border-b border-gray-200",children:e.jsx("div",{className:"flex gap-4",children:["quantities","dimensions","materials","summary"].map(l=>e.jsxs("button",{onClick:()=>u(l),className:`px-4 py-2 font-medium border-b-2 transition ${c===l?"border-blue-500 text-blue-600":"border-transparent text-gray-600 hover:text-gray-800"}`,children:[l==="quantities"&&"الكميات",l==="dimensions"&&"الأبعاد",l==="materials"&&"المواد",l==="summary"&&"الملخص"]},l))})}),e.jsxs("div",{children:[c==="quantities"&&e.jsx(M,{quantities:s.quantities||[]}),c==="dimensions"&&e.jsx("div",{className:"space-y-3",children:(t=s.dimensions)==null?void 0:t.map((l,h)=>e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("p",{className:"font-semibold text-gray-800",children:l.type}),e.jsxs("p",{className:"text-sm text-gray-600",children:[l.value," ",l.unit," (ثقة: ",(l.confidence*100).toFixed(0),"%)"]})]},h))}),c==="materials"&&e.jsx("div",{className:"space-y-3",children:(r=s.materials)==null?void 0:r.map((l,h)=>e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("p",{className:"font-semibold text-gray-800",children:l.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:[l.quantity," ",l.unit," ",l.specifications&&`- ${l.specifications}`]})]},h))}),c==="summary"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-gray-800 mb-3",children:"التوصيات"}),e.jsx("ul",{className:"space-y-2",children:(o=s.recommendations)==null?void 0:o.map((l,h)=>e.jsxs("li",{className:"flex items-start gap-2 text-sm text-gray-700",children:[e.jsx(S,{className:"w-4 h-4 text-green-500 mt-0.5 flex-shrink-0"}),l]},h))})]}),((g=s.warnings)==null?void 0:g.length)>0&&e.jsxs("div",{className:"bg-yellow-50 p-4 rounded-lg border border-yellow-200",children:[e.jsx("h3",{className:"font-semibold text-yellow-800 mb-3",children:"تحذيرات"}),e.jsx("ul",{className:"space-y-2",children:(b=s.warnings)==null?void 0:b.map((l,h)=>e.jsxs("li",{className:"flex items-start gap-2 text-sm text-yellow-700",children:[e.jsx(N,{className:"w-4 h-4 text-yellow-600 mt-0.5 flex-shrink-0"}),l]},h))})]})]})]})]}):null}function A({results:s,onExportComplete:a}){const[n,c]=p.useState(!1),[u,x]=p.useState("json"),m=()=>j(null,null,function*(){try{c(!0);let i,d,t;u==="json"?(i=JSON.stringify(s,null,2),d="quantities.json",t="application/json"):u==="csv"?(i=[["الاسم","الكمية","الوحدة","المادة","درجة الثقة"].join(","),...s.quantities.map(l=>[l.name,l.value,l.unit,l.material,l.confidence].join(","))].join(`
`),d="quantities.csv",t="text/csv"):(i=JSON.stringify(s,null,2),d="quantities.xlsx",t="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet");const r=new Blob([i],{type:t}),o=window.URL.createObjectURL(r),g=document.createElement("a");g.href=o,g.download=d,g.click(),window.URL.revokeObjectURL(o),a==null||a()}catch(i){console.error("خطأ في التصدير:",i)}finally{c(!1)}});return e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-6",children:[e.jsx("h3",{className:"font-semibold text-gray-800 mb-4",children:"تصدير النتائج"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("select",{value:u,onChange:i=>x(i.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"json",children:"JSON"}),e.jsx("option",{value:"csv",children:"CSV"}),e.jsx("option",{value:"excel",children:"Excel"})]}),e.jsxs("button",{onClick:m,disabled:n,className:"flex items-center gap-2 px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 disabled:bg-gray-400 transition",children:[n?e.jsx(v,{className:"w-4 h-4 animate-spin"}):e.jsx($,{className:"w-4 h-4"}),n?"جاري التصدير...":"تصدير"]})]})]})}function Q(){const[s,a]=p.useState(null),[n,c]=p.useState(null),[u,x]=p.useState(!1),[m,i]=p.useState(null),d=p.useCallback((t,r)=>j(null,null,function*(){a(t),i(null),x(!0);try{yield new Promise(g=>setTimeout(g,2e3)),c({quantityId:t,quantities:[{id:"1",name:"جدران خرسانية",description:"جدران خرسانية مسلحة",value:250,unit:"م³",material:"خرسانة",confidence:.92,specifications:"خرسانة عادية 350 كجم/م³"},{id:"2",name:"حديد التسليح",description:"حديد التسليح للجدران",value:18.5,unit:"طن",material:"حديد",confidence:.88,specifications:"حديد قطر 16 مم"},{id:"3",name:"أعمال البلاط",description:"بلاط أرضيات",value:450,unit:"م²",material:"بلاط",confidence:.85,specifications:"بلاط سيراميك 60×60"},{id:"4",name:"أعمال الدهانات",description:"دهان الجدران الداخلية",value:800,unit:"م²",material:"دهان",confidence:.9,specifications:"دهان بلاستيك"},{id:"5",name:"أعمال النجارة",description:"أبواب خشبية",value:12,unit:"باب",material:"خشب",confidence:.78,specifications:"أبواب MDF"}],dimensions:[{type:"الطول الكلي",value:45,unit:"م",confidence:.95},{type:"العرض الكلي",value:30,unit:"م",confidence:.95},{type:"الارتفاع",value:3.5,unit:"م",confidence:.9},{type:"المساحة الكلية",value:1350,unit:"م²",confidence:.93}],materials:[{name:"خرسانة عادية",quantity:250,unit:"م³",specifications:"350 كجم/م³"},{name:"حديد التسليح",quantity:18.5,unit:"طن",specifications:"قطر 16 مم"},{name:"بلاط سيراميك",quantity:450,unit:"م²",specifications:"60×60 سم"},{name:"دهان بلاستيك",quantity:800,unit:"م²",specifications:"أبيض"},{name:"أبواب MDF",quantity:12,unit:"باب",specifications:"90×200 سم"}],summary:{overallConfidence:.88,estimatedCost:45e4,currency:"SAR"},recommendations:["التأكد من مراجعة الكميات المستخرجة مع المخططات الأصلية","يوصى بإضافة نسبة 10% للهدر في المواد","مراجعة الأبعاد الرئيسية للمبنى","التحقق من مواصفات المواد مع المواصفات القياسية"],warnings:["بعض الأبعاد قد تحتاج إلى مراجعة دقيقة","درجة الثقة في أعمال النجارة أقل من 80%"]})}catch(o){i(o instanceof Error?o.message:"خطأ غير معروف")}finally{x(!1)}}),[]);return e.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:e.jsxs("div",{className:"max-w-6xl mx-auto px-4",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"استخراج الكميات"}),e.jsx("p",{className:"text-gray-600",children:"قم برفع ملف DXF أو PDF أو صورة لاستخراج الكميات والأبعاد بشكل ذكي"})]}),e.jsxs("div",{className:"space-y-8",children:[!s&&e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsx(B,{onUploadComplete:d,onError:i})}),s&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsx(X,{results:n,isLoading:u,error:m})}),n&&e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsx(A,{results:n,onExportComplete:()=>{a(null),c(null)}})}),e.jsx("button",{onClick:()=>{a(null),c(null),i(null)},className:"w-full px-6 py-3 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition font-medium",children:"رفع ملف جديد"})]}),m&&!s&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 flex items-start gap-3",children:[e.jsx(N,{className:"w-5 h-5 text-red-500 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-red-800",children:"خطأ"}),e.jsx("p",{className:"text-sm text-red-700 mt-1",children:m})]})]})]})]})})}export{Q as default};
