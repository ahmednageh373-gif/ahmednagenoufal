var w=Object.defineProperty,A=Object.defineProperties;var b=Object.getOwnPropertyDescriptors;var f=Object.getOwnPropertySymbols;var y=Object.prototype.hasOwnProperty,v=Object.prototype.propertyIsEnumerable;var m=(d,t,a)=>t in d?w(d,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):d[t]=a,g=(d,t)=>{for(var a in t||(t={}))y.call(t,a)&&m(d,a,t[a]);if(f)for(var a of f(t))v.call(t,a)&&m(d,a,t[a]);return d},h=(d,t)=>A(d,b(t));class I{static performResourceLeveling(t,a){const s=this.buildHistogram(t),n=s.map(p=>p.laborCount),e=Math.max(...n),u=n.reduce((p,D)=>p+D,0)/n.length,i=e/u,r=i<=1.2,o=a?e<=a:!0,c=[];return r||(c.push(`âš ï¸ Peak (${e}) ÙŠØªØ¬Ø§ÙˆØ² 120% Ù…Ù† Average (${u.toFixed(0)}). Ù†Ø³Ø¨Ø©: ${(i*100).toFixed(0)}%`),c.push("ðŸ’¡ ØªÙˆØµÙŠØ©: Split Activity - Ù‚Ø³Ù‘Ù… Ø§Ù„Ø£Ù†Ø´Ø·Ø© Ø°Ø§Øª Ø§Ù„Ø£Ø­Ù…Ø§Ù„ Ø§Ù„Ø¹Ø§Ù„ÙŠØ©"),c.push("ðŸ’¡ ØªÙˆØµÙŠØ©: Increase Crews - Ø²Ø¯ Ø¹Ø¯Ø¯ Ø§Ù„Ø·ÙˆØ§Ù‚Ù…"),c.push("ðŸ’¡ ØªÙˆØµÙŠØ©: Add Shift - Ø­ÙˆÙ‘Ù„ Ø¨Ø¹Ø¶ Ø§Ù„Ø£Ù†Ø´Ø·Ø© Ø¥Ù„Ù‰ ÙˆØ±Ø¯ÙŠØªÙŠÙ†")),a&&!o&&(c.push(`ðŸš« Peak (${e}) ÙŠØªØ¬Ø§ÙˆØ² Ø§Ù„Ø·Ø§Ù‚Ø© Ø§Ù„Ù‚ØµÙˆÙ‰ (${a})`),c.push("ðŸ’¡ ØªÙˆØµÙŠØ©: Schedule Adjustment - Ø£Ø¹Ø¯ Ø¬Ø¯ÙˆÙ„Ø© Ø§Ù„Ø£Ù†Ø´Ø·Ø© Ø§Ù„Ù…ØªØ²Ø§Ù…Ù†Ø©")),r&&o&&c.push("âœ… Ø§Ù„Ø£Ø­Ù…Ø§Ù„ Ù…ØªÙˆØ§Ø²Ù†Ø© Ø¶Ù…Ù† Ø§Ù„Ø·Ø§Ù‚Ø© Ø§Ù„Ø§Ø³ØªÙŠØ¹Ø§Ø¨ÙŠØ©"),{histogram:s,peakLabor:e,averageLabor:Number(u.toFixed(1)),peakToAverageRatio:Number(i.toFixed(2)),isBalanced:r&&o,recommendations:c}}static buildHistogram(t){const a=new Set;return t.forEach(e=>{const u=new Date(e.startDate),i=new Date(e.endDate);for(let r=new Date(u);r<=i;r.setDate(r.getDate()+1))a.add(r.toISOString().split("T")[0])}),Array.from(a).sort().map(e=>{let u=0,i=0,r=0;return t.forEach(o=>{const c=new Date(o.startDate),p=new Date(o.endDate),D=new Date(e);D>=c&&D<=p&&o.resources.forEach(l=>{l.resourceType==="Labor"?u+=l.quantity:l.resourceType==="Equipment"?i+=l.quantity:l.resourceType==="Material"&&(r+=(l.dailyRate||0)*l.quantity)})}),{date:e,laborCount:u,equipmentCount:i,materialCost:r}})}static suggestOptimizations(t,a){if(a.isBalanced)return[];const s=[];return a.histogram.filter(e=>e.laborCount>a.averageLabor*1.2).map(e=>e.date).forEach(e=>{t.filter(i=>{const r=new Date(i.startDate),o=new Date(i.endDate),c=new Date(e);return c>=r&&c<=o}).forEach(i=>{const r=i.resources.filter(o=>o.resourceType==="Labor").reduce((o,c)=>o+c.quantity,0);r>10&&s.push({activityId:i.id,currentLabor:r,suggestion:`Split Activity: Ù‚Ø³Ù‘Ù… "${i.name}" Ø¥Ù„Ù‰ Ø£Ø¬Ø²Ø§Ø¡ Ø£ØµØºØ±`})})}),s}static autoOptimize(t,a=5){let s=[...t],n=0,e=this.performResourceLeveling(s);for(;!e.isBalanced&&n<a;){n++;const u=this.suggestOptimizations(s,e);if(u.length===0)break;const i=u[0];s=this.splitActivity(s,i.activityId),e=this.performResourceLeveling(s)}return{optimizedActivities:s,iterations:n,finalResult:e}}static splitActivity(t,a){const s=t.findIndex(o=>o.id===a);if(s===-1)return t;const n=t[s],e=Math.ceil((n.adjustedDuration||n.duration)/2),u=h(g({},n),{id:n.id,name:`${n.name} - Part 1`,duration:e,adjustedDuration:e,endDate:this.addDays(new Date(n.startDate),e).toISOString().split("T")[0]}),i=h(g({},n),{id:t.length+1,name:`${n.name} - Part 2`,duration:e,adjustedDuration:e,startDate:this.addDays(new Date(n.startDate),e).toISOString().split("T")[0],dependencies:[{predecessorId:n.id,type:"FS",lag:0}]}),r=[...t];return r[s]=u,r.push(i),r}static addDays(t,a){const s=new Date(t);return s.setDate(s.getDate()+a),s}}export{I as ResourceLevelingEngine};
