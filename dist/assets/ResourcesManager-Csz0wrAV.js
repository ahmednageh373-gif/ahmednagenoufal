var V=Object.defineProperty,B=Object.defineProperties;var W=Object.getOwnPropertyDescriptors;var P=Object.getOwnPropertySymbols;var G=Object.prototype.hasOwnProperty,K=Object.prototype.propertyIsEnumerable;var E=(t,o,s)=>o in t?V(t,o,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[o]=s,N=(t,o)=>{for(var s in o||(o={}))G.call(o,s)&&E(t,s,o[s]);if(P)for(var s of P(o))K.call(o,s)&&E(t,s,o[s]);return t},w=(t,o)=>B(t,W(o));import{r as d,j as e}from"./react-vendor-D4cZjflF.js";import{j as v,ae as X,P as Y,a as Z,l as S,H as C,F as R,$ as ee,bo as te,ah as ae}from"./icons-lib-DeXvYHHd.js";import"./vendor-DhnXlGBj.js";const de=({project:t,onUpdateProject:o})=>{const[s,m]=d.useState(()=>{const a=localStorage.getItem(`resources_${t.id}`);return a?JSON.parse(a):[]}),[b,h]=d.useState("all"),[g,f]=d.useState("all"),[u,k]=d.useState(""),[F,p]=d.useState(!1),[A,D]=d.useState(null),[L,U]=d.useState("overview"),y=a=>{m(a),localStorage.setItem(`resources_${t.id}`,JSON.stringify(a))},q=d.useMemo(()=>s.filter(a=>{const n=b==="all"||a.type===b,i=g==="all"||a.status===g,c=u===""||a.name.toLowerCase().includes(u.toLowerCase())||"category"in a&&a.category.toLowerCase().includes(u.toLowerCase());return n&&i&&c}),[s,b,g,u]),l=d.useMemo(()=>{const a=s.filter(r=>r.type==="labor"),n=s.filter(r=>r.type==="equipment"),i=s.filter(r=>r.type==="material"),c=s.filter(r=>r.type==="subcontractor"),$=a.reduce((r,x)=>r+x.costPerDay*x.totalWorkedDays,0),T=n.reduce((r,x)=>r+x.costPerDay*30,0),z=i.reduce((r,x)=>r+x.costPerUnit*x.quantityRequired,0),M=c.reduce((r,x)=>r+x.contractValue,0);return{laborCount:a.length,laborAvailable:a.filter(r=>r.status==="available").length,equipmentCount:n.length,equipmentAvailable:n.filter(r=>r.status==="available").length,materialCount:i.length,materialLowStock:i.filter(r=>r.quantityInStock<=r.reorderLevel).length,subcontractorCount:c.length,subcontractorActive:c.filter(r=>r.status==="assigned").length,totalLaborCost:$,totalEquipmentCost:T,totalMaterialCost:z,totalSubcontractorCost:M,totalCost:$+T+z+M}},[s]),_=()=>{D(null),p(!0)},I=a=>{D(a),p(!0)},O=a=>{confirm("هل أنت متأكد من حذف هذا المورد؟")&&y(s.filter(n=>n.id!==a))},J=a=>{y(A?s.map(n=>n.id===a.id?a:n):[...s,w(N({},a),{id:Date.now().toString()})]),p(!1)},H=(a,n)=>{y(s.map(i=>i.id===a?w(N({},i),{assignedTo:n,status:"assigned"}):i))},Q=()=>{const a={projectName:t.name,generatedDate:new Date().toLocaleDateString("ar-SA"),statistics:l,resources:q},n=new Blob([JSON.stringify(a,null,2)],{type:"application/json"}),i=URL.createObjectURL(n),c=document.createElement("a");c.href=i,c.download=`تقرير_الموارد_${t.name}_${Date.now()}.json`,c.click()};return e.jsxs("div",{className:"h-full flex flex-col bg-gradient-to-br from-gray-50 to-blue-50 dark:from-gray-900 dark:to-blue-900/20",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white flex items-center gap-3",children:[e.jsx(v,{className:"text-blue-600"}),"إدارة الموارد - ",t.name]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:"نظام شامل لإدارة العمالة، المعدات، المواد، والمقاولين الفرعيين"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:Q,className:"flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700",children:[e.jsx(X,{size:20}),"تصدير التقرير"]}),e.jsxs("button",{onClick:_,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[e.jsx(Y,{size:20}),"إضافة مورد"]})]})]}),e.jsx("div",{className:"flex gap-2 border-b border-gray-200 dark:border-gray-700",children:[{key:"overview",label:"نظرة عامة",icon:Z},{key:"labor",label:"العمالة",icon:S},{key:"equipment",label:"المعدات",icon:C},{key:"material",label:"المواد",icon:v},{key:"subcontractor",label:"المقاولون",icon:R}].map(a=>e.jsxs("button",{onClick:()=>{U(a.key),h(a.key==="overview"?"all":a.key)},className:`flex items-center gap-2 px-4 py-2 border-b-2 transition-colors ${L===a.key?"border-blue-600 text-blue-600 dark:text-blue-400":"border-transparent text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white"}`,children:[e.jsx(a.icon,{size:18}),a.label]},a.key))})]}),L==="overview"&&e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[e.jsx(j,{title:"إجمالي العمالة",value:l.laborCount.toString(),subtitle:`${l.laborAvailable} متاح`,icon:S,color:"bg-blue-500",amount:l.totalLaborCost}),e.jsx(j,{title:"المعدات",value:l.equipmentCount.toString(),subtitle:`${l.equipmentAvailable} متاح`,icon:C,color:"bg-purple-500",amount:l.totalEquipmentCost}),e.jsx(j,{title:"المواد",value:l.materialCount.toString(),subtitle:`${l.materialLowStock} قليل المخزون`,icon:v,color:"bg-orange-500",amount:l.totalMaterialCost}),e.jsx(j,{title:"المقاولون الفرعيون",value:l.subcontractorCount.toString(),subtitle:`${l.subcontractorActive} نشط`,icon:R,color:"bg-green-500",amount:l.totalSubcontractorCost})]}),e.jsxs("div",{className:"bg-gradient-to-r from-indigo-600 to-purple-600 rounded-xl p-6 text-white mb-6",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"إجمالي تكلفة الموارد"}),e.jsxs("p",{className:"text-4xl font-bold",children:[l.totalCost.toLocaleString("ar-SA")," ريال"]}),e.jsxs("div",{className:"grid grid-cols-4 gap-4 mt-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"opacity-80",children:"العمالة"}),e.jsxs("p",{className:"font-semibold",children:[(l.totalLaborCost/l.totalCost*100).toFixed(1),"%"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"opacity-80",children:"المعدات"}),e.jsxs("p",{className:"font-semibold",children:[(l.totalEquipmentCost/l.totalCost*100).toFixed(1),"%"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"opacity-80",children:"المواد"}),e.jsxs("p",{className:"font-semibold",children:[(l.totalMaterialCost/l.totalCost*100).toFixed(1),"%"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"opacity-80",children:"المقاولون"}),e.jsxs("p",{className:"font-semibold",children:[(l.totalSubcontractorCost/l.totalCost*100).toFixed(1),"%"]})]})]})]})]}),e.jsx("div",{className:"px-6 pb-4",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(ee,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:20}),e.jsx("input",{type:"text",placeholder:"بحث عن مورد...",value:u,onChange:a=>k(a.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white"})]}),e.jsxs("select",{value:g,onChange:a=>f(a.target.value),className:"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white",children:[e.jsx("option",{value:"all",children:"جميع الحالات"}),e.jsx("option",{value:"available",children:"متاح"}),e.jsx("option",{value:"assigned",children:"مُعيّن"}),e.jsx("option",{value:"unavailable",children:"غير متاح"}),e.jsx("option",{value:"maintenance",children:"صيانة"})]})]})}),e.jsx("div",{className:"flex-1 overflow-auto px-6 pb-6",children:e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase",children:"النوع"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase",children:"الاسم"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase",children:"التصنيف"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase",children:"الحالة"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase",children:"التكلفة"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase",children:"معيّن لـ"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase",children:"إجراءات"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:q.map(a=>e.jsx(se,{resource:a,tasks:t.data.schedule,onEdit:I,onDelete:O,onAssign:H},a.id))})]})})})}),F&&e.jsx(re,{resource:A,onSave:J,onClose:()=>p(!1)})]})},j=({title:t,value:o,subtitle:s,icon:m,color:b,amount:h})=>e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-6 border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsx("div",{className:`p-3 rounded-lg ${b}`,children:e.jsx(m,{className:"text-white",size:24})}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:o}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:s})]})]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300 mb-1",children:t}),e.jsxs("p",{className:"text-lg font-semibold text-blue-600 dark:text-blue-400",children:[h.toLocaleString("ar-SA")," ريال"]})]}),se=({resource:t,tasks:o,onEdit:s,onDelete:m,onAssign:b})=>{const h=()=>{switch(t.type){case"labor":return e.jsx(S,{size:16});case"equipment":return e.jsx(C,{size:16});case"material":return e.jsx(v,{size:16});case"subcontractor":return e.jsx(R,{size:16})}},g=()=>{switch(t.status){case"available":return"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200";case"assigned":return"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200";case"unavailable":return"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200";case"maintenance":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200"}},f=()=>t.type==="material"?`${t.costPerUnit}/وحدة`:t.type==="subcontractor"?`${t.contractValue.toLocaleString("ar-SA")}`:`${t.costPerDay}/يوم`,u=t.assignedTo?o.find(k=>k.id===t.assignedTo):null;return e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2 text-gray-700 dark:text-gray-300",children:[h(),e.jsxs("span",{className:"text-sm",children:[t.type==="labor"&&"عمالة",t.type==="equipment"&&"معدات",t.type==="material"&&"مواد",t.type==="subcontractor"&&"مقاول"]})]})}),e.jsx("td",{className:"px-6 py-4 text-sm font-medium text-gray-900 dark:text-white",children:t.name}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-700 dark:text-gray-300",children:"category"in t&&t.category}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${g()}`,children:[t.status==="available"&&"متاح",t.status==="assigned"&&"مُعيّن",t.status==="unavailable"&&"غير متاح",t.status==="maintenance"&&"صيانة"]})}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-700 dark:text-gray-300",children:f()}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-700 dark:text-gray-300",children:u?u.name:"-"}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>s(t),className:"p-1 text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-200",children:e.jsx(te,{size:16})}),e.jsx("button",{onClick:()=>m(t.id),className:"p-1 text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-200",children:e.jsx(ae,{size:16})})]})})]})},re=({resource:t,onSave:o,onClose:s})=>{const[m,b]=d.useState(t||{type:"labor",status:"available"}),h=g=>{g.preventDefault(),o(m)};return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-4",children:t?"تعديل المورد":"إضافة مورد جديد"}),e.jsxs("form",{onSubmit:h,className:"space-y-4",children:[e.jsx("div",{className:"text-center text-gray-600 dark:text-gray-400",children:"النموذج التفصيلي سيتم إضافته"}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{type:"button",onClick:s,className:"px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:"إلغاء"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"حفظ"})]})]})]})})})};export{de as ResourcesManager,de as default};
