var A=Object.defineProperty,H=Object.defineProperties;var V=Object.getOwnPropertyDescriptors;var X=Object.getOwnPropertySymbols;var q=Object.prototype.hasOwnProperty,B=Object.prototype.propertyIsEnumerable;var D=(s,l,t)=>l in s?A(s,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[l]=t,M=(s,l)=>{for(var t in l||(l={}))q.call(l,t)&&D(s,t,l[t]);if(X)for(var t of X(l))B.call(l,t)&&D(s,t,l[t]);return s},P=(s,l)=>H(s,V(l));var _=(s,l,t)=>new Promise((n,d)=>{var c=g=>{try{m(t.next(g))}catch(h){d(h)}},x=g=>{try{m(t.throw(g))}catch(h){d(h)}},m=g=>g.done?n(g.value):Promise.resolve(g.value).then(c,x);m((t=t.apply(s,l)).next())});import{j as e,r,f as K}from"./react-vendor-ITqvX6Xp.js";import{s as G}from"./index-ClqhgGpL.js";import{X as J,a9 as Q,aa as U,R as W,K as Y,P as Z,V as ee,ab as F,ac as O,C as L}from"./icons-lib-Dd_BpYQ6.js";import"./vendor-8CkhJSGZ.js";import"./vendor-large-gsDFeA65.js";import"./genai-lib-pAIF5Ws4.js";import"./utils-lib-C_gzCXPI.js";const se=({isOpen:s,onClose:l,title:t,children:n,size:d="2xl"})=>{if(!s)return null;const c={md:"max-w-md",lg:"max-w-lg",xl:"max-w-xl","2xl":"max-w-2xl","4xl":"max-w-4xl","6xl":"max-w-6xl"};return e.jsx("div",{className:"modal",style:{display:"block"},onClick:l,children:e.jsxs("div",{className:`modal-content p-8 ${c[d]} dark:bg-gray-800`,onClick:x=>x.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-6 shrink-0",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:t}),e.jsx("button",{onClick:l,className:"text-slate-500 hover:text-slate-800 dark:hover:text-slate-200",children:e.jsx(J,{size:24})})]}),n]})})},te=({isOpen:s,onClose:l,onSave:t,risk:n})=>{const[d,c]=r.useState(""),[x,m]=r.useState("Technical"),[g,h]=r.useState("Medium"),[u,j]=r.useState("Medium"),[k,f]=r.useState(""),[R,w]=r.useState("Open");r.useEffect(()=>{n?(c(n.description),m(n.category),h(n.probability),j(n.impact),f(n.mitigationPlan),w(n.status)):(c(""),m("Technical"),h("Medium"),j("Medium"),f(""),w("Open"))},[n,s]);const z=i=>{if(i.preventDefault(),!d.trim())return;const v={description:d,category:x,probability:g,impact:u,mitigationPlan:k,status:R};t(n?P(M({},v),{id:n.id}):v),l()},N=(i,v,E,$,I)=>e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:i,className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:v}),e.jsx("select",{id:i,value:E,onChange:$,className:"w-full bg-slate-100 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-sky-500",children:I.map(C=>e.jsx("option",{value:C,children:C},C))})]});return e.jsx(se,{isOpen:s,onClose:l,title:n?"تعديل الخطر":"إضافة خطر جديد",children:e.jsxs("form",{onSubmit:z,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"riskDescription",className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"وصف الخطر"}),e.jsx("textarea",{id:"riskDescription",value:d,onChange:i=>c(i.target.value),required:!0,rows:3,className:"w-full bg-slate-100 dark:bg-slate-700 p-2 rounded-lg"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[N("riskCategory","الفئة",x,i=>m(i.target.value),["Financial","Technical","Schedule","Safety","Contractual"]),N("riskStatus","الحالة",R,i=>w(i.target.value),["Open","In Progress","Closed"])]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[N("riskProbability","الاحتمالية",g,i=>h(i.target.value),["Low","Medium","High"]),N("riskImpact","التأثير",u,i=>j(i.target.value),["Low","Medium","High"])]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"riskMitigation",className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"خطة التخفيف"}),e.jsx("textarea",{id:"riskMitigation",value:k,onChange:i=>f(i.target.value),required:!0,rows:4,className:"w-full bg-slate-100 dark:bg-slate-700 p-2 rounded-lg"})]}),e.jsxs("div",{className:"flex justify-end gap-4 mt-6",children:[e.jsx("button",{type:"button",onClick:l,className:"px-4 py-2 rounded-lg bg-slate-200 dark:bg-slate-600",children:"إلغاء"}),e.jsx("button",{type:"submit",className:"px-4 py-2 rounded-lg bg-sky-600 text-white",children:"حفظ"})]})]})})},ae=K.memo(({risk:s,onDelete:l,onEdit:t})=>{const[n,d]=r.useState(!1),c=m=>{switch(m){case"Low":return"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300";case"Medium":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300";case"High":return"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300";default:return"bg-slate-100 text-slate-800 dark:bg-slate-700 dark:text-slate-300"}},x={Open:"bg-red-500","In Progress":"bg-yellow-500",Closed:"bg-green-500"};return e.jsxs("div",{className:"border-b border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{className:"hidden md:grid grid-cols-12 gap-4 items-center p-4",children:[e.jsx("div",{className:"col-span-4 font-medium text-slate-800 dark:text-slate-200",children:s.description}),e.jsx("div",{className:"col-span-2 text-sm",children:s.category}),e.jsx("div",{className:"col-span-1",children:e.jsx("span",{className:`px-2 py-1 text-xs font-semibold rounded-full ${c(s.probability)}`,children:s.probability})}),e.jsx("div",{className:"col-span-1",children:e.jsx("span",{className:`px-2 py-1 text-xs font-semibold rounded-full ${c(s.impact)}`,children:s.impact})}),e.jsxs("div",{className:"col-span-2 flex items-center gap-2",children:[e.jsx("span",{className:`w-3 h-3 rounded-full ${x[s.status]}`}),e.jsx("span",{children:s.status})]}),e.jsxs("div",{className:"col-span-2 flex justify-end items-center gap-2",children:[e.jsx("button",{onClick:()=>t(s),className:"text-slate-400 hover:text-sky-500",children:e.jsx(F,{size:16})}),e.jsx("button",{onClick:()=>l(s.id),className:"text-slate-400 hover:text-red-500",children:e.jsx(O,{size:16})}),e.jsx("button",{onClick:()=>d(!n),className:"p-1 rounded-full hover:bg-slate-200 dark:hover:bg-slate-700",children:e.jsx(L,{size:20,className:`transform transition-transform duration-200 ${n?"rotate-180":""}`})})]})]}),e.jsxs("div",{className:"md:hidden p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("p",{className:"font-medium text-slate-800 dark:text-slate-200 break-words w-4/5",children:s.description}),e.jsxs("div",{className:"flex items-center gap-1 shrink-0",children:[e.jsx("button",{onClick:()=>t(s),className:"text-slate-400 hover:text-sky-500 p-1",children:e.jsx(F,{size:16})}),e.jsx("button",{onClick:()=>l(s.id),className:"text-slate-400 hover:text-red-500 p-1",children:e.jsx(O,{size:16})})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-x-4 gap-y-2 text-sm text-slate-500 dark:text-slate-400 mb-2",children:[e.jsxs("span",{children:[e.jsx("strong",{children:"الفئة:"})," ",s.category]}),e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("strong",{children:"الحالة:"})," ",e.jsx("span",{className:`w-2.5 h-2.5 rounded-full ${x[s.status]}`}),s.status]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 text-xs",children:[e.jsxs("span",{className:`px-2 py-1 font-semibold rounded-full ${c(s.probability)}`,children:["الاحتمالية: ",s.probability]}),e.jsxs("span",{className:`px-2 py-1 font-semibold rounded-full ${c(s.impact)}`,children:["التأثير: ",s.impact]})]}),e.jsxs("button",{onClick:()=>d(!n),className:"text-sm text-sky-600 mt-3 flex items-center gap-1",children:[n?"إخفاء التفاصيل":"عرض خطة التخفيف",e.jsx(L,{size:16,className:`transform transition-transform duration-200 ${n?"rotate-180":""}`})]})]}),n&&e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-900/50 p-4 mx-0 md:mx-4 mb-4 rounded-md",children:[e.jsx("h4",{className:"font-semibold mb-2 text-slate-800 dark:text-slate-200",children:"خطة التخفيف:"}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-300 whitespace-pre-wrap",children:s.mitigationPlan})]})]})}),me=({project:s,onUpdateRisks:l})=>{const t=s.data.riskRegister||[],[n,d]=r.useState(!1),[c,x]=r.useState(null),[m,g]=r.useState(!1),[h,u]=r.useState([]),[j,k]=r.useState(""),f=a=>{const o=P(M({},a),{id:`risk-${Date.now()}`});l(s.id,[...t,o])},R=a=>{l(s.id,t.map(o=>o.id===a.id?a:o))},w=r.useCallback(a=>{window.confirm("هل أنت متأكد من حذف هذا الخطر؟")&&l(s.id,t.filter(o=>o.id!==a))},[s.id,t,l]),z=()=>_(null,null,function*(){g(!0),k(""),u([]);try{const a=yield G(s);u(a)}catch(a){k(a.message)}finally{g(!1)}}),N=a=>{f(P(M({},a),{status:"Open"})),u(o=>o.filter(y=>y.description!==a.description))},i=()=>{x(null),d(!0)},v=r.useCallback(a=>{x(a),d(!0)},[]),E=()=>{d(!1),x(null)},$=a=>{"id"in a&&a.id?R(a):f(a)},I=()=>{const a=["ID","Description","Category","Probability","Impact","Mitigation_Plan","Status"],o=t.map(b=>[b.id,`"${b.description.replace(/"/g,'""')}"`,b.category,b.probability,b.impact,`"${b.mitigationPlan.replace(/"/g,'""')}"`,b.status].join(",")),y="data:text/csv;charset=utf-8,"+[a.join(","),...o].join(`
`),p=encodeURI(y),S=document.createElement("a");S.setAttribute("href",p),S.setAttribute("download",`risks_${s.name.replace(/\s/g,"_")}.csv`),document.body.appendChild(S),S.click(),document.body.removeChild(S)},C=()=>{const a=t.map(p=>({ID:p.id,"وصف الخطر":p.description,الفئة:p.category,الاحتمالية:p.probability,التأثير:p.impact,"خطة التخفيف":p.mitigationPlan,الحالة:p.status})),o=XLSX.utils.json_to_sheet(a),y=XLSX.utils.book_new();XLSX.utils.book_append_sheet(y,o,"Risk Register"),XLSX.writeFile(y,`risks_${s.name.replace(/\s/g,"_")}.xlsx`)},T=()=>{window.print()};return e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold mb-2 text-slate-900 dark:text-white",children:"إدارة المخاطر (سجل المخاطر)"}),e.jsxs("p",{className:"mb-8 text-slate-600 dark:text-slate-400",children:["متابعة وتخفيف المخاطر المحتملة لمشروع: ",e.jsx("span",{className:"font-semibold",children:s.name})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 p-6 rounded-xl shadow-md",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4 flex-wrap gap-2",children:[e.jsx("h3",{className:"text-xl font-semibold text-slate-900 dark:text-white",children:"قائمة المخاطر"}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap justify-end",children:[e.jsxs("button",{onClick:I,disabled:t.length===0,className:"flex items-center gap-2 bg-slate-500 text-white font-semibold py-2 px-4 rounded-lg hover:bg-slate-600 transition-colors disabled:bg-slate-400",children:[e.jsx(Q,{size:18}),e.jsx("span",{children:"تصدير CSV"})]}),e.jsxs("button",{onClick:C,disabled:t.length===0,className:"flex items-center gap-2 bg-green-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-green-700 disabled:bg-slate-400",children:[e.jsx(U,{size:18}),e.jsx("span",{children:"تصدير Excel"})]}),e.jsxs("button",{onClick:T,className:"flex items-center gap-2 bg-gray-500 text-white font-semibold py-2 px-4 rounded-lg hover:bg-gray-600",children:[e.jsx(W,{size:18}),e.jsx("span",{children:"طباعة / PDF"})]}),e.jsxs("button",{onClick:z,disabled:m,className:"flex items-center gap-2 bg-teal-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-teal-700 transition-colors disabled:bg-slate-400",children:[e.jsx(Y,{size:18}),e.jsx("span",{children:m?"...جارٍ التحليل":"اقتراح مخاطر بالذكاء الاصطناعي"})]}),e.jsxs("button",{onClick:i,className:"flex items-center gap-2 bg-sky-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-sky-700 transition-colors",children:[e.jsx(Z,{size:18}),e.jsx("span",{children:"إضافة خطر جديد"})]})]})]}),j&&e.jsx("div",{className:"text-red-500 my-2",children:j}),m&&e.jsx("div",{className:"text-center p-4",children:"جارٍ تحليل المشروع لاقتراح المخاطر..."}),h.length>0&&e.jsxs("div",{className:"bg-teal-50 dark:bg-teal-900/30 border border-teal-200 dark:border-teal-700 rounded-lg p-4 my-4",children:[e.jsx("h4",{className:"font-semibold text-teal-800 dark:text-teal-200 mb-2",children:"مخاطر مقترحة من الذكاء الاصطناعي:"}),e.jsx("ul",{className:"space-y-2",children:h.map((a,o)=>e.jsxs("li",{className:"flex justify-between items-center bg-white dark:bg-slate-800 p-2 rounded",children:[e.jsx("span",{className:"text-sm",children:a.description}),e.jsx("button",{onClick:()=>N(a),className:"text-sm text-sky-600 hover:underline font-semibold",children:"إضافة للسجل"})]},o))})]}),e.jsxs("div",{className:"border border-slate-200 dark:border-slate-700 rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"hidden md:grid grid-cols-12 gap-4 items-center p-4 bg-slate-50 dark:bg-slate-900/50 font-semibold text-sm text-slate-600 dark:text-slate-400",children:[e.jsx("div",{className:"col-span-4",children:"وصف الخطر"}),e.jsx("div",{className:"col-span-2",children:"الفئة"}),e.jsx("div",{className:"col-span-1",children:"الاحتمالية"}),e.jsx("div",{className:"col-span-1",children:"التأثير"}),e.jsx("div",{className:"col-span-2",children:"الحالة"}),e.jsx("div",{className:"col-span-2"})]}),t.length>0?t.map(a=>e.jsx(ae,{risk:a,onDelete:w,onEdit:v},a.id)):e.jsxs("div",{className:"text-center p-12",children:[e.jsx(ee,{size:48,className:"mx-auto text-slate-400 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-slate-700 dark:text-slate-300",children:"سجل المخاطر فارغ"}),e.jsx("p",{className:"text-slate-500 dark:text-slate-400",children:"قم بإضافة خطر جديد أو استخدم مساعد الذكاء الاصطناعي لاقتراح المخاطر."})]})]})]}),e.jsx(te,{isOpen:n,onClose:E,onSave:$,risk:c})]})};export{me as RiskManager};
