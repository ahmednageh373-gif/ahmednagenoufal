var Fe=Object.defineProperty,Ie=Object.defineProperties;var Me=Object.getOwnPropertyDescriptors;var oe=Object.getOwnPropertySymbols;var Xe=Object.prototype.hasOwnProperty,Ae=Object.prototype.propertyIsEnumerable;var ce=(t,a,s)=>a in t?Fe(t,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[a]=s,q=(t,a)=>{for(var s in a||(a={}))Xe.call(a,s)&&ce(t,s,a[s]);if(oe)for(var s of oe(a))Ae.call(a,s)&&ce(t,s,a[s]);return t},se=(t,a)=>Ie(t,Me(a));var K=(t,a,s)=>new Promise((l,h)=>{var m=p=>{try{u(s.next(p))}catch(b){h(b)}},y=p=>{try{u(s.throw(p))}catch(b){h(b)}},u=p=>p.done?l(p.value):Promise.resolve(p.value).then(m,y);u((s=s.apply(t,a)).next())});import{r as d,j as e}from"./react-vendor-ITqvX6Xp.js";import{G as Ee}from"./GanttChart-DbnVOYHn.js";import{X as le,K as ae,P as xe,V as _e,Y as Le,_ as Pe,Q as Oe,R as ze,U as We,$ as Re,a0 as Be,a1 as Ge,a2 as He,a3 as me}from"./icons-lib-Dd_BpYQ6.js";import{a as $e,b as qe,c as Qe,d as Ve}from"./index-ClqhgGpL.js";import{k as Je}from"./utils-lib-C_gzCXPI.js";import"./vendor-8CkhJSGZ.js";import"./vendor-large-gsDFeA65.js";import"./genai-lib-pAIF5Ws4.js";const Ke=({isOpen:t,onClose:a,onSave:s,task:l,allTasks:h,members:m})=>{const[y,u]=d.useState(""),[p,b]=d.useState(""),[T,F]=d.useState(""),[_,S]=d.useState(0),[j,X]=d.useState([]),[Y,B]=d.useState([]),[Z,L]=d.useState("To Do"),[U,G]=d.useState("Medium"),[P,Q]=d.useState("");d.useEffect(()=>{if(t)if(l)u(l.name),b(l.start),F(l.end),S(l.progress),X(l.dependencies||[]),B(l.assignees||[]),L(l.status||"To Do"),G(l.priority||"Medium"),Q(l.category||"");else{const n=new Date().toISOString().split("T")[0];u(""),b(n),F(n),S(0),X([]),B([]),L("To Do"),G("Medium"),Q("")}},[l,t]);const V=n=>{if(n.preventDefault(),!y.trim()||!p||!T)return;const A={name:y,start:p,end:T,progress:_,dependencies:j,assignees:Y,status:Z,priority:U,category:P};s(l?q(q({},l),A):A),a()};return t?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center",onClick:a,children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-xl p-8 w-full max-w-2xl mx-4",onClick:n=>n.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:l?"تعديل المهمة":"إضافة مهمة جديدة"}),e.jsx("button",{onClick:a,className:"text-slate-500 hover:text-slate-800 dark:hover:text-slate-200",children:e.jsx(le,{size:24})})]}),e.jsxs("form",{onSubmit:V,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"taskName",className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"اسم المهمة"}),e.jsx("input",{id:"taskName",type:"text",value:y,onChange:n=>u(n.target.value),required:!0,className:"w-full bg-slate-100 dark:bg-slate-700 p-2 rounded-lg"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"taskStart",className:"block text-sm font-medium mb-2",children:"تاريخ البدء"}),e.jsx("input",{id:"taskStart",type:"date",value:p,onChange:n=>b(n.target.value),required:!0,className:"w-full bg-slate-100 dark:bg-slate-700 p-2 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"taskEnd",className:"block text-sm font-medium mb-2",children:"تاريخ الانتهاء"}),e.jsx("input",{id:"taskEnd",type:"date",value:T,onChange:n=>F(n.target.value),required:!0,className:"w-full bg-slate-100 dark:bg-slate-700 p-2 rounded-lg"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{htmlFor:"taskProgress",className:"block text-sm font-medium mb-2",children:["التقدم (",_,"%)"]}),e.jsx("input",{id:"taskProgress",type:"range",min:"0",max:"100",value:_,onChange:n=>S(parseInt(n.target.value)),className:"w-full"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"taskDependencies",className:"block text-sm font-medium mb-2",children:"تعتمد على"}),e.jsx("select",{id:"taskDependencies",multiple:!0,value:j.map(String),onChange:n=>X(Array.from(n.target.selectedOptions,A=>Number(A.value))),className:"w-full bg-slate-100 dark:bg-slate-700 p-2 rounded-lg h-32",children:h.filter(n=>n.id!==(l==null?void 0:l.id)).map(n=>e.jsx("option",{value:n.id,children:n.name},n.id))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"taskStatus",className:"block text-sm font-medium mb-2",children:"الحالة"}),e.jsxs("select",{id:"taskStatus",value:Z,onChange:n=>L(n.target.value),className:"w-full bg-slate-100 dark:bg-slate-700 p-2 rounded-lg",children:[e.jsx("option",{value:"To Do",children:"To Do"}),e.jsx("option",{value:"In Progress",children:"In Progress"}),e.jsx("option",{value:"Done",children:"Done"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"taskPriority",className:"block text-sm font-medium mb-2",children:"الأولوية"}),e.jsxs("select",{id:"taskPriority",value:U,onChange:n=>G(n.target.value),className:"w-full bg-slate-100 dark:bg-slate-700 p-2 rounded-lg",children:[e.jsx("option",{value:"Low",children:"Low"}),e.jsx("option",{value:"Medium",children:"Medium"}),e.jsx("option",{value:"High",children:"High"})]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"taskAssignees",className:"block text-sm font-medium mb-2",children:"المسؤولون"}),e.jsx("select",{id:"taskAssignees",multiple:!0,value:Y,onChange:n=>B(Array.from(n.target.selectedOptions,A=>A.value)),className:"w-full bg-slate-100 dark:bg-slate-700 p-2 rounded-lg h-24",children:m.map(n=>e.jsx("option",{value:n.id,children:n.name},n.id))})]}),e.jsxs("div",{className:"flex justify-end gap-4 mt-6",children:[e.jsx("button",{type:"button",onClick:a,className:"px-4 py-2 rounded-lg bg-slate-200 dark:bg-slate-600",children:"إلغاء"}),e.jsx("button",{type:"submit",className:"px-4 py-2 rounded-lg bg-sky-600 text-white",children:"حفظ"})]})]})]})}):null},Ye=({isOpen:t,onClose:a,onAddTasks:s})=>{const[l,h]=d.useState("أعمال الواجهات الخارجية للمبنى الرئيسي"),[m,y]=d.useState(!1),[u,p]=d.useState(""),[b,T]=d.useState([]),F=()=>K(null,null,function*(){if(l.trim()){y(!0),p(""),T([]);try{const j=yield $e(l);T(j)}catch(j){p(j.message)}finally{y(!1)}}}),_=()=>{s(b),a()},S=()=>{h("أعمال الواجهات الخارجية للمبنى الرئيسي"),T([]),p(""),y(!1),a()};return t?e.jsx("div",{className:"modal",style:{display:"block"},onClick:S,children:e.jsxs("div",{className:"modal-content p-8 max-w-3xl dark:bg-gray-800",onClick:j=>j.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:"المحلل الذكي للمهام"}),e.jsx("button",{onClick:S,className:"text-slate-500 hover:text-slate-800 dark:hover:text-slate-200",children:e.jsx(le,{size:24})})]}),e.jsx("p",{className:"mb-4 text-slate-600 dark:text-slate-400",children:"اكتب وصفًا لنشاط أو مرحلة عمل، وسيقوم الذكاء الاصطناعي بتقسيمها إلى مهام فرعية مفصلة مع تقدير للمدد والترتيب المنطقي."}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"taskDescription",className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"وصف النشاط"}),e.jsx("textarea",{id:"taskDescription",value:l,onChange:j=>h(j.target.value),rows:4,placeholder:"مثال: تشطيبات الطابق الأول",className:"w-full bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:F,disabled:m||!l.trim(),className:"px-4 py-2 rounded-lg text-white bg-indigo-600 hover:bg-indigo-700 flex items-center gap-2 disabled:bg-gray-400",children:m?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),e.jsx("span",{children:"...جاري التوليد"})]}):e.jsxs(e.Fragment,{children:[e.jsx(ae,{size:18}),e.jsx("span",{children:"توليد المهام"})]})})}),u&&e.jsx("p",{className:"text-red-500 text-sm mt-4",children:u}),b.length>0&&e.jsxs("div",{className:"mt-6 border-t border-gray-200 dark:border-gray-700 pt-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"المهام المقترحة:"}),e.jsx("div",{className:"max-h-60 overflow-y-auto border border-gray-200 dark:border-gray-700 rounded-lg",children:e.jsxs("table",{className:"w-full text-right text-sm",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-900/50 sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2",children:"المهمة"}),e.jsx("th",{className:"p-2",children:"المدة (أيام)"}),e.jsx("th",{className:"p-2",children:"تعتمد على"})]})}),e.jsx("tbody",{children:b.map((j,X)=>e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700 last:border-b-0",children:[e.jsx("td",{className:"p-2 font-medium",children:j.name}),e.jsx("td",{className:"p-2 text-center",children:j.duration}),e.jsx("td",{className:"p-2",children:j.predecessors.join(", ")||"لا يوجد"})]},X))})]})}),e.jsxs("div",{className:"flex justify-end gap-4 mt-6",children:[e.jsx("button",{type:"button",onClick:S,className:"px-4 py-2 rounded-lg text-slate-700 dark:text-slate-200 bg-gray-200 dark:bg-gray-600 hover:bg-gray-300 dark:hover:bg-gray-500 font-semibold",children:"إلغاء"}),e.jsxs("button",{type:"button",onClick:_,className:"px-4 py-2 rounded-lg text-white bg-green-600 hover:bg-green-700 font-semibold flex items-center gap-2",children:[e.jsx(xe,{size:18}),"إضافة المهام للجدول"]})]})]})]})}):null},Ze=({isOpen:t,onClose:a,onConfirm:s,tasks:l,fileName:h})=>t?e.jsx("div",{className:"modal",style:{display:"block"},onClick:a,children:e.jsxs("div",{className:"modal-content p-8 max-w-4xl dark:bg-gray-800",onClick:m=>m.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:"تأكيد استيراد الجدول الزمني"}),e.jsx("button",{onClick:a,className:"text-slate-500 hover:text-slate-800 dark:hover:text-slate-200",children:e.jsx(le,{size:24})})]}),e.jsxs("p",{className:"mb-4 text-slate-600 dark:text-slate-400",children:["تمت قراءة المهام التالية من الملف ",e.jsx("span",{className:"font-semibold",children:h}),". سيؤدي التأكيد إلى استبدال الجدول الزمني الحالي."]}),l.length>0?e.jsx("div",{className:"max-h-96 overflow-y-auto border border-slate-200 dark:border-slate-700 rounded-lg",children:e.jsxs("table",{className:"w-full text-right text-sm",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-900/50 sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2",children:"المهمة"}),e.jsx("th",{className:"p-2",children:"تاريخ البدء"}),e.jsx("th",{className:"p-2",children:"تاريخ الانتهاء"}),e.jsx("th",{className:"p-2",children:"الاعتماديات"})]})}),e.jsx("tbody",{children:l.map((m,y)=>e.jsxs("tr",{className:"border-b border-slate-200 dark:border-slate-700 last:border-b-0",children:[e.jsx("td",{className:"p-2 font-medium",children:m.name}),e.jsx("td",{className:"p-2",children:m.start}),e.jsx("td",{className:"p-2",children:m.end}),e.jsx("td",{className:"p-2",children:m.dependencies.join(", ")})]},m.id||y))})]})}):e.jsxs("div",{className:"text-center p-12 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg",children:[e.jsx(_e,{size:48,className:"mx-auto text-yellow-500 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-yellow-800 dark:text-yellow-200",children:"لم يتم العثور على مهام"}),e.jsx("p",{className:"text-yellow-700 dark:text-yellow-300",children:"لم يتمكن النظام من قراءة أي مهام. يرجى التأكد من أن الملف يحتوي على الأعمدة الصحيحة (المهمة, تاريخ البدء, تاريخ الانتهاء)."})]}),e.jsxs("div",{className:"flex justify-end gap-4 mt-6",children:[e.jsx("button",{type:"button",onClick:a,className:"px-4 py-2 rounded-lg text-slate-700 dark:text-slate-200 bg-gray-200 dark:bg-gray-600 hover:bg-gray-300 dark:hover:bg-gray-500",children:"إلغاء"}),e.jsxs("button",{type:"button",onClick:()=>s(l),disabled:l.length===0,className:"px-4 py-2 rounded-lg text-white bg-green-600 hover:bg-green-700 flex items-center gap-2 disabled:bg-gray-400",children:[e.jsx(Le,{size:18}),"تأكيد واستبدال"]})]})]})}):null,Ue=({isOpen:t,onClose:a,onAnalyze:s,isLoading:l,result:h})=>{const[m,y]=d.useState("ماذا لو تأخرت أعمال الحفر لمدة 15 يومًا؟");return t?e.jsx("div",{className:"modal",style:{display:"block"},onClick:a,children:e.jsxs("div",{className:"modal-content p-8 max-w-3xl dark:bg-gray-800",onClick:u=>u.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold",children:'تحليل "ماذا لو؟"'}),e.jsx("button",{onClick:a,children:e.jsx(le,{size:24})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"what-if-query",className:"block text-sm font-medium mb-2",children:"سيناريو افتراضي"}),e.jsx("textarea",{id:"what-if-query",value:m,onChange:u=>y(u.target.value),rows:4,placeholder:"مثال: ما هو تأثير زيادة الموارد في بند الهيكل الخرساني بنسبة 30% على تاريخ الانتهاء؟",className:"w-full bg-gray-100 dark:bg-gray-700 p-2 rounded-lg"})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{onClick:()=>s(m),disabled:l||!m.trim(),className:"flex items-center gap-2 bg-teal-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-teal-700 disabled:bg-slate-400",children:[l?e.jsx(Pe,{className:"animate-spin"}):e.jsx(ae,{}),e.jsx("span",{children:l?"جاري التحليل...":"تحليل السيناريو"})]})}),h&&!l&&e.jsxs("div",{className:"mt-6 border-t pt-6",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"نتائج التحليل"}),e.jsx("div",{className:"prose dark:prose-invert max-w-none text-sm bg-gray-50 dark:bg-gray-700/50 p-4 rounded-lg",dangerouslySetInnerHTML:{__html:Je.parse(h.impactSummary)}}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mt-4 text-center",children:[e.jsxs("div",{className:"bg-gray-100 dark:bg-gray-700 p-3 rounded-lg",children:[e.jsx("p",{className:"text-xs font-semibold",children:"تاريخ الانتهاء الجديد"}),e.jsx("p",{className:"font-bold text-lg text-red-500",children:h.newEndDate})]}),e.jsxs("div",{className:"bg-gray-100 dark:bg-gray-700 p-3 rounded-lg",children:[e.jsx("p",{className:"text-xs font-semibold",children:"التأثير على التكلفة"}),e.jsx("p",{className:"text-sm",children:h.costImpact})]}),e.jsxs("div",{className:"bg-gray-100 dark:bg-gray-700 p-3 rounded-lg",children:[e.jsx("p",{className:"text-xs font-semibold",children:"التأثير على المسار الحرج"}),e.jsx("p",{className:"text-sm",children:h.criticalPathImpact})]})]})]})]})}):null},te=({icon:t,label:a,value:s})=>e.jsxs("div",{className:"bg-slate-100 dark:bg-slate-800 p-4 rounded-lg flex items-center gap-4",children:[e.jsx(t,{className:"w-6 h-6 text-indigo-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:a}),e.jsx("p",{className:"text-xl font-bold",children:s})]})]}),cs=({project:t,onUpdateSchedule:a})=>{const s=t.data.schedule||[],l=t.data.members||[],[h,m]=d.useState(!1),[y,u]=d.useState(!1),[p,b]=d.useState(!1),[T,F]=d.useState([]),[_,S]=d.useState(""),[j,X]=d.useState(null),[Y,B]=d.useState(!1),[Z,L]=d.useState(null),[U,G]=d.useState(!1),[P,Q]=d.useState(null),[V,n]=d.useState(!1),A=d.useRef(null),E=d.useMemo(()=>{if(s.length===0)return{totalTasks:0,overallDuration:0,startDate:t.startDate,endDate:t.endDate||t.startDate};const r=s.map(N=>new Date(N.start).getTime()),c=s.map(N=>new Date(N.end).getTime()),o=new Date(Math.min(...r)),g=new Date(Math.max(...c)),v=Math.ceil((g.getTime()-o.getTime())/(1e3*60*60*24))+1;return{totalTasks:s.length,overallDuration:(P==null?void 0:P.projectDuration)||v,startDate:o.toISOString().split("T")[0],endDate:g.toISOString().split("T")[0]}},[s,t.startDate,t.endDate,P]),ge=()=>{X(null),m(!0)},he=d.useCallback(r=>{X(r),m(!0)},[]),ue=r=>{let c;if("id"in r)c=s.map(o=>o.id===r.id?r:o);else{const o=s.length>0?Math.max(...s.map(v=>v.id))+1:1,g=se(q({},r),{id:o});c=[...s,g]}a(t.id,c)},pe=d.useCallback(r=>{if(window.confirm("هل أنت متأكد من حذف هذه المهمة؟")){const c=s.filter(o=>o.id!==r).map(o=>se(q({},o),{dependencies:o.dependencies.filter(g=>g!==r)}));a(t.id,c)}},[t.id,s,a]),be=r=>{let c=[...s],o=c.length>0?Math.max(...c.map(f=>f.id)):0;const g=[],v={};r.forEach(f=>{o++;const C={id:o,name:f.name,progress:0,dependencies:f.predecessors,category:"Generated",status:"To Do",priority:"Medium",assignees:[]};g.push(C),v[f.name]=o});const N=g.map((f,C)=>{const H=r[C],O=H.predecessors.map(x=>v[x]).filter(Boolean);let I=new Date(t.startDate);if(O.length>0){const x=O.map(D=>{const w=c.find(M=>M.id===D)||g.find(M=>M.id===D);return w?new Date(w.end||t.startDate):new Date(t.startDate)});I=new Date(Math.max(...x.map(D=>D.getTime()))),I.setDate(I.getDate()+1)}const z=new Date(I);return z.setDate(z.getDate()+(H.duration-1)),se(q({},f),{dependencies:O,start:I.toISOString().split("T")[0],end:z.toISOString().split("T")[0]})});a(t.id,[...c,...N])},fe=r=>{var g;const c=(g=r.target.files)==null?void 0:g[0];if(!c)return;S(c.name);const o=new FileReader;o.onload=v=>{var N;try{const f=(N=v.target)==null?void 0:N.result,C=XLSX.read(f,{type:"binary"}),H=C.SheetNames[0],O=C.Sheets[H],z=XLSX.utils.sheet_to_json(O).map((x,D)=>{const w=W=>new Date(Date.UTC(0,0,W-1)),M=typeof x["تاريخ البدء"]=="number"?w(x["تاريخ البدء"]).toISOString().split("T")[0]:x["تاريخ البدء"],J=typeof x["تاريخ الانتهاء"]=="number"?w(x["تاريخ الانتهاء"]).toISOString().split("T")[0]:x["تاريخ الانتهاء"];return{id:x.ID||D+1,name:x.المهمة||"مهمة غير مسماة",start:M,end:J,progress:x.التقدم||0,dependencies:x.الاعتماديات?String(x.الاعتماديات).split(",").map(Number).filter(W=>!isNaN(W)):[],category:x.الفئة||"مستورد",status:x.الحالة||"To Do",priority:x.الأولوية||"Medium",assignees:x.المسؤولون?String(x.المسؤولون).split(",").map(W=>W.trim()):[]}});F(z),b(!0)}catch(f){alert(`فشل في قراءة الملف: ${f.message}`)}},o.readAsBinaryString(c),r.target.value=""},je=r=>{var g;const c=(g=r.target.files)==null?void 0:g[0];if(!c)return;S(c.name),b(!0),F([]);const o=new FileReader;o.onload=v=>K(null,null,function*(){var N;try{const f=(N=v.target)==null?void 0:N.result,C=yield qe(f);F(C)}catch(f){alert(`فشل تحليل ملف XER: ${f.message}`),b(!1)}}),o.readAsText(c),r.target.value=""},ye=r=>{a(t.id,r),b(!1)},Ne=()=>{if(s.length===0)return;const r=XLSX.utils.book_new(),c=[["اسم المشروع:",t.name],["الوصف:",t.description],["تاريخ الإنشاء:",new Date().toLocaleDateString("ar-SA")],[],["إجمالي المهام:",E.totalTasks],["المدة الكلية (أيام):",E.overallDuration],["تاريخ البدء:",E.startDate],["تاريخ الانتهاء:",E.endDate]],o=XLSX.utils.aoa_to_sheet(c);o["!cols"]=[{wch:20},{wch:50}],o.A1.s={font:{bold:!0}},o.A2.s={font:{bold:!0}},XLSX.utils.book_append_sheet(r,o,"Cover Page");const g=s.map(i=>({WBS:i.wbsCode||"-",ID:i.id,"Activity Name":i.name,Duration:Math.ceil((new Date(i.end).getTime()-new Date(i.start).getTime())/(1e3*60*60*24))+1,"Start Date":i.start,"End Date":i.end,Predecessors:i.dependencies.join(", "),Resources:(i.resourcesNeeded||[]).join(", ")})),v=XLSX.utils.json_to_sheet(g);XLSX.utils.book_append_sheet(r,v,"Schedule Data");const N={font:{bold:!0,color:{rgb:"FFFFFFFF"}},fill:{fgColor:{rgb:"FF1F4E78"}}},f={font:{bold:!0}},C={fill:{fgColor:{rgb:"FFF1F5F9"}}},H={fill:{fgColor:{rgb:"FF3B82F6"}}},O={fill:{fgColor:{rgb:"FF60A5FA"}}},I=s.flatMap(i=>[new Date(i.start),new Date(i.end)]),z=new Date(Math.min(...I.map(i=>i.getTime()))),x=new Date(Math.max(...I.map(i=>i.getTime())));let D=new Date(z);const w=[];for(;D<=x;)w.push(new Date(D)),D.setDate(D.getDate()+1);const M=[],J=["المهمة","تاريخ البدء","تاريخ الانتهاء"],W=w.map(i=>i.toLocaleDateString("ar-SA",{day:"2-digit",month:"short"}));M.push([...J,...W]),s.forEach(i=>{const $=[i.name,i.start,i.end];M.push([...$,...w.map(()=>"")])});const k=XLSX.utils.aoa_to_sheet(M);Object.keys(N).length>0&&XLSX.utils.sheet_add_aoa(k,[[]],{origin:-1});for(let i=0;i<J.length+w.length;++i){const $=XLSX.utils.encode_cell({r:0,c:i});k[$]&&(k[$].s=N)}s.forEach((i,$)=>{const re=$+1;k[`A${re}`].s=f;const ne=new Date(i.start),ie=new Date(i.end);w.forEach((ee,De)=>{const Se=J.length+De,R=XLSX.utils.encode_cell({r:re,c:Se}),de=ee.getDay();if((de===4||de===5)&&(k[R]=k[R]||{},k[R].s=C),ee>=ne&&ee<=ie){k[R]=k[R]||{};const Ce=i.progress/100,Te=(ie.getTime()-ne.getTime())/(1e3*60*60*24)+1;(ee.getTime()-ne.getTime())/(1e3*60*60*24)<Te*Ce?k[R].s=O:k[R].s=H}})}),k["!cols"]=[{wch:40},{wch:12},{wch:12},...w.map(()=>({wch:10}))],XLSX.utils.book_append_sheet(r,k,"Visual Gantt Chart"),XLSX.writeFile(r,`professional_schedule_${t.name.replace(/\s/g,"_")}.xlsx`)},ke=()=>{window.print()},ve=r=>K(null,null,function*(){if(s.length===0){alert("لا يمكن إجراء التحليل على جدول زمني فارغ.");return}G(!0),L(null);try{const c=yield Ve(s,r);L(c)}catch(c){alert(`فشل تحليل "ماذا لو؟": ${c.message}`)}finally{G(!1)}}),we=()=>K(null,null,function*(){if(s.length===0){alert("لا يمكن تحليل المسار الحرج لجدول فارغ.");return}n(!0);try{const r=yield Qe(s);Q(r),alert(`تم تحليل المسار الحرج بنجاح. المدة الجديدة للمشروع هي ${r.projectDuration} يوم. تم تلوين المهام الحرجة باللون الأحمر.`)}catch(r){alert(`فشل تحليل المسار الحرج: ${r.message}`),Q(null)}finally{n(!1)}});return e.jsxs("div",{children:[e.jsxs("header",{className:"flex justify-between items-center mb-8 flex-wrap gap-4 no-print",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"إدارة الجدول الزمني"}),e.jsxs("p",{className:"text-gray-500 dark:text-gray-400 mt-1",children:["تخطيط وتتبع المهام لمشروع: ",e.jsx("span",{className:"font-semibold",children:t.name})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap justify-end",children:[e.jsxs("button",{onClick:Ne,className:"flex items-center gap-2 bg-green-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-green-700",children:[e.jsx(Oe,{size:18}),e.jsx("span",{children:"تصدير Excel احترافي"})]}),e.jsxs("button",{onClick:ke,className:"flex items-center gap-2 bg-gray-500 text-white font-semibold py-2 px-4 rounded-lg hover:bg-gray-600",children:[e.jsx(ze,{size:18}),e.jsx("span",{children:"طباعة / PDF"})]}),e.jsxs("label",{className:"flex items-center gap-2 bg-gray-700 text-white font-semibold py-2 px-4 rounded-lg hover:bg-gray-800 cursor-pointer",children:[e.jsx(We,{size:18}),e.jsx("span",{children:"استيراد Excel"}),e.jsx("input",{type:"file",onChange:fe,accept:".xlsx, .xls",className:"hidden"})]}),e.jsxs("label",{className:"flex items-center gap-2 bg-orange-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-orange-700 cursor-pointer",children:[e.jsx(Re,{size:18}),e.jsx("span",{children:"استيراد Primavera (.xer)"}),e.jsx("input",{type:"file",ref:A,onChange:je,accept:".xer",className:"hidden"})]}),e.jsxs("button",{onClick:we,disabled:V,className:"flex items-center gap-2 bg-red-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-red-700 disabled:bg-slate-400",children:[V?e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}):e.jsx(Be,{size:18}),e.jsx("span",{children:V?"...جارٍ التحليل":"تحليل المسار الحرج"})]}),e.jsxs("button",{onClick:()=>B(!0),className:"flex items-center gap-2 bg-purple-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-purple-700",children:[e.jsx(ae,{size:18}),e.jsx("span",{children:'تحليل "ماذا لو؟" (AI)'})]}),e.jsxs("button",{onClick:()=>u(!0),className:"flex items-center gap-2 bg-teal-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-teal-700",children:[e.jsx(ae,{size:18}),e.jsx("span",{children:"إنشاء مهام فرعية (AI)"})]}),e.jsxs("button",{onClick:ge,className:"flex items-center gap-2 bg-sky-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-sky-700",children:[e.jsx(xe,{size:18}),e.jsx("span",{children:"إضافة مهمة"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8 no-print",children:[e.jsx(te,{icon:Ge,label:"إجمالي المهام",value:E.totalTasks}),e.jsx(te,{icon:He,label:"المدة الكلية (أيام)",value:E.overallDuration}),e.jsx(te,{icon:me,label:"تاريخ البدء",value:E.startDate}),e.jsx(te,{icon:me,label:"تاريخ الانتهاء",value:E.endDate})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsx("div",{className:"min-w-[1000px] printable-gantt",children:e.jsx(Ee,{tasks:s,members:l,projectStartDate:t.startDate,onEditTask:he,onDeleteTask:pe,cpmResult:P})})}),e.jsx(Ke,{isOpen:h,onClose:()=>m(!1),onSave:ue,task:j,allTasks:s,members:l}),e.jsx(Ye,{isOpen:y,onClose:()=>u(!1),onAddTasks:be}),e.jsx(Ze,{isOpen:p,onClose:()=>b(!1),onConfirm:ye,tasks:T,fileName:_}),e.jsx(Ue,{isOpen:Y,onClose:()=>{B(!1),L(null)},onAnalyze:ve,isLoading:U,result:Z})]})};export{cs as ScheduleManager};
