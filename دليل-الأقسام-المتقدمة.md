# ๐ ุฏููู ุงูุฃูุณุงู ุงููุชูุฏูุฉ - NOUFAL ERP Advanced Modules Guide

## ๐ฏ ูุธุฑุฉ ุนุงูุฉ

ุชู ุฅุถุงูุฉ 4 ุฃูุณุงู ุฑุฆูุณูุฉ ุฌุฏูุฏุฉ ููุธุงู NOUFAL ERP ูุชุบุทูุฉ ุฌููุน ุฌูุงูุจ ุฅุฏุงุฑุฉ ุงููุดุงุฑูุน ุงูุฅูุดุงุฆูุฉ:

1. **ูุธุงู ุงูุตูุงุญูุงุช ุงููุชุฏุฑุฌ** - 9 ุฃุฏูุงุฑ ูุฎุชููุฉ ูุน ุตูุงุญูุงุช ูุญุฏุฏุฉ
2. **ูุณู ุงููุดุชุฑูุงุช** - ุฅุฏุงุฑุฉ ุดุงููุฉ ูููุดุชุฑูุงุช ูุงูุชูุฑูุฏุงุช
3. **ุฅุฏุงุฑุฉ ููุงููู ุงูุจุงุทู** - ูุชุงุจุนุฉ ุนููุฏ ูุฃุฏุงุก ููุงููู ุงูุจุงุทู
4. **ูุณู ุงููุฎุทุทุงุช ูุงููุณุชูุฏุงุช** - ุฅุฏุงุฑุฉ ุงููุฎุทุทุงุช ูุงููุซุงุฆู ุงููููุฉ

---

## 1๏ธโฃ ูุธุงู ุงูุตูุงุญูุงุช ุงููุชุฏุฑุฌ (Multi-Role Permission System)

### ๐ ุงููุตู

ูุธุงู ุตูุงุญูุงุช ูุชูุฏู ูุฏุนู 9 ุฃุฏูุงุฑ ูุฎุชููุฉ ูู ุงููุดุฑูุน ูุน ุตูุงุญูุงุช ูุญุฏุฏุฉ ููู ุฏูุฑ.

### โ๏ธ ุงูููู: `backend/permissions.py` (23,620 ุญุฑู)

### ๐ญ ุงูุฃุฏูุงุฑ ุงููุชุงุญุฉ

#### 1. ุตุงุญุจ ุงูุดุฑูุฉ (Company Owner)
**ุงูุตูุงุญูุงุช:** ุฌููุน ุงูุตูุงุญูุงุช - ุชุญูู ูุงูู ูู ุงููุธุงู

**ุงูููุฒุงุช:**
- โ ุนุฑุถ ููุญุฉ ุชุญูู ุชูููุฐูุฉ ุดุงููุฉ
- โ ูุชุงุจุนุฉ ุฌููุน ุงููุดุงุฑูุน
- โ ุงูููุงููุฉ ุนูู ุงููุดุงุฑูุน ูุงููุณุชุฎูุตุงุช
- โ ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู ูุงูุตูุงุญูุงุช
- โ ุนุฑุถ ุงูุชุญูููุงุช ุงููุงููุฉ ูุงูุฒูููุฉ
- โ ุชุตุฏูุฑ ุงูุจูุงูุงุช ุฅูู Excel/Power BI

**ุงูุงุณุชุฎุฏุงู:**
```python
from backend.permissions import Role, User, PermissionManager

owner = User(
    id=1,
    username="ahmed_owner",
    email="owner@noufal.com",
    role=Role.COMPANY_OWNER
)

pm = PermissionManager()
permissions = pm.get_user_permissions(owner)
# Returns: ุฌููุน ุงูุตูุงุญูุงุช (60+ permission)
```

---

#### 2. ูุฏูุฑ ุงููุดุฑูุน (Project Manager)
**ุงูุชุฑููุฒ:** ุฅุฏุงุฑุฉ ุดุงููุฉ ูููุดุฑูุน

**ุงูุตูุงุญูุงุช ุงูุฑุฆูุณูุฉ:**
- โ ููุญุฉ ุชุญูู ุดุงููุฉ (ุงูุชูุฏูุ ุงูุชูููุฉุ ุงูููุช)
- โ ุฅุฏุงุฑุฉ BOQ ูุงูุฌุฏุงูู ุงูุฒูููุฉ
- โ ุงูููุงููุฉ ุนูู ุทูุจุงุช ุงูุดุฑุงุก ูุงููุณุชุฎูุตุงุช
- โ ูุชุงุจุนุฉ ุงููุฎุงุทุฑ ูุงูููุงุญุธุงุช
- โ ุฅูุดุงุก ุงูุชูุงุฑูุฑ ุงูุฏูุฑูุฉ
- โ ูุชุงุจุนุฉ ูุคุดุฑุงุช ุงูุฃุฏุงุก (KPIs)

**ุนุฏุฏ ุงูุตูุงุญูุงุช:** 35 ุตูุงุญูุฉ

---

#### 3. ูููุฏุณ ุงููููุน (Site Engineer)
**ุงูุชุฑููุฒ:** ุงูุนูููุงุช ุงูููุฏุงููุฉ

**ุงูุตูุงุญูุงุช ุงูุฑุฆูุณูุฉ:**
- โ **ุงุณุชุฎุฏุงู ุงูุชุทุจูู ุงูููุฏุงูู**
- โ ุชุณุฌูู ุงูุฃูุดุทุฉ ุงูููููุฉ (Daily Reports)
- โ ุฑูุน ุงูุตูุฑ ูุฑุจุทูุง ุจุงูุฃูุดุทุฉ
- โ ุชุชุจุน ุงูุนูุงูุฉ ุนุจุฑ ุฑููุฒ QR
- โ ุชุณุฌูู ุงููุนุฏุงุช ูุงูููุงุฏ
- โ ุฅูุดุงุก ุทูุจุงุช RFI
- โ ุชุญุฏูุซ ุฑุณููุงุช As-Built

**ุนุฏุฏ ุงูุตูุงุญูุงุช:** 16 ุตูุงุญูุฉ

---

#### 4. ูููุฏุณ ุงูุชูููุฐ (Execution Engineer)
**ุงูุชุฑููุฒ:** ุชูููุฐ ุงูุฃุนูุงู ูููุงุฑูุฉ ุงููุฎุทุทุงุช

**ุงูุตูุงุญูุงุช ุงูุฑุฆูุณูุฉ:**
- โ ููุงุฑูุฉ ุงููุฎุทุทุงุช ุงููุนุชูุฏุฉ ุจุงูุฃุนูุงู ุงููููุฐุฉ
- โ ูุธุงู RFI ุฅููุชุฑููู (ุฅูุดุงุก ูุฑุฏู)
- โ ุชุชุจุน ููุฑู ููุชูุฏู ููู ูุดุงุท
- โ ุชุญุฏูุซ ุงููููุงุช ุงููููุฐุฉ
- โ ุงุณุชุฎุฏุงู ุงูุชุทุจูู ุงูููุฏุงูู

**ุนุฏุฏ ุงูุตูุงุญูุงุช:** 15 ุตูุงุญูุฉ

---

#### 5. ุงููุดุฑู (Supervisor)
**ุงูุชุฑููุฒ:** ุงูุฅุดุฑุงู ุนูู ุงูุนูุงูุฉ ูุงูุฃูุดุทุฉ

**ุงูุตูุงุญูุงุช ุงูุฑุฆูุณูุฉ:**
- โ ูุชุงุจุนุฉ ุงูุนูุงูุฉ ูุงููุนุฏุงุช
- โ ูุณุญ ุฑููุฒ QR ููุญุถูุฑ
- โ ุฑูุน ุชูุงุฑูุฑ ููููุฉ
- โ ุงูุชูุงุท ุตูุฑ ุงูุนูู ุงููููุฐ
- โ ุนุฑุถ ุงููุฎุทุทุงุช

**ุนุฏุฏ ุงูุตูุงุญูุงุช:** 11 ุตูุงุญูุฉ

---

#### 6. ูููุฏุณ ุงูุชุฎุทูุท (Planning Engineer)
**ุงูุชุฑููุฒ:** ุงูุฌุฏุงูู ุงูุฒูููุฉ ูุงูุชุฎุทูุท

**ุงูุตูุงุญูุงุช ุงูุฑุฆูุณูุฉ:**
- โ **ุฅุฏุงุฑุฉ ูุงููุฉ ููุฌุฏุงูู ุงูุฒูููุฉ**
- โ ุฑุจุท ูุน Primavera / MS Project
- โ ุชุญุฏูุซ ุชููุงุฆู ููุจุฑูุงูุฌ ุงูุฒููู
- โ ุนุฑุถ ุงููุณุงุฑ ุงูุญุฑุฌ
- โ ุชุญููู ุงูุชุฃุฎูุฑุงุช (What-if Simulation)
- โ ุชุญูููุงุช ุฒูููุฉ ูุชูุฏูุฉ

**ุนุฏุฏ ุงูุตูุงุญูุงุช:** 17 ุตูุงุญูุฉ

---

#### 7. ูููุฏุณ ุงูููุชุฑูู ููุณุช (Cost Control Engineer)
**ุงูุชุฑููุฒ:** ูุฑุงูุจุฉ ุงูุชูุงููู ูุงูููุฒุงููุงุช

**ุงูุตูุงุญูุงุช ุงูุฑุฆูุณูุฉ:**
- โ **ุฅุฏุงุฑุฉ ูุงููุฉ ููุชูุงููู**
- โ ูููู ุงูุชูููุฉ (CBS) ูุฑุชุจุท ุจู WBS
- โ ููุงุฑูุฉ ุงูููุฒุงููุฉ ุจุงููุตุฑููุงุช ุงููุนููุฉ
- โ ุชุชุจุน ุงูููุงุฑุฏ ูุงูุชูุจูู ุนูุฏ ุงูุชุฌุงูุฒุงุช
- โ ุชุญูููุงุช ูุงููุฉ ูุชูุฏูุฉ
- โ ุนุฑุถ ุงูุชุฏูู ุงูููุฏู

**ุนุฏุฏ ุงูุตูุงุญูุงุช:** 16 ุตูุงุญูุฉ

---

#### 8. ุงูููุชุจ ุงูููู (Technical Office)
**ุงูุชุฑููุฒ:** ุฅุฏุงุฑุฉ ุงููุฎุทุทุงุช ูุงูู RFI

**ุงูุตูุงุญูุงุช ุงูุฑุฆูุณูุฉ:**
- โ **ุฅุฏุงุฑุฉ ูุงููุฉ ูููุฎุทุทุงุช**
- โ ุฑูุน ูุงุนุชูุงุฏ ุงููุฎุทุทุงุช
- โ ุฅุฏุงุฑุฉ ุงููุณุฎ ูุงูุฅุตุฏุงุฑุงุช
- โ ููุงุฑูุฉ ุชููุงุฆูุฉ ุจูู ุงููุฎุทุทุงุช
- โ ุงูุฑุฏ ุนูู ุทูุจุงุช RFI
- โ ุชุญุฏูุซ As-Built

**ุนุฏุฏ ุงูุตูุงุญูุงุช:** 13 ุตูุงุญูุฉ

---

#### 9. ุงูุญุณุงุจุงุช ูุงููุงููุฉ (Accounts & Finance)
**ุงูุชุฑููุฒ:** ุงูุนูููุงุช ุงููุงููุฉ

**ุงูุตูุงุญูุงุช ุงูุฑุฆูุณูุฉ:**
- โ **ุฅุฏุงุฑุฉ ูุงููุฉ ููุนูููุงุช ุงููุงููุฉ**
- โ ุฅูุดุงุก ุงููุณุชุฎูุตุงุช ุงูุดูุฑูุฉ ุชููุงุฆูุงู
- โ ุฑุจุท ุงููููุงุช ุงููููุฐุฉ ุจุงูุนููุฏ
- โ ุฅุฏุงุฑุฉ ุงูุฏูุนุงุช ูุงูููุงุชูุฑ
- โ ุนุฑุถ ุงูุชุฏูู ุงูููุฏู
- โ ุชุญูููุงุช ูุงููุฉ

**ุนุฏุฏ ุงูุตูุงุญูุงุช:** 14 ุตูุงุญูุฉ

---

### ๐ ุงุณุชุฎุฏุงู ูุธุงู ุงูุตูุงุญูุงุช

#### ุชุญูู ูู ุตูุงุญูุฉ ูุนููุฉ:
```python
from backend.permissions import Permission, PermissionManager

pm = PermissionManager()

# ุชุญูู ูู ุตูุงุญูุฉ ูุงุญุฏุฉ
has_perm = pm.has_permission(user, Permission.CREATE_PROJECT)

# ุชุญูู ูู ุฃู ุตูุงุญูุฉ ูู ุนุฏุฉ ุตูุงุญูุงุช
has_any = pm.has_any_permission(user, [
    Permission.VIEW_BOQ,
    Permission.EDIT_BOQ
])

# ุชุญูู ูู ุฌููุน ุงูุตูุงุญูุงุช
has_all = pm.has_all_permissions(user, [
    Permission.VIEW_COSTS,
    Permission.MANAGE_BUDGET
])
```

#### ุงุณุชุฎุฏุงู Decorator:
```python
from backend.permissions import require_permission, Permission

@require_permission(Permission.CREATE_PROJECT)
def create_new_project(user, project_data):
    """ูุฐู ุงูุฏุงูุฉ ุชุชุทูุจ ุตูุงุญูุฉ ุฅูุดุงุก ูุดุฑูุน"""
    # ุฅูุดุงุก ุงููุดุฑูุน
    return {"success": True}
```

#### ุฅุถุงูุฉ ุตูุงุญูุงุช ูุฎุตุตุฉ:
```python
# ุฅุถุงูุฉ ุตูุงุญูุฉ ุฅุถุงููุฉ ููุณุชุฎุฏู ูุญุฏุฏ
pm.add_custom_permission(user, Permission.DELETE_PROJECT)

# ุฅุฒุงูุฉ ุตูุงุญูุฉ ูุฎุตุตุฉ
pm.remove_custom_permission(user, Permission.DELETE_PROJECT)

# ุชุบููุฑ ุฏูุฑ ุงููุณุชุฎุฏู
pm.change_user_role(user, Role.PROJECT_MANAGER)
```

---

## 2๏ธโฃ ูุณู ุงููุดุชุฑูุงุช (Procurement Module)

### ๐ ุงููุตู

ูุธุงู ุดุงูู ูุฅุฏุงุฑุฉ ุงููุดุชุฑูุงุช ูู ุทูุจ ุงูุดุฑุงุก ุญุชู ุงุณุชูุงู ุงูููุงุฏ ูู ุงููููุน.

### โ๏ธ ุงูููู: `backend/procurement.py` (23,820 ุญุฑู)

### ๐ ุฏูุฑุฉ ุงููุดุชุฑูุงุช ุงููุงููุฉ

```
ุทูุจ ุงูุดุฑุงุก (PR) โ ุงูููุงููุฉ โ ุฃูุฑ ุงูุดุฑุงุก (PO) โ ุฅุฑุณุงู ููููุฑุฏ โ 
ุงูุชุฃููุฏ โ ุงูุชูุฑูุฏ โ ุงูุงุณุชูุงู โ ุชุญุฏูุซ ุงูุญุณุงุจุงุช
```

### ๐ ุงูููููุงุช ุงูุฑุฆูุณูุฉ

#### 1. ุทูุจ ุงูุดุฑุงุก (Purchase Request - PR)

**ุงูุญุงูุงุช:**
- `DRAFT` - ูุณูุฏุฉ
- `SUBMITTED` - ุชู ุงูุชูุฏูู
- `APPROVED` - ูุนุชูุฏ
- `REJECTED` - ูุฑููุถ
- `CONVERTED_TO_PO` - ุชู ุชุญูููู ูุฃูุฑ ุดุฑุงุก

**ุฅูุดุงุก ุทูุจ ุดุฑุงุก:**
```python
from backend.procurement import ProcurementManager, PurchaseRequestItem
from datetime import datetime, timedelta

pm = ProcurementManager()

# ุชุญุฏูุฏ ุงูุฃุตูุงู ุงููุทููุจุฉ
items = [
    PurchaseRequestItem(
        material_id=1,
        material_name="Steel Bars 16mm",
        quantity=10.5,
        unit="Ton",
        required_date=datetime.now() + timedelta(days=15),
        project_id=1,
        boq_item_id=100,  # ุฑุจุท ูุน BOQ
        estimated_price=2500.0,
        specification="Grade 60, ASTM A615"
    ),
    PurchaseRequestItem(
        material_id=2,
        material_name="Portland Cement",
        quantity=200,
        unit="Bag",
        required_date=datetime.now() + timedelta(days=10),
        project_id=1,
        estimated_price=25.0
    )
]

# ุฅูุดุงุก ุทูุจ ุงูุดุฑุงุก
pr = pm.create_purchase_request(
    project_id=1,
    requested_by_id=101,  # ูููุฏุณ ุงููููุน
    items=items,
    required_date=datetime.now() + timedelta(days=15),
    justification="Required for foundation work - Phase 1"
)

print(f"โ Created PR: {pr.pr_number}")
print(f"   Total Estimated Cost: {pr.total_estimated_cost:,.2f} SAR")
```

**ุงูููุงููุฉ ุนูู ุทูุจ ุงูุดุฑุงุก:**
```python
# ุงูููุงููุฉ (ูู ูุฏูุฑ ุงููุดุฑูุน)
success = pm.approve_purchase_request(
    pr_id=pr.id,
    approved_by_id=201  # ูุฏูุฑ ุงููุดุฑูุน
)

if success:
    print("โ Purchase Request Approved")
```

---

#### 2. ุฃูุฑ ุงูุดุฑุงุก (Purchase Order - PO)

**ุงูุญุงูุงุช:**
- `DRAFT` - ูุณูุฏุฉ
- `SENT_TO_SUPPLIER` - ุชู ุงูุฅุฑุณุงู ููููุฑุฏ
- `CONFIRMED` - ูุคูุฏ ูู ุงูููุฑุฏ
- `PARTIAL_DELIVERY` - ุชู ุงูุชูุฑูุฏ ุงูุฌุฒุฆู
- `FULLY_DELIVERED` - ุชู ุงูุชูุฑูุฏ ุงููุงูู
- `CANCELLED` - ููุบู

**ุฅูุดุงุก ุฃูุฑ ุดุฑุงุก:**
```python
from backend.procurement import PurchaseOrderItem

# ุชุญุฏูุฏ ุจููุฏ ุฃูุฑ ุงูุดุฑุงุก
po_items = [
    PurchaseOrderItem(
        material_id=1,
        material_name="Steel Bars 16mm",
        quantity=10.5,
        unit="Ton",
        unit_price=2600.0,
        total_price=27300.0,
        specification="Grade 60, ASTM A615",
        delivery_date=datetime.now() + timedelta(days=20)
    )
]

# ุฅูุดุงุก ุฃูุฑ ุงูุดุฑุงุก
po = pm.create_purchase_order(
    pr_id=pr.id,  # ุฑุจุท ูุน ุทูุจ ุงูุดุฑุงุก
    project_id=1,
    supplier_id=5,
    items=po_items,
    delivery_date=datetime.now() + timedelta(days=20),
    payment_terms="Net 30"
)

print(f"โ Created PO: {po.po_number}")
print(f"   Subtotal: {po.subtotal:,.2f} SAR")
print(f"   VAT (15%): {po.tax_amount:,.2f} SAR")
print(f"   Total: {po.total_amount:,.2f} SAR")
```

**ุฅุฑุณุงู ุฃูุฑ ุงูุดุฑุงุก:**
```python
# ุฅุฑุณุงู ููููุฑุฏ
pm.send_purchase_order(po.id)

# ุชุฃููุฏ ูู ุงูููุฑุฏ
pm.confirm_purchase_order(po.id)
```

---

#### 3. ุงุณุชูุงู ุงูููุงุฏ (Delivery)

**ุชุณุฌูู ุงุณุชูุงู:**
```python
# ุชุณุฌูู ุงุณุชูุงู ุฌุฒุฆู
delivered_items = [
    {
        "material_id": 1,
        "material_name": "Steel Bars 16mm",
        "quantity": 5.0,  # ุงุณุชูุงู ูุตู ุงููููุฉ
        "unit": "Ton"
    }
]

delivery_note = pm.record_delivery(
    po_id=po.id,
    delivered_items=delivered_items,
    received_by_id=102,  # ูููุฏุณ ุงููููุน
    delivery_date=datetime.now(),
    vehicle_number="ABC-1234",
    notes="First batch delivered, second batch next week"
)

print(f"โ Recorded Delivery: {delivery_note.dn_number}")
print(f"   Status: {delivery_note.is_complete}")
```

---

#### 4. ุฅุฏุงุฑุฉ ุงูููุฑุฏูู (Supplier Management)

**ุฅุถุงูุฉ ููุฑุฏ:**
```python
from backend.procurement import Supplier

supplier = Supplier(
    id=5,
    code="SUP-005",
    name_ar="ุดุฑูุฉ ุงููููุงุฐ ุงููุชุญุฏ",
    name_en="United Steel Company",
    category="Steel",
    contact_person="Ahmed Ali",
    phone="+966501234567",
    email="info@unitedsteel.com",
    address="Industrial Area, Riyadh",
    tax_number="300123456789003",
    payment_terms="Net 30",
    credit_limit=1000000.0,
    rating=4.5
)

pm.add_supplier(supplier)
```

**ุชุญุฏูุซ ุชูููู ุงูููุฑุฏ:**
```python
# ุชุญุฏูุซ ุงูุชูููู ุจูุงุกู ุนูู ุงูุฃุฏุงุก
pm.update_supplier_rating(supplier_id=5, rating=4.7)

# ุชุญุฏูุซ ุงูุฑุตูุฏ ุงููุงูู
pm.update_supplier_balance(
    supplier_id=5,
    amount=27300.0,
    operation="add"  # ุฒูุงุฏุฉ ุงูุฑุตูุฏ ุงููุณุชุญู
)
```

---

### ๐ ุงูุชูุงุฑูุฑ ูุงูุชุญูููุงุช

#### 1. ุชูุฑูุฑ ุญุงูุฉ ุงูููุงุฏ
```python
# ุงูุญุตูู ุนูู ุชูุฑูุฑ ุญุงูุฉ ุงูููุงุฏ ููุดุฑูุน ูุญุฏุฏ
report = pm.get_material_status_report(project_id=1)

print("๐ Material Status Report")
print(f"   Requested: {report['summary']['requested']}")
print(f"   Ordered: {report['summary']['ordered']}")
print(f"   In Transit: {report['summary']['in_transit']}")
print(f"   Delivered: {report['summary']['delivered']}")
```

#### 2. ุชูุฑูุฑ ุฃุฏุงุก ุงูููุฑุฏูู
```python
# ุชูุฑูุฑ ุดุงูู ูุฃุฏุงุก ุฌููุน ุงูููุฑุฏูู
suppliers_report = pm.get_supplier_performance_report()

for supplier in suppliers_report:
    print(f"\n๐ฆ {supplier['supplier_name']}")
    print(f"   Rating: {supplier['rating']} / 5.0")
    print(f"   Total Orders: {supplier['total_orders']}")
    print(f"   On-time Delivery: {supplier['on_time_delivery_rate']}%")
    print(f"   Current Balance: {supplier['current_balance']:,.2f} SAR")
```

#### 3. ุงูุชูุฑูุฏุงุช ุงููุนููุฉ
```python
# ุนุฑุถ ุฌููุน ุงูุชูุฑูุฏุงุช ุงููุนููุฉ
pending = pm.get_pending_deliveries(project_id=1)

print("\nโณ Pending Deliveries")
for item in pending:
    print(f"\n   PO: {item['po_number']}")
    print(f"   Material: {item['material']}")
    print(f"   Remaining: {item['remaining_quantity']} {item['unit']}")
    print(f"   Expected: {item['days_until_delivery']} days")
```

---

### ๐ ุงูุชูุงูู ูุน ุงูุฃูุณุงู ุงูุฃุฎุฑู

#### ุฑุจุท ูุน BOQ:
```python
# ุนูุฏ ุฅูุดุงุก ุทูุจ ุดุฑุงุกุ ูุชู ุฑุจุทู ุจู BOQ
pr_item = PurchaseRequestItem(
    material_id=1,
    material_name="Concrete C30",
    quantity=150,
    unit="mยณ",
    boq_item_id=205,  # ๐ ุฑุจุท ูุจุงุดุฑ ูุน BOQ
    required_date=datetime.now() + timedelta(days=10),
    project_id=1
)
```

#### ุฑุจุท ูุน ุงูุญุณุงุจุงุช:
```python
# ุนูุฏ ุงุณุชูุงู ุงูููุงุฏุ ูุชู ุชุญุฏูุซ ุฑุตูุฏ ุงูููุฑุฏ ุชููุงุฆูุงู
# ูุฅูุดุงุก ููุฏ ูุญุงุณุจู

delivery = pm.record_delivery(...)
# โฌ๏ธ ุชุญุฏูุซ ุชููุงุฆู
# - ุฒูุงุฏุฉ ุฑุตูุฏ ุงูููุฑุฏ
# - ุชุญุฏูุซ ูููุฉ ุงููุฎุฒูู
# - ุฅูุดุงุก ุณูุฏ ุงุณุชูุงู
```

---

### ๐ ุงูุฅุดุนุงุฑุงุช ุงูุชููุงุฆูุฉ

ูุฑุณู ุงููุธุงู ุฅุดุนุงุฑุงุช ูู ุงูุญุงูุงุช ุงูุชุงููุฉ:
- โ ุฅูุดุงุก ุทูุจ ุดุฑุงุก ุฌุฏูุฏ โ ูููุฏูุฑ ุงููุจุงุดุฑ
- โ ุงูููุงููุฉ ุนูู ุทูุจ ุงูุดุฑุงุก โ ูุทุงูุจ ุงูุดุฑุงุก
- โ ุฅูุดุงุก ุฃูุฑ ุดุฑุงุก โ ููููุฑุฏ ููุณู ุงูุญุณุงุจุงุช
- โ ุชุฃููุฏ ุฃูุฑ ุงูุดุฑุงุก โ ูุทุงูุจ ุงูุดุฑุงุก ููููุฏุณ ุงููููุน
- โ ูุฑุจ ููุนุฏ ุงูุชูุฑูุฏ (3 ุฃูุงู) โ ููููุฏุณ ุงููููุน
- โ ุชุฃุฎุฑ ุงูุชูุฑูุฏ โ ููุฏูุฑ ุงููุดุฑูุน
- โ ุงุณุชูุงู ุงูููุงุฏ โ ูุทุงูุจ ุงูุดุฑุงุก ููุณู ุงูุญุณุงุจุงุช

---

## 3๏ธโฃ ุฅุฏุงุฑุฉ ููุงููู ุงูุจุงุทู (Subcontractors Management)

### ๐ ุงููุตู

ูุธุงู ูุชูุงูู ูุฅุฏุงุฑุฉ ุนููุฏ ููุงููู ุงูุจุงุทู ููุชุงุจุนุฉ ุฃุฏุงุฆูู.

### โ๏ธ ุงูููู: `backend/subcontractors.py` (5,872 ุญุฑู)

### ๐ ุงูููููุงุช ุงูุฑุฆูุณูุฉ

#### 1. ููุงูู ุงูุจุงุทู (Subcontractor)

**ูุนูููุงุช ุฃุณุงุณูุฉ:**
- ุฑูู ุงูุฑุฎุตุฉ ูุงูุณุฌู ุงูุถุฑูุจู
- ุงูุชุฎุตุต (ุฎุฑุณุงูุฉุ ุญุฏูุฏุ ููุฑุจุงุกุ ุฅูุฎ)
- ูุนูููุงุช ุงูุงุชุตุงู
- ุงูุชูููู (0-5 ูุฌูู)

**ุฅุถุงูุฉ ููุงูู ุจุงุทู:**
```python
from backend.subcontractors import SubcontractorManager, Subcontractor

sm = SubcontractorManager()

subcontractor = Subcontractor(
    id=1,
    code="SUB-001",
    name_ar="ูุคุณุณุฉ ุงูููุงููุงุช ุงููุชูุฏูุฉ",
    name_en="Advanced Contracting Est.",
    specialty="Concrete Works",
    license_number="LC-12345",
    tax_number="300987654321003",
    contact_person="Mohammed Hassan",
    phone="+966505555555",
    email="info@advancedcontracting.com",
    rating=4.2
)

sm.add_subcontractor(subcontractor)
```

---

#### 2. ุงูุนูุฏ (Contract)

**ุญุงูุงุช ุงูุนูุฏ:**
- `DRAFT` - ูุณูุฏุฉ
- `ACTIVE` - ูุดุท
- `SUSPENDED` - ูุนูู
- `COMPLETED` - ููุชูู
- `TERMINATED` - ููุชูู

**ุฅูุดุงุก ุนูุฏ:**
```python
from backend.subcontractors import SubcontractorContract, ContractStatus
from datetime import datetime, timedelta

contract = SubcontractorContract(
    id=1,
    contract_number="SC-2025-001",
    subcontractor_id=1,
    subcontractor_name="Advanced Contracting Est.",
    project_id=1,
    scope_of_work="All concrete works for Building A including foundation, columns, slabs",
    contract_value=850000.0,
    start_date=datetime.now(),
    end_date=datetime.now() + timedelta(days=120),
    status=ContractStatus.ACTIVE,
    retention_percentage=10.0  # ูุณุจุฉ ุงูุงุณุชูุทุงุน
)

sm.create_contract(contract)
```

---

#### 3. ูุชุงุจุนุฉ ุงูุชูุฏู (Work Progress)

**ุชุณุฌูู ุชูุฏู ุงูุฃุนูุงู:**
```python
from backend.subcontractors import WorkProgress

progress = WorkProgress(
    id=1,
    contract_id=1,
    date=datetime.now(),
    description="Foundation concrete pour - Grid A1-A5",
    quantity_completed=125.5,
    unit="mยณ",
    progress_percentage=15.0,  # 15% ูู ุงูุนูุฏ
    photos=[
        "/uploads/photos/foundation_1.jpg",
        "/uploads/photos/foundation_2.jpg"
    ],
    notes="Work completed as per schedule",
    submitted_by_id=102,  # ูููุฏุณ ุงููููุน
    approved=True
)

sm.record_progress(progress)

print(f"โ Progress Recorded")
print(f"   Contract Progress: {progress.progress_percentage}%")
```

---

#### 4. ุงูุฏูุนุงุช (Payments)

**ุฅูุดุงุก ุฏูุนุฉ:**
```python
# ุฅูุดุงุก ุฏูุนุฉ ุจูุงุกู ุนูู ุงูุชูุฏู
payment = sm.create_payment(
    contract_id=1,
    amount=127500.0  # 15% ูู ูููุฉ ุงูุนูุฏ
)

print(f"๐ฐ Payment Created: {payment.payment_number}")
print(f"   Gross Amount: {payment.amount:,.2f} SAR")
print(f"   Retention (10%): {payment.retention_amount:,.2f} SAR")
print(f"   Net Amount: {payment.net_amount:,.2f} SAR")
```

---

#### 5. ุชูููู ุงูุฃุฏุงุก

**ูุนุงููุฑ ุงูุชูููู:**
- ุงูุงูุชุฒุงู ุจุงูููุช
- ุฌูุฏุฉ ุงูุฃุนูุงู
- ุงูุณูุงูุฉ
- ุงูุฅูุชุงุฌูุฉ

**ุชูุฑูุฑ ุงูุฃุฏุงุก:**
```python
# ุงูุญุตูู ุนูู ุชูุฑูุฑ ุฃุฏุงุก ุดุงูู
performance = sm.get_performance_report(subcontractor_id=1)

print(f"\n๐ Performance Report")
print(f"   Total Contracts: {performance['total_contracts']}")
print(f"   Active: {performance['active_contracts']}")
print(f"   Completed: {performance['completed_contracts']}")
print(f"   Total Value: {performance['total_value']:,.2f} SAR")
print(f"   Average Progress: {performance['average_progress']:.1f}%")
```

---

## 4๏ธโฃ ูุณู ุงููุฎุทุทุงุช ูุงููุณุชูุฏุงุช (Drawing & Document Management)

### ๐ ุงููุตู

ููุชุจุฉ ูุฑูุฒูุฉ ูุฌููุน ุงููุฎุทุทุงุช ูุงููุซุงุฆู ุงููููุฉ ูุน ูุธุงู ุงุนุชูุงุฏ ุฅููุชุฑููู ูุชุชุจุน ุงููุณุฎ.

### โ๏ธ ุงูููู: `backend/drawing_management.py` (5,798 ุญุฑู)

### ๐ ุงูููููุงุช ุงูุฑุฆูุณูุฉ

#### 1. ุงููุฎุทุท (Drawing)

**ุญุงูุงุช ุงููุฎุทุท:**
- `DRAFT` - ูุณูุฏุฉ
- `SUBMITTED` - ููุฏู ูููุฑุงุฌุนุฉ
- `UNDER_REVIEW` - ููุฏ ุงููุฑุงุฌุนุฉ
- `APPROVED` - ูุนุชูุฏ
- `REJECTED` - ูุฑููุถ
- `SUPERSEDED` - ุชู ุงุณุชุจุฏุงูู

**ุงูุชุฎุตุตุงุช:**
- Architectural - ูุนูุงุฑู
- Structural - ุฅูุดุงุฆู
- MEP - ููุฑููููุงูููู
- Civil - ูุฏูู
- Landscape - ุชูุณูู ููุงูุน

**ุฅุถุงูุฉ ูุฎุทุท:**
```python
from backend.drawing_management import DrawingManager, Drawing, DrawingStatus

dm = DrawingManager()

drawing = Drawing(
    id=1,
    drawing_number="A-101",
    title="Ground Floor Plan - Building A",
    discipline="Architectural",
    project_id=1,
    revision="A",
    status=DrawingStatus.DRAFT,
    file_path="/drawings/A-101_RevA.pdf",
    file_type="PDF",
    created_by_id=301  # ุงูููุชุจ ุงูููู
)

dm.add_drawing(drawing)
```

---

#### 2. ุงููุฑุงุฌุนุงุช (Revisions)

**ุฅูุดุงุก ูุฑุงุฌุนุฉ ุฌุฏูุฏุฉ:**
```python
# ุนูุฏ ุญุฏูุซ ุชุนุฏููุงุช ุนูู ุงููุฎุทุท
revision = dm.create_revision(
    drawing_id=1,
    description="Updated column positions as per client request",
    changes=[
        "Column C3 moved 500mm north",
        "Added door opening in Grid A-B",
        "Updated room dimensions"
    ]
)

print(f"๐ Created Revision: {revision.revision}")
print(f"   Previous: Rev A โ Current: Rev {revision.revision}")
```

**ุนุฑุถ ุชุงุฑูุฎ ุงููุฑุงุฌุนุงุช:**
```python
# ุงูุญุตูู ุนูู ุฌููุน ูุฑุงุฌุนุงุช ูุฎุทุท ูุนูู
history = dm.get_drawing_history(drawing_id=1)

print(f"\n๐ Drawing History: A-101")
for rev in history:
    print(f"\n   Revision {rev.revision}")
    print(f"   Date: {rev.revision_date.strftime('%Y-%m-%d')}")
    print(f"   Changes:")
    for change in rev.changes:
        print(f"     โข {change}")
```

---

#### 3. ุงูููุงุฑูุฉ ุจูู ุงููุณุฎ

**ููุงุฑูุฉ ุชููุงุฆูุฉ:**
```python
# ููุงุฑูุฉ ุจูู ูุณุฎุชูู
comparison = dm.compare_revisions(
    drawing_id=1,
    rev1="A",
    rev2="B"
)

print(f"\n๐ Comparison Report")
print(f"   Drawing: {comparison['drawing_id']}")
print(f"   Comparing: Rev {comparison['revision_1']} vs Rev {comparison['revision_2']}")
print(f"   Changes:")
for change in comparison['changes']:
    print(f"     โข {change}")
```

---

#### 4. ุงูุงุนุชูุงุฏ (Approval)

**ุงุนุชูุงุฏ ูุฎุทุท:**
```python
# ุงุนุชูุงุฏ ุงููุฎุทุท ูู ุงูููุชุจ ุงูููู ุฃู ุงููููุฏุณ ุงูุงุณุชุดุงุฑู
success = dm.approve_drawing(
    drawing_id=1,
    approved_by_id=401  # ูุฏูุฑ ุงูููุชุจ ุงูููู
)

if success:
    print("โ Drawing Approved")
    print("   Status: APPROVED")
    print("   Ready for construction")
```

---

#### 5. ุงููุฑุงุณูุงุช ุงููููุฉ (Transmittals)

**ุฅูุดุงุก Transmittal:**
```python
from backend.drawing_management import Transmittal

transmittal = Transmittal(
    id=1,
    transmittal_number="TRN-2025-001",
    project_id=1,
    from_company="NOUFAL Engineering",
    to_company="ABC Consultant",
    date=datetime.now(),
    subject="Shop Drawings for Approval - Phase 1",
    attachments=[1, 2, 3, 4],  # Drawing IDs
    notes="Please review and approve within 7 days",
    status="sent"
)

dm.create_transmittal(transmittal)

print(f"๐ค Transmittal Sent: {transmittal.transmittal_number}")
print(f"   Attachments: {len(transmittal.attachments)} drawings")
```

---

## ๐ ุงูุชูุงูู ุจูู ุงูุฃูุณุงู

### ุงูุชูุงูู ุงููุงูู ุจูู ุฌููุน ุงูุฃูุณุงู:

```
โโโโโโโโโโโโโโโโโโโ
โ  ุงููุดุชุฑูุงุช      โ โโ BOQ (ุฑุจุท ุงููููุงุช)
โ  Procurement    โ โโ Accounts (ุชุญุฏูุซ ุงููุงููุฉ)
โโโโโโโโโโโโโโโโโโโ โโ Site Engineer (ุงุณุชูุงู ุงูููุงุฏ)
        โ
โโโโโโโโโโโโโโโโโโโ
โ ููุงููู ุงูุจุงุทู   โ โโ BOQ (ููุงุฑูุฉ ุงูุฅูุฌุงุฒ)
โ Subcontractors  โ โโ Accounts (ุงูุฏูุนุงุช)
โโโโโโโโโโโโโโโโโโโ โโ Schedule (ุงูุฌุฏูู ุงูุฒููู)
        โ
โโโโโโโโโโโโโโโโโโโ
โ ุงููุฎุทุทุงุช        โ โโ RFI (ุทูุจุงุช ุงููุนูููุงุช)
โ Drawings        โ โโ Site (As-Built Updates)
โโโโโโโโโโโโโโโโโโโ โโ Execution Engineer (ุงูููุงุฑูุฉ)
```

---

## ๐ API Endpoints

### ููุงุท ุงูููุงูุฉ ุงูุฌุฏูุฏุฉ:

#### Permissions:
```
GET  /api/permissions/matrix        # ูุตูููุฉ ุงูุตูุงุญูุงุช ุงููุงููุฉ
GET  /api/permissions/roles         # ุฌููุน ุงูุฃุฏูุงุฑ ุงููุชุงุญุฉ
POST /api/permissions/check         # ุงูุชุญูู ูู ุตูุงุญูุฉ
```

#### Procurement:
```
POST /api/procurement/pr/create     # ุฅูุดุงุก ุทูุจ ุดุฑุงุก
POST /api/procurement/po/create     # ุฅูุดุงุก ุฃูุฑ ุดุฑุงุก
GET  /api/procurement/reports/material-status
GET  /api/procurement/reports/supplier-performance
GET  /api/procurement/reports/pending-deliveries
```

#### Subcontractors:
```
GET  /api/subcontractors/list       # ูุงุฆูุฉ ุงูููุงูููู
GET  /api/subcontractors/contracts  # ุงูุนููุฏ
POST /api/subcontractors/progress   # ุชุณุฌูู ุชูุฏู
POST /api/subcontractors/payment    # ุฅูุดุงุก ุฏูุนุฉ
```

#### Drawings:
```
GET  /api/drawings/list                      # ูุงุฆูุฉ ุงููุฎุทุทุงุช
GET  /api/drawings/<id>/revisions            # ุชุงุฑูุฎ ุงููุฑุงุฌุนุงุช
POST /api/drawings/<id>/approve              # ุงุนุชูุงุฏ ูุฎุทุท
GET  /api/drawings/compare/<id>/<r1>/<r2>   # ููุงุฑูุฉ ุงููุณุฎ
```

---

## โ ููุฎุต ุงูุชูููุฐ

### ุงููููุงุช ุงูููุดุฃุฉ:

| ุงูููู | ุงูุญุฌู | ุงููุตู |
|------|------|-------|
| `backend/permissions.py` | 23.6 KB | ูุธุงู ุงูุตูุงุญูุงุช - 9 ุฃุฏูุงุฑ |
| `backend/procurement.py` | 23.8 KB | ูุณู ุงููุดุชุฑูุงุช ุงูุดุงูู |
| `backend/subcontractors.py` | 5.9 KB | ุฅุฏุงุฑุฉ ููุงููู ุงูุจุงุทู |
| `backend/drawing_management.py` | 5.8 KB | ุฅุฏุงุฑุฉ ุงููุฎุทุทุงุช |

**ุงูุฅุฌูุงูู:** 59.1 KB ูู ุงูููุฏ ุนุงูู ุงูุฌูุฏุฉ

### ุงูููุฒุงุช ุงููุทุจูุฉ:

- โ **9 ุฃุฏูุงุฑ** ูุน ุตูุงุญูุงุช ูุญุฏุฏุฉ (60+ ุตูุงุญูุฉ)
- โ **ุฏูุฑุฉ ูุดุชุฑูุงุช ูุงููุฉ** (PR โ PO โ Delivery)
- โ **ุฅุฏุงุฑุฉ ุดุงููุฉ ููููุฑุฏูู** ูุน ุชูููู ุงูุฃุฏุงุก
- โ **ุชุชุจุน ุญุงูุฉ ุงูููุงุฏ** (ูุทููุจ โ ูุทููุจ โ ููุฏ ุงูุชูุฑูุฏ โ ูุณุชูู)
- โ **ุนููุฏ ููุงููู ุงูุจุงุทู** ูุน ูุชุงุจุนุฉ ุงูุชูุฏู
- โ **ูุธุงู ุงูุฏูุนุงุช** ูุน ุงูุงุณุชูุทุงุนุงุช
- โ **ููุชุจุฉ ูุฎุทุทุงุช ูุฑูุฒูุฉ** ูุน ุชุชุจุน ุงููุณุฎ
- โ **ูุธุงู ุงุนุชูุงุฏ ุฅููุชุฑููู** ูููุฎุทุทุงุช
- โ **ููุงุฑูุฉ ุชููุงุฆูุฉ** ุจูู ูุณุฎ ุงููุฎุทุทุงุช
- โ **ุฅุฏุงุฑุฉ ุงููุฑุงุณูุงุช ุงููููุฉ** (Transmittals)

---

## ๐ ุงูุฎุทูุงุช ุงูุชุงููุฉ

### ุงูุฃุณุจูุน ุงููุงุฏู:
1. โ ุงุฎุชุจุงุฑ ุดุงูู ูุฌููุน ุงูุฃูุณุงู
2. โ ุฅูุดุงุก ูุงุฌูุงุช ูุณุชุฎุฏู
3. โ ุชุทุจูู ููุฏุงูู ููุฌูุงู
4. โ ุชูุงุฑูุฑ ุชูุงุนููุฉ

### ุงูุดูุฑ ุงููุงุฏู:
1. ๐ ููุญุงุช ุชุญูู ูุชุฎุตุตุฉ ููู ุฏูุฑ
2. ๐ ุชุญูููุงุช ูุชูุฏูุฉ
3. ๐ ุชูุงูู ูุน Primavera/MS Project
4. ๐ฑ ุชุทุจูู iOS/Android

---

**ุชู ุจุญูุฏ ุงููู! ๐**

ุฌููุน ุงูุฃูุณุงู ุงูุฃุฑุจุนุฉ ูููุฐุฉ ุจุดูู ุดุงูู ููุชูุงูู ูุฌุงูุฒุฉ ููุงุณุชุฎุฏุงู.

**NOUFAL ERP Development Team**  
**ุขุฎุฑ ุชุญุฏูุซ:** 2025-11-06
